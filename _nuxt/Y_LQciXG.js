import{a as be,H as _e,r as _,d as ne,I as se,j as $,o as ee,t as i,v as l,x as e,J as b,K as S,L as P,y as m,M as K,N as ke,O as W,P as we,Q as me,R as j,S as J,z as Q,T as I,B as Ce,U as ue,V as Ne,W as Be,_ as pe,X as $e,Y as Te,Z as ce,A as Me}from"./CZfXIeuB.js";const F=()=>be().$supabase.client,oe=_e("users",()=>{const T=_([]),f=_(!1),k=_(null),y=_(!1),p=async()=>{if(!f.value){f.value=!0,k.value=null;try{const{data:N,error:B}=await F().from("users").select("*").order("name");if(B)throw B;T.value=N,y.value=!0}catch(N){k.value=N,console.error("Error loading users:",N)}finally{f.value=!1}}};return{users:T,loading:f,error:k,fetchUsers:p,refreshUsers:async()=>{y.value=!1,await p()}}}),Ve={class:"bg-white rounded-lg shadow p-4 sm:p-6 mt-6"},Se={class:"hidden sm:block overflow-x-auto mb-8"},Pe={class:"min-w-full divide-y divide-gray-200"},He={class:"bg-white divide-y divide-gray-200"},De={class:"px-6 py-4"},Ee={class:"px-6 py-4"},Ue={class:"px-6 py-4"},Ae={class:"px-6 py-4"},Ie={class:"px-6 py-4"},qe={class:"px-6 py-4 text-right space-x-2"},je=["onClick"],Le=["onClick"],Oe={class:"sm:hidden space-y-4 mb-8"},Re={class:"font-medium"},Ke={class:"grid grid-cols-2 text-sm gap-2"},Qe={class:"font-medium text-green-600"},Fe={class:"flex justify-end space-x-3 pt-2 border-t border-gray-200 mt-2"},Ge=["onClick"],Xe=["onClick"],ze={class:"space-y-6"},We={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},Ze={class:"font-medium"},Ye={class:"space-y-4"},Je={class:"flex flex-col sm:hidden"},et={class:"flex items-center space-x-2 mb-2"},tt={class:"font-medium"},nt={class:"font-medium"},st={class:"text-lg font-medium text-green-600 mb-3"},ot={class:"flex flex-col space-y-2"},at=["onClick"],rt=["onClick"],lt={class:"hidden sm:flex sm:justify-between sm:items-center"},it={class:"font-medium"},dt={class:"font-medium"},ut={class:"ml-2"},ct={class:"flex items-center space-x-2"},mt=["onClick"],pt=["onClick"],gt={key:0,class:"text-sm text-gray-500 mt-2"},ht={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},vt={class:"bg-white rounded-lg shadow-xl w-full max-w-sm"},ft={class:"p-4"},yt=["src"],xt={class:"p-4 border-t"},bt=ne({__name:"ExpenseResults",props:{expenses:{},role:{}},emits:["edit","refresh"],setup(T,{emit:f}){const k=T,y=f,p=oe(),{users:x}=se(p),N=_(!1),B=_(""),o=_([]),E=$(()=>{var d,a;if(!((d=x.value)!=null&&d.length)||!((a=k.expenses)!=null&&a.length))return{};const u=Object.fromEntries(x.value.map(g=>[g.id,0]));return k.expenses.forEach(g=>{const w=g.participants.length;if(w===0)return;const V=g.amount/w;u[g.payer]+=g.amount,g.participants.forEach(M=>{const C=x.value.find(q=>q.name===M);C&&(u[C.id]-=V)})}),u}),G=$(()=>{const u=E.value;if(!Object.keys(u).length)return[];const d=[],a=[];Object.entries(u).forEach(([M,C])=>{C<0?d.push({id:M,amount:-C}):C>0&&a.push({id:M,amount:C})}),d.sort((M,C)=>C.amount-M.amount),a.sort((M,C)=>C.amount-M.amount);const g=[];let w=0,V=0;for(;w<d.length&&V<a.length;){const M=d[w],C=a[V],q=Math.min(M.amount,C.amount),D=o.value.find(te=>te.from_user===M.id&&te.to_user===C.id);g.push({from:M.id,to:C.id,amount:Math.round(q),completed:(D==null?void 0:D.completed)||!1,completed_at:(D==null?void 0:D.completed_at)||null,id:D==null?void 0:D.id}),M.amount-=q,C.amount-=q,M.amount<.01&&w++,C.amount<.01&&V++}return g}),U=$(()=>G.value.map(u=>{const d=x.value.find(g=>g.id===u.from),a=x.value.find(g=>g.id===u.to);return{...u,fromName:(d==null?void 0:d.name)||"Unknown",toName:(a==null?void 0:a.name)||"Unknown"}})),L=u=>{const d=x.value.find(w=>w.id===u.to),a=x.value.find(w=>w.id===u.from);if(!d||!a)return"";const g=`${a.name} ck ${d.name} tien ${k.expenses.map(w=>w.title).join(" ")}`;return`https://qr.sepay.vn/img?acc=${d.account_number}&bank=${d.bank}&amount=${u.amount}&des=${encodeURIComponent(g)}&template=compact&download=false`},O=u=>{B.value=L(u),N.value=!0},c=u=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(u),r=u=>new Date(u).toLocaleDateString("vi-VN"),v=u=>u?new Date(u).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",H=async()=>{try{const{data:u,error:d}=await F().from("transactions").select("*");if(d)throw d;o.value=u}catch(u){console.error("Error loading transactions:",u)}},X=async u=>{const d=F();try{if(u.id){const{error:a}=await d.from("transactions").update({completed:!u.completed,completed_at:u.completed?null:new Date().toISOString()}).eq("id",u.id);if(a)throw a}else{const{error:a}=await d.from("transactions").insert([{from_user:u.from,to_user:u.to,amount:u.amount,completed:!0,completed_at:new Date().toISOString()}]);if(a)throw a}await H()}catch(a){console.error("Error updating transaction:",a)}},Z=async u=>{if(confirm("Bạn có chắc chắn muốn xóa chi tiêu này?"))try{const{error:d}=await F().from("expenses").delete().eq("id",u);if(d)throw d;y("refresh")}catch(d){console.error("Error deleting expense:",d)}};ee(async()=>{var u;(u=x.value)!=null&&u.length||await p.fetchUsers(),await H()});const R=u=>{const d=x.value.find(a=>a.id===u);return(d==null?void 0:d.name)||"Unknown"};return(u,d)=>(l(),i("div",Ve,[d[11]||(d[11]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-xl sm:text-2xl font-bold"},"Danh sách chi tiêu")],-1)),e("div",Se,[e("table",Pe,[d[1]||(d[1]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tên chi tiêu"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Ngày"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Số tiền"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Người trả"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Người tham gia"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Thao tác")])],-1)),e("tbody",He,[(l(!0),i(S,null,P(u.expenses,a=>(l(),i("tr",{key:a.id},[e("td",De,m(a.title),1),e("td",Ee,m(r(a.date)),1),e("td",Ue,m(c(a.amount)),1),e("td",Ae,m(R(a.payer)),1),e("td",Ie,m(a.participants.join(", ")),1),e("td",qe,[u.role==="spender"?(l(),i("button",{key:0,onClick:g=>u.$emit("edit",a),class:"text-indigo-600 hover:text-indigo-900"}," Sửa ",8,je)):b("",!0),u.role==="spender"?(l(),i("button",{key:1,onClick:g=>Z(a.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,Le)):b("",!0)])]))),128))])])]),e("div",Oe,[(l(!0),i(S,null,P(u.expenses,a=>(l(),i("div",{key:a.id,class:"bg-gray-50 rounded-lg p-4 space-y-2"},[e("div",Re,m(a.title),1),e("div",Ke,[d[2]||(d[2]=e("div",{class:"text-gray-500"},"Ngày:",-1)),e("div",null,m(r(a.date)),1),d[3]||(d[3]=e("div",{class:"text-gray-500"},"Số tiền:",-1)),e("div",Qe,m(c(a.amount)),1),d[4]||(d[4]=e("div",{class:"text-gray-500"},"Người trả:",-1)),e("div",null,m(R(a.payer)),1),d[5]||(d[5]=e("div",{class:"text-gray-500"},"Người tham gia:",-1)),e("div",null,m(a.participants.join(", ")),1)]),e("div",Fe,[u.role==="spender"?(l(),i("button",{key:0,onClick:g=>u.$emit("edit",a),class:"text-indigo-600 hover:text-indigo-900 text-sm"}," Sửa ",8,Ge)):b("",!0),u.role==="spender"?(l(),i("button",{key:1,onClick:g=>Z(a.id),class:"text-red-600 hover:text-red-900 text-sm"}," Xóa ",8,Xe)):b("",!0)])]))),128))]),d[12]||(d[12]=e("h2",{class:"text-xl sm:text-2xl font-bold mb-4"},"Kết quả chia tiền",-1)),e("div",ze,[e("div",null,[d[6]||(d[6]=e("h3",{class:"text-lg font-semibold mb-2"},"Tổng kết cá nhân",-1)),e("div",We,[(l(!0),i(S,null,P(E.value,(a,g)=>(l(),i("div",{key:g,class:"bg-gray-50 p-3 rounded-lg flex justify-between items-center"},[e("span",Ze,m(R(g)),1),e("span",{class:K(["font-medium",a<0?"text-red-500":"text-green-500"])},m(c(a)),3)]))),128))])]),e("div",null,[d[9]||(d[9]=e("h3",{class:"text-lg font-semibold mb-2"},"Giao dịch cần thực hiện",-1)),e("div",Ye,[(l(!0),i(S,null,P(U.value,a=>(l(),i("div",{key:a.id||`${a.from}-${a.to}-${a.amount}`,class:K(["border p-4 rounded-lg transition-colors duration-200",a.completed?"bg-gray-100":"bg-white"])},[e("div",Je,[e("div",et,[e("span",tt,m(a.fromName),1),d[7]||(d[7]=e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 8l4 4m0 0l-4 4m4-4H3"})],-1)),e("span",nt,m(a.toName),1)]),e("div",st,m(c(a.amount)),1),e("div",ot,[e("button",{onClick:g=>X(a),class:K(["w-full py-2 px-3 rounded-md text-sm font-medium",a.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},m(a.completed?"Đã chuyển":"Đánh dấu đã chuyển"),11,at),e("button",{onClick:g=>O(a),class:"w-full py-2 px-3 rounded-md text-sm font-medium bg-green-50 text-green-600"}," Tạo QR chuyển tiền ",8,rt)])]),e("div",lt,[e("div",null,[e("span",it,m(a.fromName),1),d[8]||(d[8]=e("span",{class:"mx-2"},"→",-1)),e("span",dt,m(a.toName),1),e("span",ut,m(c(a.amount)),1)]),e("div",ct,[e("button",{onClick:g=>X(a),class:K(["px-3 py-1 rounded-md text-sm",a.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},m(a.completed?"Đã chuyển":"Đánh dấu đã chuyển"),11,mt),e("button",{onClick:g=>O(a),class:"px-3 py-1 rounded-md text-sm bg-green-50 text-green-600"}," Tạo QR chuyển tiền ",8,pt)])]),a.completed?(l(),i("div",gt," Hoàn thành: "+m(v(a.completed_at)),1)):b("",!0)],2))),128))])])]),N.value?(l(),i("div",ht,[e("div",vt,[d[10]||(d[10]=e("div",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-bold"},"QR Code chuyển khoản")],-1)),e("div",ft,[e("img",{src:B.value,alt:"QR Code",class:"w-full"},null,8,yt)]),e("div",xt,[e("button",{onClick:d[0]||(d[0]=a=>N.value=!1),class:"w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700"}," Đóng ")])])])):b("",!0)]))}});function ae(T,f){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function _t(T,f){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}function kt(T,f){return l(),i("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const wt={class:"flex justify-between items-center mb-4"},Ct={class:"text-2xl font-bold"},Nt={key:0,class:"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full"},Bt={class:"space-y-6"},$t={class:"form-control-group"},Tt={class:"form-control-group"},Mt={class:"relative"},Vt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},St={class:"mt-4 flex flex-wrap gap-2"},Pt=["onClick"],Ht={key:0,class:"mt-2 flex flex-wrap gap-2"},Dt=["onClick"],Et={class:"form-control-group"},Ut={class:"space-y-2"},At={class:"relative"},It=["max"],qt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},jt={class:"flex flex-wrap gap-2"},Lt=["onClick"],Ot={key:0,class:"mt-2"},Rt={class:"flex flex-wrap gap-2"},Kt=["onClick"],Qt={class:"form-control-group relative"},Ft={class:"relative"},Gt=["placeholder"],Xt={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},zt={key:0,class:"p-2"},Wt={class:"space-y-1"},Zt=["onClick"],Yt={key:0,class:"ml-2 text-xs text-gray-500"},Jt={class:"max-h-60 overflow-auto"},en={key:0,class:"py-1"},tn=["onClick"],nn={class:"flex flex-col"},sn={key:0,class:"text-xs text-gray-500"},on={key:0,class:"ml-2 text-xs text-gray-500"},an={key:1,class:"px-3 py-2 text-sm text-gray-500"},rn={key:1,class:"mt-1 flex items-center text-sm text-gray-500"},ln={class:"space-y-4"},dn={class:"flex gap-2 mb-3"},un={class:"grid grid-cols-2 gap-2"},cn=["value"],mn={class:"ml-2 text-sm"},pn={key:0,class:"p-3 bg-yellow-50 text-yellow-700 rounded-md mb-3"},gn={key:1,class:"space-y-2"},hn={class:"flex items-center"},vn={class:"flex items-center"},fn={key:0,class:"mt-3 p-3 bg-gray-50 rounded-md"},yn={class:"font-medium"},xn={class:"flex justify-end space-x-3"},bn={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},_n=ne({__name:"ExpenseForm",props:{editingExpense:{},expenses:{}},emits:["save","cancel"],setup(T,{emit:f}){const k=oe(),{users:y}=se(k),p=T,x=f,N=_(null),B=_(null),o=ke({title:"",amount:0,date:new Date().toISOString().split("T")[0],payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),E=$(()=>new Date().toISOString().split("T")[0]),G=()=>{if(!o.splitEqually){const s=Object.values(o.individualAmounts).reduce((n,t)=>n+(Number(t)||0),0);if(Math.abs(s-o.amount)>.01)return!1}return!0},U=async()=>{if(!o.splitEqually&&!G()){alert("Tổng số tiền chi tiêu cá nhân phải bằng tổng số tiền");return}try{const s={title:o.title,amount:o.amount,date:o.date,payer:o.payer,participants:o.participants,split_equally:o.splitEqually,individual_amounts:o.individualAmounts},n=F();if(B.value){const{error:t}=await n.from("expenses").update(s).eq("id",B.value);if(t)throw t}else{const{error:t}=await n.from("expenses").insert([s]);if(t)throw t}x("save"),L()}catch(s){console.error("Error saving expense:",s)}},L=()=>{B.value=null,Object.assign(o,{title:"",amount:0,date:E.value,payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),x("cancel"),c.value="",g.value="",w.value=!1},O=()=>{N.value&&N.value.scrollIntoView({behavior:"smooth",block:"start"})};W(()=>p.editingExpense,s=>{s&&(B.value=s.id,Object.assign(o,{title:s.title,amount:s.amount,date:s.date||E.value,payer:s.payer,participants:s.participants,splitEqually:s.split_equally,individualAmounts:s.individual_amounts||{}}),Ne(()=>{O()}))},{immediate:!0}),ee(async()=>{y.value.length||await k.fetchUsers()});const c=_(""),r=[5e4,1e5,2e5,5e5,1e6],v=$(()=>{const s=parseFloat(c.value);if(!s||isNaN(s))return[];const n=[];if(s<1e3&&n.push(s*1e3),s<1e6){const t=Math.ceil(s/1e3)*1e3;t!==s&&n.push(t)}return s<=100&&n.push(s*1e3,s*1e4),[...new Set(n)].slice(0,3)}),H=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s),X=s=>{o.amount=s,c.value=s.toString()};W(()=>o.amount,s=>{s!==parseInt(c.value)&&(c.value=s.toString())},{immediate:!0}),W(c,s=>{const n=s.replace(/[^0-9]/g,"");n!==s&&(c.value=n)});const Z=$(()=>{const s=new Date,n=new Date(s);n.setDate(n.getDate()-1);const t=new Date(s);return t.setDate(t.getDate()-2),[{label:"Hôm nay",value:u(s)},{label:"Hôm qua",value:u(n)},{label:"Hôm kia",value:u(t)}]}),R=$(()=>{var n;const s=((n=p.expenses)==null?void 0:n.map(t=>t.date).filter(t=>t!==o.date&&t!==E.value).slice(0,3))||[];return[...new Set(s)]}),u=s=>s.toISOString().split("T")[0],d=s=>{if(!s)return"";const n=new Date(s),t=new Date,h=new Date(t);return h.setDate(h.getDate()-1),u(t)===s?"Hôm nay":u(h)===s?"Hôm qua":new Intl.DateTimeFormat("vi-VN",{weekday:"long"}).format(n)},a=s=>{o.date=s},g=_(""),w=_(!1),V=$(()=>k.currentUser),M=$(()=>{const s=g.value.toLowerCase().trim();return s?y.value.filter(n=>{var t;return n.name.toLowerCase().includes(s)||((t=n.email)==null?void 0:t.toLowerCase().includes(s))}):y.value}),C=$(()=>{var n;const s=(n=p.expenses)==null?void 0:n.reduce((t,h)=>(t[h.payer]=(t[h.payer]||0)+1,t),{});return y.value.filter(t=>s[t.id]).sort((t,h)=>s[h.id]-s[t.id]).slice(0,5)}),q=$(()=>{if(!o.payer)return"";const s=y.value.find(n=>n.id===o.payer);return s?s.name:""}),D=s=>{o.payer=s,g.value="",w.value=!1},te=()=>{o.payer="",g.value=""},ge=()=>{w.value=!0},re=s=>{s.target.closest(".relative")||(w.value=!1)};ee(()=>{document.addEventListener("click",re)}),we(()=>{document.removeEventListener("click",re)});const he=_("");$(()=>{const s=he.value.toLowerCase(),n=y.value.filter(Y=>{var de;return Y.name.toLowerCase().includes(s)||((de=Y.email)==null?void 0:de.toLowerCase().includes(s))}),t=n.filter(Y=>le(Y.id)),h=n.filter(Y=>!le(Y.id)),A=[];return t.length&&A.push({label:"Thường xuyên tham gia",users:t}),h.length&&A.push({label:"Những người khác",users:h}),A});const le=s=>p.expenses?p.expenses.filter(t=>{var h;return t.participants.includes((h=y.value.find(A=>A.id===s))==null?void 0:h.name)}).length>=3:!1,ve=()=>{o.participants=y.value.map(s=>s.name)},fe=$(()=>V.value&&o.participants.includes(V.value.name)),ye=()=>{if(!V.value)return;const s=V.value.name;o.participants.includes(s)?o.participants=o.participants.filter(n=>n!==s):o.participants.push(s)};W(()=>o.splitEqually,s=>{s?o.individualAmounts={}:o.participants.forEach(n=>{o.individualAmounts[n]||(o.individualAmounts[n]=0)})}),W(()=>o.participants,s=>{if(!o.splitEqually){const n={...o.individualAmounts};Object.keys(n).forEach(t=>{s.includes(t)||delete n[t]}),s.forEach(t=>{n[t]||(n[t]=0)}),o.individualAmounts=n}},{deep:!0}),$(()=>!o.amount||!o.participants.length?0:Math.round(o.amount/o.participants.length));const xe=$(()=>o.individualAmounts?Object.values(o.individualAmounts).reduce((s,n)=>s+(Number(n)||0),0):0);$(()=>o.amount-xe.value),$(()=>[{label:"Làm tròn xuống",value:"roundDown"},{label:"Làm tròn lên",value:"roundUp"},{label:"Làm tròn đến 1k",value:"roundToThousand"},{label:"Làm tròn đến 10k",value:"roundToTenThousand"}]),$(()=>[{label:"Chia theo tỷ lệ",value:"proportional"},{label:"Người trả không phải trả",value:"payerFree"},{label:"Reset về 0",value:"reset"},{label:"Chia đều phần còn lại",value:"splitRemaining"}]),W(()=>o.amount,s=>{if(o.splitEqually){const n=Math.round(s/o.participants.length);o.participants.forEach(t=>{o.individualAmounts[t]=n})}});const z=_("equal"),ie=$(()=>{const s={};if(!o.payer||!o.amount||!o.participants.length)return s;const n=y.value.find(t=>t.id===o.payer);if(!n)return s;if(z.value==="equal"){const t=Math.round(o.amount/o.participants.length);o.participants.forEach(h=>{s[h]=t})}else if(z.value==="payerFree"){const t=o.participants.filter(h=>h!==n.name);if(t.length===0)s[n.name]=o.amount;else{const h=Math.round(o.amount/t.length);o.participants.forEach(A=>{s[A]=A===n.name?0:h})}}return s});return W([z,()=>o.participants,()=>o.amount],()=>{o.individualAmounts={...ie.value}}),(s,n)=>(l(),i("div",{ref_key:"formRef",ref:N,class:K(["bg-white rounded-lg shadow py-8 px-4 transition-all duration-300",B.value?"ring-2 ring-green-500 ring-offset-2":""])},[e("div",wt,[e("h2",Ct,m(B.value?"Sửa chi tiêu":"Thêm chi tiêu mới"),1),B.value?(l(),i("span",Nt," Đang sửa ")):b("",!0)]),e("form",{onSubmit:me(U,["prevent"])},[e("div",Bt,[e("div",$t,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tên chi tiêu",-1)),j(e("input",{"onUpdate:modelValue":n[0]||(n[0]=t=>o.title=t),type:"text",required:"",class:"form-input"},null,512),[[J,o.title]])]),e("div",Tt,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Số tiền",-1)),e("div",Mt,[j(e("input",{"onUpdate:modelValue":n[1]||(n[1]=t=>c.value=t),type:"text",required:"",placeholder:"Nhập số tiền",class:"form-input"},null,512),[[J,c.value]]),e("div",Vt,m(H(o.amount)),1)]),e("div",St,[(l(),i(S,null,P(r,t=>e("button",{key:t,type:"button",onClick:h=>X(t),class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},m(H(t)),9,Pt)),64))]),v.value.length?(l(),i("div",Ht,[(l(!0),i(S,null,P(v.value,t=>(l(),i("button",{key:t,type:"button",onClick:h=>X(t),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},m(H(t)),9,Dt))),128))])):b("",!0)]),e("div",Et,[n[13]||(n[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ngày chi tiêu",-1)),e("div",Ut,[e("div",At,[j(e("input",{"onUpdate:modelValue":n[2]||(n[2]=t=>o.date=t),type:"date",max:E.value,class:"form-input"},null,8,It),[[J,o.date]]),e("div",qt,m(d(o.date)),1)]),e("div",jt,[(l(!0),i(S,null,P(Z.value,(t,h)=>(l(),i("button",{key:h,type:"button",onClick:A=>a(t.value),class:K(["px-3 py-1 text-sm rounded-full transition-colors",o.date===t.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"])},m(t.label),11,Lt))),128))]),R.value.length?(l(),i("div",Ot,[n[12]||(n[12]=e("div",{class:"text-sm text-gray-500 mb-1"},"Gần đây:",-1)),e("div",Rt,[(l(!0),i(S,null,P(R.value,t=>(l(),i("button",{key:t,type:"button",onClick:h=>a(t),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},m(d(t)),9,Kt))),128))])])):b("",!0)])]),e("div",Qt,[n[15]||(n[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Người trả",-1)),e("div",Ft,[j(e("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=t=>g.value=t),onFocus:n[4]||(n[4]=t=>w.value=!0),onInput:ge,placeholder:q.value||"Tìm người trả...",class:"form-input"},null,40,Gt),[[J,g.value]]),e("span",Xt,[Q(I(_t),{class:"h-5 w-5 text-gray-400"})]),V.value&&!q.value?(l(),i("button",{key:0,type:"button",onClick:n[5]||(n[5]=t=>D(V.value.id)),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm text-green-600 hover:text-green-700"}," Tôi trả ")):b("",!0)]),w.value?(l(),i("div",{key:0,class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",onBlur:n[6]||(n[6]=t=>w.value=!1)},[C.value.length&&!g.value?(l(),i("div",zt,[n[14]||(n[14]=e("div",{class:"text-xs font-medium text-gray-500 mb-2"},"Thường xuyên",-1)),e("div",Wt,[(l(!0),i(S,null,P(C.value,t=>{var h;return l(),i("button",{key:t.id,onClick:A=>D(t.id),class:"flex items-center w-full px-3 py-2 text-sm rounded-md hover:bg-gray-100"},[Q(I(ae),{class:"h-5 w-5 text-gray-400 mr-2"}),e("span",null,m(t.name),1),t.id===((h=V.value)==null?void 0:h.id)?(l(),i("span",Yt,"(Tôi)")):b("",!0)],8,Zt)}),128))])])):b("",!0),e("div",Jt,[M.value.length?(l(),i("div",en,[(l(!0),i(S,null,P(M.value,t=>{var h;return l(),i("button",{key:t.id,onClick:A=>D(t.id),class:K(["flex items-center w-full px-3 py-2 text-sm hover:bg-gray-100",{"bg-green-50":o.payer===t.id}])},[Q(I(ae),{class:"h-5 w-5 text-gray-400 mr-2"}),e("div",nn,[e("span",null,m(t.name),1),t.email?(l(),i("span",sn,m(t.email),1)):b("",!0)]),t.id===((h=V.value)==null?void 0:h.id)?(l(),i("span",on,"(Tôi)")):b("",!0)],10,tn)}),128))])):g.value?(l(),i("div",an," Không tìm thấy kết quả ")):b("",!0)])],32)):b("",!0),q.value?(l(),i("div",rn,[Q(I(ae),{class:"h-4 w-4 mr-1"}),Ce(" "+m(q.value)+" ",1),e("button",{onClick:te,class:"ml-2 text-gray-400 hover:text-gray-600"},[Q(I(kt),{class:"h-4 w-4"})])])):b("",!0)]),e("div",ln,[e("div",null,[n[16]||(n[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Người tham gia",-1)),e("div",dn,[e("button",{type:"button",onClick:ve,class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200"}," Chọn tất cả "),V.value?(l(),i("button",{key:0,type:"button",onClick:ye,class:K(["px-3 py-1 text-sm rounded-full",fe.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"])}," Tôi tham gia ",2)):b("",!0)]),e("div",un,[(l(!0),i(S,null,P(I(y),t=>(l(),i("label",{key:t.id,class:K(["flex items-center p-2 rounded-md cursor-pointer hover:bg-gray-50",o.participants.includes(t.name)&&"bg-green-50"])},[j(e("input",{type:"checkbox",value:t.name,"onUpdate:modelValue":n[7]||(n[7]=h=>o.participants=h),class:"h-4 w-4 text-green-600 rounded border-gray-300"},null,8,cn),[[Be,o.participants]]),e("span",mn,m(t.name),1)],2))),128))])]),e("div",null,[n[20]||(n[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Cách chia tiền",-1)),o.payer?(l(),i("div",gn,[e("label",hn,[j(e("input",{type:"radio","onUpdate:modelValue":n[8]||(n[8]=t=>z.value=t),value:"equal",class:"h-4 w-4 text-green-600"},null,512),[[ue,z.value]]),n[17]||(n[17]=e("span",{class:"ml-2 text-sm"},"Chia đều cho tất cả",-1))]),e("label",vn,[j(e("input",{type:"radio","onUpdate:modelValue":n[9]||(n[9]=t=>z.value=t),value:"payerFree",class:"h-4 w-4 text-green-600"},null,512),[[ue,z.value]]),n[18]||(n[18]=e("span",{class:"ml-2 text-sm"},"Người trả không phải trả",-1))]),o.participants.length?(l(),i("div",fn,[n[19]||(n[19]=e("div",{class:"text-sm text-gray-600 mb-2"}," Mỗi người sẽ trả: ",-1)),(l(!0),i(S,null,P(ie.value,(t,h)=>(l(),i("div",{key:h,class:"flex justify-between text-sm"},[e("span",null,m(h),1),e("span",yn,m(H(t)),1)]))),128))])):b("",!0)])):(l(),i("div",pn," Vui lòng chọn người trả trước khi chia tiền "))])]),e("div",xn,[e("button",{type:"button",onClick:L,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",bn,m(B.value?"Cập nhật":"Thêm"),1)])])],32)],2))}}),kn=pe(_n,[["__scopeId","data-v-d361568e"]]),wn="52",Cn=[{name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",short_name:"VietinBank",supported:!0},{name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",short_name:"Vietcombank",supported:!0},{name:"Ngân hàng TMCP Quân đội",code:"MB",bin:"970422",short_name:"MBBank",supported:!0},{name:"Ngân hàng TMCP Á Châu",code:"ACB",bin:"970416",short_name:"ACB",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thịnh Vượng",code:"VPB",bin:"970432",short_name:"VPBank",supported:!0},{name:"Ngân hàng TMCP Tiên Phong",code:"TPB",bin:"970423",short_name:"TPBank",supported:!0},{name:"Ngân hàng TMCP Hàng Hải",code:"MSB",bin:"970426",short_name:"MSB",supported:!0},{name:"Ngân hàng TMCP Nam Á",code:"NAB",bin:"970428",short_name:"NamABank",supported:!1},{name:"Ngân hàng TMCP Bưu Điện Liên Việt",code:"LPB",bin:"970449",short_name:"LienVietPostBank",supported:!0},{name:"Ngân hàng TMCP Bản Việt",code:"VCCB",bin:"970454",short_name:"VietCapitalBank",supported:!0},{name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",short_name:"BIDV",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Thương Tín",code:"STB",bin:"970403",short_name:"Sacombank",supported:!0},{name:"Ngân hàng TMCP Quốc tế Việt Nam",code:"VIB",bin:"970441",short_name:"VIB",supported:!0},{name:"Ngân hàng TMCP Phát triển Thành phố Hồ Chí Minh",code:"HDB",bin:"970437",short_name:"HDBank",supported:!0},{name:"Ngân hàng TMCP Đông Nam Á",code:"SEAB",bin:"970440",short_name:"SeABank",supported:!0},{name:"Ngân hàng Thương mại TNHH MTV Dầu Khí Toàn Cầu",code:"GPB",bin:"970408",short_name:"GPBank",supported:!1},{name:"Ngân hàng TMCP Đại Chúng Việt Nam",code:"PVCB",bin:"970412",short_name:"PVcomBank",supported:!1},{name:"Ngân hàng TMCP Quốc Dân",code:"NCB",bin:"970419",short_name:"NCB",supported:!1},{name:"Ngân hàng TNHH MTV Shinhan Việt Nam",code:"SHBVN",bin:"970424",short_name:"ShinhanBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn",code:"SCB",bin:"970429",short_name:"SCB",supported:!1},{name:"Ngân hàng TMCP Xăng dầu Petrolimex",code:"PGB",bin:"970430",short_name:"PGBank",supported:!1},{name:"Ngân hàng Nông nghiệp và Phát triển Nông thôn Việt Nam",code:"VBA",bin:"970405",short_name:"Agribank",supported:!0},{name:"Ngân hàng TMCP Kỹ thương Việt Nam",code:"TCB",bin:"970407",short_name:"Techcombank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Công Thương",code:"SGICB",bin:"970400",short_name:"SaigonBank",supported:!1},{name:"Ngân hàng TMCP Đông Á",code:"DOB",bin:"970406",short_name:"DongABank",supported:!1},{name:"Ngân hàng TMCP Bắc Á",code:"BAB",bin:"970409",short_name:"BacABank",supported:!0},{name:"Ngân hàng TNHH MTV Standard Chartered Bank Việt Nam",code:"SCVN",bin:"970410",short_name:"StandardChartered",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Đại Dương",code:"Oceanbank",bin:"970414",short_name:"Oceanbank",supported:!1},{name:"Ngân hàng Liên doanh Việt - Nga",code:"VRB",bin:"970421",short_name:"VRB",supported:!1},{name:"Ngân hàng TMCP An Bình",code:"ABB",bin:"970425",short_name:"ABBANK",supported:!0},{name:"Ngân hàng TMCP Việt Á",code:"VAB",bin:"970427",short_name:"VietABank",supported:!1},{name:"Ngân hàng TMCP Xuất Nhập khẩu Việt Nam",code:"EIB",bin:"970431",short_name:"Eximbank",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thương Tín",code:"VIETBANK",bin:"970433",short_name:"VietBank",supported:!1},{name:"Ngân hàng TNHH Indovina",code:"IVB",bin:"970434",short_name:"IndovinaBank",supported:!1},{name:"Ngân hàng TMCP Bảo Việt",code:"BVB",bin:"970438",short_name:"BaoVietBank",supported:!1},{name:"Ngân hàng TNHH MTV Public Việt Nam",code:"PBVN",bin:"970439",short_name:"PublicBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn - Hà Nội",code:"SHB",bin:"970443",short_name:"SHB",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Xây dựng Việt Nam",code:"CBB",bin:"970444",short_name:"CBBank",supported:!1},{name:"Ngân hàng TMCP Phương Đông",code:"OCB",bin:"970448",short_name:"OCB",supported:!0},{name:"Ngân hàng TMCP Kiên Long",code:"KLB",bin:"970452",short_name:"KienLongBank",supported:!0},{name:"Ngân hàng TNHH MTV CIMB Việt Nam",code:"CIMB",bin:"422589",short_name:"CIMB",supported:!1},{name:"Ngân hàng TNHH MTV HSBC (Việt Nam)",code:"HSBC",bin:"458761",short_name:"HSBC",supported:!1},{name:"DBS Bank Ltd - Chi nhánh Thành phố Hồ Chí Minh",code:"DBS",bin:"796500",short_name:"DBSBank",supported:!1},{name:"Ngân hàng Nonghyup - Chi nhánh Hà Nội",code:"NHB HN",bin:"801011",short_name:"Nonghyup",supported:!1},{id:13,name:"Ngân hàng TNHH MTV Hong Leong Việt Nam",code:"HLBVN",bin:"970442",short_name:"HongLeong",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh Hà Nội",code:"IBK - HN",bin:"970455",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh TP. Hồ Chí Minh",code:"IBK - HCM",bin:"970456",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng TNHH MTV Woori Việt Nam",code:"WVN",bin:"970457",short_name:"Woori",supported:!1},{name:"Ngân hàng United Overseas - Chi nhánh TP. Hồ Chí Minh",code:"UOB",bin:"970458",short_name:"UnitedOverseas",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Hà Nội",code:"KBHN",bin:"970462",short_name:"KookminHN",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Thành phố Hồ Chí Minh",code:"KBHCM",bin:"970463",short_name:"KookminHCM",supported:!1},{name:"Ngân hàng Hợp tác xã Việt Nam",code:"COOPBANK",bin:"970446",short_name:"COOPBANK",supported:!1}],Nn={no_banks:wn,data:Cn},Bn=()=>{const T=_([]),f=_(!1),k=_(null);return{banks:T,loading:f,error:k,fetchBanks:async()=>{f.value=!0,k.value=null;try{T.value=Nn.data.map(p=>({code:p.code,name:p.name,shortName:p.short_name,bin:p.bin}))}catch(p){k.value=p,console.error("Error loading banks:",p)}finally{f.value=!1}}}},$n={class:"p-4 sm:p-6"},Tn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mn={class:"relative"},Vn=["value"],Sn={key:0,class:"absolute right-2 top-1/2 -translate-y-1/2"},Pn={key:0,class:"mt-1 text-sm text-red-600"},Hn={class:"mt-4 flex justify-end space-x-3"},Dn={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},En={class:"hidden sm:block overflow-x-auto"},Un={class:"min-w-full divide-y divide-gray-200"},An={class:"bg-white divide-y divide-gray-200"},In={class:"px-6 py-4 whitespace-nowrap"},qn={class:"px-6 py-4 whitespace-nowrap"},jn={class:"px-6 py-4 whitespace-nowrap"},Ln={class:"px-6 py-4 whitespace-nowrap text-right"},On=["onClick"],Rn=["onClick"],Kn={class:"sm:hidden space-y-4"},Qn={class:"flex justify-between items-start mb-3"},Fn={class:"font-medium"},Gn={class:"flex space-x-2"},Xn=["onClick"],zn=["onClick"],Wn={class:"space-y-2 text-sm"},Zn={class:"grid grid-cols-2"},Yn={class:"grid grid-cols-2"},Jn=ne({__name:"UserManagement",setup(T){const f=oe(),{users:k}=se(f),y=_(null),p=_({name:"",account_number:"",bank:""}),{banks:x,loading:N,error:B,fetchBanks:o}=Bn(),E=c=>{const r=x.value.find(v=>v.code===c);return r?r.name:c},G=async()=>{try{const c=F();if(y.value){const{error:r}=await c.from("users").update(p.value).eq("id",y.value);if(r)throw r}else{const{error:r}=await c.from("users").insert([p.value]);if(r)throw r}await f.refreshUsers(),O()}catch(c){console.error("Error saving user:",c)}},U=c=>{y.value=c.id,p.value={...c}},L=async c=>{if(confirm("Bạn có chắc chắn muốn xóa người dùng này?"))try{const{error:r}=await F().from("users").delete().eq("id",c);if(r)throw r;await f.refreshUsers()}catch(r){console.error("Error deleting user:",r)}},O=()=>{y.value=null,p.value={name:"",account_number:"",bank:""}};return ee(()=>{o()}),(c,r)=>(l(),i("div",$n,[r[11]||(r[11]=e("h2",{class:"text-xl sm:text-2xl font-bold mb-4"},"Quản lý người dùng",-1)),e("form",{onSubmit:me(G,["prevent"]),class:"mb-6"},[e("div",Tn,[e("div",null,[r[3]||(r[3]=e("label",{class:"block text-sm font-medium text-gray-700"},"Tên",-1)),j(e("input",{"onUpdate:modelValue":r[0]||(r[0]=v=>p.value.name=v),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},null,512),[[J,p.value.name]])]),e("div",null,[r[4]||(r[4]=e("label",{class:"block text-sm font-medium text-gray-700"},"Số tài khoản",-1)),j(e("input",{"onUpdate:modelValue":r[1]||(r[1]=v=>p.value.account_number=v),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},null,512),[[J,p.value.account_number]])]),e("div",null,[r[7]||(r[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Ngân hàng",-1)),e("div",Mn,[j(e("select",{"onUpdate:modelValue":r[2]||(r[2]=v=>p.value.bank=v),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},[r[5]||(r[5]=e("option",{value:""},"Chọn ngân hàng",-1)),(l(!0),i(S,null,P(I(x),v=>(l(),i("option",{key:v.code,value:v.code},m(v.name),9,Vn))),128))],512),[[$e,p.value.bank]]),I(N)?(l(),i("div",Sn,r[6]||(r[6]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)]))):b("",!0)]),I(B)?(l(),i("p",Pn," Không thể tải danh sách ngân hàng. Vui lòng thử lại sau. ")):b("",!0)])]),e("div",Hn,[e("button",{type:"button",onClick:O,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",Dn,m(y.value?"Cập nhật":"Thêm"),1)])],32),e("div",En,[e("table",Un,[r[8]||(r[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Số tài khoản"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ngân hàng"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])],-1)),e("tbody",An,[(l(!0),i(S,null,P(I(k),v=>(l(),i("tr",{key:v.id},[e("td",In,m(v.name),1),e("td",qn,m(v.account_number),1),e("td",jn,m(v.bank+" - "+E(v.bank)),1),e("td",Ln,[e("button",{onClick:H=>U(v),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Sửa ",8,On),e("button",{onClick:H=>L(v.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,Rn)])]))),128))])])]),e("div",Kn,[(l(!0),i(S,null,P(I(k),v=>(l(),i("div",{key:v.id,class:"bg-white rounded-lg border p-4"},[e("div",Qn,[e("div",Fn,m(v.name),1),e("div",Gn,[e("button",{onClick:H=>U(v),class:"text-sm text-indigo-600 hover:text-indigo-900"}," Sửa ",8,Xn),e("button",{onClick:H=>L(v.id),class:"text-sm text-red-600 hover:text-red-900"}," Xóa ",8,zn)])]),e("div",Wn,[e("div",Zn,[r[9]||(r[9]=e("div",{class:"text-gray-500"},"Số tài khoản:",-1)),e("div",null,m(v.account_number),1)]),e("div",Yn,[r[10]||(r[10]=e("div",{class:"text-gray-500"},"Ngân hàng:",-1)),e("div",null,m(v.bank+" - "+E(v.bank)),1)])])]))),128))])]))}}),es={},ts={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},ns={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},ss={class:"sticky top-0 bg-white border-b p-4 flex justify-between items-center"},os={class:"overflow-y-auto"};function as(T,f){return l(),i("div",ts,[e("div",ns,[e("div",ss,[f[2]||(f[2]=e("h2",{class:"text-xl font-bold"},"Quản lý người dùng",-1)),e("button",{onClick:f[0]||(f[0]=k=>T.$emit("close")),class:"p-2 hover:bg-gray-100 rounded-full"},f[1]||(f[1]=[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",os,[Te(T.$slots,"default")])])])}const rs=pe(es,[["render",as]]),ls={class:"min-h-screen bg-green-50"},is={class:"container mx-auto px-4 py-8"},ds={key:0,class:"max-w-md mx-auto"},us={class:"space-y-4"},cs={key:1},ms={key:1,class:"space-y-6"},ps={id:"expense-form"},hs=ne({__name:"index",setup(T){const f=oe(),{users:k}=se(f),y=_([]),p=_(null),x=_(null),N=_(!1),B=async c=>{try{x.value=c,await f.fetchUsers(),await U()}catch(r){console.error("Error in handleRoleSelect:",r)}},o=()=>{try{x.value=null,p.value=null,N.value=!1}catch(c){console.error("Error in changeRole:",c)}},E=async()=>{try{await f.fetchUsers(),N.value=!0}catch(c){console.error("Error in handleShowUserManagement:",c)}},G=()=>{N.value=!1},U=async()=>{try{const{data:c,error:r}=await F().from("expenses").select("*").order("date",{ascending:!1});if(r)throw r;y.value=c}catch(c){console.error("Error loading expenses:",c)}},L=c=>{p.value=c},O=async()=>{await U(),p.value=null};return ee(async()=>{try{await U()}catch(c){console.error("Error in onMounted:",c)}}),(c,r)=>{const v=bt,H=kn,X=Jn,Z=rs;return l(),i("div",ls,[e("div",is,[r[7]||(r[7]=e("h1",{class:"text-4xl font-bold text-center text-green-800 mb-8"},"EzSplit",-1)),x.value?(l(),i("div",cs,[e("div",{class:"flex justify-between items-center mb-6"},[e("button",{type:"button",onClick:o,class:"text-green-600 hover:text-green-700"}," ← Đổi vai trò "),e("button",{type:"button",onClick:E,class:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200"}," Quản lý người dùng ")]),x.value==="payer"?(l(),ce(v,{key:0,expenses:y.value,role:x.value,onRefresh:U},null,8,["expenses","role"])):x.value==="spender"?(l(),i("div",ms,[e("div",ps,[Q(H,{"editing-expense":p.value,expenses:y.value,onSave:O,onCancel:r[2]||(r[2]=R=>p.value=null)},null,8,["editing-expense","expenses"])]),r[6]||(r[6]=e("div",{class:"border-t border-gray-200 my-6"},null,-1)),Q(v,{expenses:y.value,role:x.value,onEdit:L,onRefresh:U},null,8,["expenses","role"])])):b("",!0)])):(l(),i("div",ds,[r[5]||(r[5]=e("h2",{class:"text-xl font-semibold mb-6 text-center"},"Bạn là...",-1)),e("div",us,[e("button",{onClick:r[0]||(r[0]=R=>B("payer")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},r[3]||(r[3]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người trả tiền 💰",-1),e("p",{class:"text-gray-600 mt-2"},"Xem danh sách các khoản cần thanh toán",-1)])),e("button",{onClick:r[1]||(r[1]=R=>B("spender")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},r[4]||(r[4]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người chi tiền 📝",-1),e("p",{class:"text-gray-600 mt-2"},"Tạo và quản lý các khoản chi tiêu",-1)]))])])),N.value?(l(),ce(Z,{key:2,onClose:G},{default:Me(()=>[Q(X)]),_:1})):b("",!0),r[8]||(r[8]=e("footer",{class:"text-center mt-8 text-sm text-gray-600"},[e("p",null,"Made with ♥️ by abner"),e("p",null,"© 2025 EzSplit. All rights reserved.")],-1))])])}}});export{hs as default};
