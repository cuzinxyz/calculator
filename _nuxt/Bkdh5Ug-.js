import{a as ye,H as xe,r as w,d as ne,I as se,j as E,o as ee,t as l,v as r,x as e,J as B,K as H,L as A,M as q,y as g,z as U,B as Y,N as j,O as be,P as W,Q as ce,R as me,S as K,T as J,U as de,V as _e,W as ke,_ as ge,X as we,Y as Ce,F as $e,Z as Ne,A as ue,$ as Be}from"./C3U66f4-.js";const X=()=>ye().$supabase.client,oe=xe("users",()=>{const T=w([]),h=w(!1),_=w(null),p=w(!1),v=async()=>{if(!h.value){h.value=!0,_.value=null;try{const{data:k,error:f}=await X().from("users").select("*").order("name");if(f)throw f;T.value=k,p.value=!0}catch(k){_.value=k,console.error("Error loading users:",k)}finally{h.value=!1}}};return{users:T,loading:h,error:_,fetchUsers:v,refreshUsers:async()=>{p.value=!1,await v()}}}),Te={class:"bg-white rounded-lg shadow px-4 py-8"},Pe={key:0,class:"space-y-4"},Me={key:1,class:"text-center py-8 text-gray-500"},Ve={key:2,class:"relative"},Se={key:0,class:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg z-10"},He={class:"space-y-4"},De={class:"font-medium mb-2"},Ee={class:"space-y-2 text-sm"},Ae={class:"grid grid-cols-2"},Ue={class:"grid grid-cols-2"},Le={class:"grid grid-cols-2"},Ie={key:3,class:"mt-4 flex justify-center space-x-2"},je=["disabled"],qe=["disabled"],Re=ne({__name:"ExpenseList",props:{expenses:{},currentPage:{},totalItems:{},itemsPerPage:{},loading:{type:Boolean}},emits:["pageChange"],setup(T,{emit:h}){const _=T,p=h,v=oe(),{users:M}=se(v),k=E(()=>Math.ceil(_.totalItems/_.itemsPerPage));ee(()=>{console.log("ExpenseList mounted with props:",_)});const f=x=>new Date(x).toLocaleDateString("vi-VN"),o=x=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(x),D=x=>{const $=M.value.find(N=>N.id===x);return($==null?void 0:$.name)||"Unknown"},L=()=>{!_.loading&&_.currentPage<k.value&&p("pageChange",_.currentPage+1)},I=()=>{!_.loading&&_.currentPage>1&&p("pageChange",_.currentPage-1)};return(x,$)=>(r(),l("div",Te,[$[4]||($[4]=e("h2",{class:"text-xl font-bold mb-6"},"Lịch sử chi tiêu",-1)),x.loading&&!x.expenses.length?(r(),l("div",Pe,[(r(!0),l(H,null,A(x.itemsPerPage,N=>(r(),l("div",{key:N,class:"animate-pulse bg-gray-100 h-16 rounded-lg"}))),128))])):x.expenses.length?(r(),l("div",Ve,[x.loading&&x.expenses.length?(r(),l("div",Se,$[0]||($[0]=[e("div",{class:"flex items-center space-x-2"},[e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0s"}}),e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0.2s"}}),e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0.4s"}})],-1)]))):B("",!0),e("div",He,[(r(!0),l(H,null,A(x.expenses,N=>(r(),l("div",{key:N.id,class:"bg-white rounded-lg border p-4"},[e("div",De,g(N.title),1),e("div",Ee,[e("div",Ae,[$[1]||($[1]=e("div",{class:"text-gray-500"},"Thời gian:",-1)),e("div",null,g(f(N.date)),1)]),e("div",Ue,[$[2]||($[2]=e("div",{class:"text-gray-500"},"Tổng tiền:",-1)),e("div",null,g(o(N.amount)),1)]),e("div",Le,[$[3]||($[3]=e("div",{class:"text-gray-500"},"Người đã thanh toán:",-1)),e("div",null,g(D(N.payer)),1)])])]))),128))])])):(r(),l("div",Me," Chưa có khoản chi tiêu nào được ghi nhận ")),k.value>1?(r(),l("div",Ie,[e("button",{onClick:I,disabled:x.currentPage===1||x.loading,class:q(["px-3 py-1 rounded-md text-sm",[x.currentPage===1||x.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Trang trước ",10,je),e("button",{onClick:L,disabled:x.currentPage===k.value||x.loading,class:q(["px-3 py-1 rounded-md text-sm",[x.currentPage===k.value||x.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Trang sau ",10,qe)])):B("",!0)]))}});function Oe(T,h){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function Ke(T,h){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function Fe(T,h){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function re(T,h){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function Qe(T,h){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}function he(T,h){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const ze={class:"bg-white rounded-lg shadow p-6"},Ge={class:"text-xl font-bold mb-6 inline-flex items-center gap-1"},Xe={class:"space-y-10"},Ze={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},We={class:"font-medium"},Ye={class:"text-xs text-gray-400"},Je={class:"space-y-4"},et={class:"flex flex-col sm:hidden"},tt={class:"flex items-center space-x-2 mb-2"},nt={class:"font-medium"},st={class:"font-medium"},ot={class:"text-lg font-medium text-green-600 mb-3"},at={class:"flex flex-col space-y-2"},rt=["onClick","disabled"],lt={key:0},it=["onClick"],dt={class:"hidden sm:flex sm:justify-between sm:items-center"},ut={class:"font-medium"},ct={class:"font-medium"},mt={class:"ml-2"},gt={class:"flex items-center space-x-2"},ht=["onClick","disabled"],pt={key:0},vt=["onClick"],ft={key:0,class:"text-sm text-gray-500 mt-2"},yt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 !m-0"},xt={class:"bg-white rounded-lg shadow-xl w-full max-w-sm"},bt={class:"p-4"},_t=["src"],kt={class:"p-6 border-t bg-gray-50"},wt={class:"flex flex-col sm:flex-row gap-3"},Ct=ne({__name:"ExpenseSummary",setup(T,{expose:h}){const _=oe(),{users:p}=se(_),v=w(""),M=w(!1),k=w([]),f=w(new Set),o=w([]),D=T,L=async()=>{try{const u=X(),{data:c,error:a}=await u.from("expenses").select("*").order("date",{ascending:!1});if(a)throw a;o.value=c||[]}catch(u){console.error("Error loading all expenses:",u)}},I=E(()=>{var c,a;if(!((c=p.value)!=null&&c.length)||!((a=o.value)!=null&&a.length))return{};const u=Object.fromEntries(p.value.map(m=>[m.id,0]));return o.value.forEach(m=>{const C=m.participants.length;if(C===0)return;const G=m.amount/C;u[m.payer]+=m.amount,m.participants.forEach(S=>{const P=p.value.find(Q=>Q.name===S);P&&(u[P.id]-=G)})}),u}),x=E(()=>{const u=I.value;if(!Object.keys(u).length)return[];const c=[],a=[];Object.entries(u).forEach(([S,P])=>{P<0?c.push({id:S,amount:-P}):P>0&&a.push({id:S,amount:P})}),c.sort((S,P)=>P.amount-S.amount),a.sort((S,P)=>P.amount-S.amount);const m=[];let C=0,G=0;for(;C<c.length&&G<a.length;){const S=c[C],P=a[G],Q=Math.min(S.amount,P.amount),O=k.value.find(ae=>ae.from_user===S.id&&ae.to_user===P.id);m.push({from:S.id,to:P.id,amount:Math.round(Q),fromName:i(S.id),toName:i(P.id),completed:(O==null?void 0:O.completed)||!1,completed_at:(O==null?void 0:O.completed_at)||null,id:O==null?void 0:O.id}),S.amount-=Q,P.amount-=Q,S.amount<.01&&C++,P.amount<.01&&G++}return m}),$=u=>{v.value=N(u),M.value=!0},N=u=>{const c=p.value.find(C=>C.id===u.to),a=p.value.find(C=>C.id===u.from);if(!c||!a)return"";const m=`${a.name} ck ${c.name} tien ${D.expenses.map(C=>C.title).join(" ")}`;return`https://qr.sepay.vn/img?acc=${c.account_number}&bank=${c.bank}&amount=${u.amount}&des=${encodeURIComponent(m)}&template=compact&download=false`},z=async u=>{if(f.value.has(u.id||`${u.from}-${u.to}`))return;const c=u.id||`${u.from}-${u.to}`;f.value.add(c);const a=X();try{if(u.id){const{error:m}=await a.from("transactions").update({completed:!u.completed,completed_at:u.completed?null:new Date().toISOString()}).eq("id",u.id);if(m)throw m}else{const{error:m}=await a.from("transactions").insert([{from_user:u.from,to_user:u.to,amount:u.amount,completed:!0,completed_at:new Date().toISOString()}]);if(m)throw m}await F()}catch(m){console.error("Error updating transaction:",m)}finally{f.value.delete(c)}},F=async()=>{try{const{data:u,error:c}=await X().from("transactions").select("*");if(c)throw c;k.value=u}catch(u){console.error("Error loading transactions:",u)}},R=u=>u?new Date(u).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",y=()=>{const u=new URL(v.value);u.searchParams.set("download","true"),window.location.href=u.toString()};ee(async()=>{var u;(u=p.value)!=null&&u.length||await _.fetchUsers(),await Promise.all([L(),F()])});const d=async()=>{await Promise.all([L(),F()])},i=u=>{const c=p.value.find(a=>a.id===u);return(c==null?void 0:c.name)||"Unknown"},V=u=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(u);return h({refreshData:d}),(u,c)=>(r(),l(H,null,[e("div",ze,[e("h2",Ge,[U(j(Oe),{class:"h-8 w-8 text-green-500"}),c[1]||(c[1]=Y(" Tổng kết và thanh toán "))]),e("div",Xe,[e("div",null,[c[2]||(c[2]=e("h3",{class:"text-md font-semibold mb-2"},"Số tiền cần thanh toán",-1)),e("div",Ze,[(r(!0),l(H,null,A(I.value,(a,m)=>(r(),l("div",{key:m,class:"bg-gray-50 p-3 rounded-lg flex justify-between items-center"},[e("span",We,g(i(m)),1),e("span",{class:q(["font-medium",a<0?"text-red-500":"text-green-500"])},[e("span",Ye,g(a<0?"(cần trả)":"(được nhận)"),1),Y(" "+g(V(a)),1)],2)]))),128))])]),e("div",null,[c[5]||(c[5]=e("h3",{class:"text-md font-semibold mb-2"},"Các khoản cần thanh toán",-1)),e("div",Je,[(r(!0),l(H,null,A(x.value,a=>(r(),l("div",{key:a.id||`${a.from}-${a.to}-${a.amount}`,class:q(["border p-4 rounded-lg transition-colors duration-200",a.completed?"bg-gray-100":"bg-white"])},[e("div",et,[e("div",tt,[e("span",nt,g(a.fromName),1),c[3]||(c[3]=e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 8l4 4m0 0l-4 4m4-4H3"})],-1)),e("span",st,g(a.toName),1)]),e("div",ot,g(V(a.amount)),1),e("div",at,[e("button",{onClick:m=>z(a),disabled:f.value.has(a.id||`${a.from}-${a.to}`),class:q(["w-full py-2 px-3 rounded-md text-sm font-medium transition-colors duration-200",f.value.has(a.id||`${a.from}-${a.to}`)?"bg-gray-300 cursor-not-allowed":a.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[Y(g(a.completed?"Đã hoàn thành":"Xác nhận đã chuyển khoản")+" ",1),f.value.has(a.id||`${a.from}-${a.to}`)?(r(),l("span",lt," ... ")):B("",!0)],10,rt),e("button",{onClick:m=>$(a),class:"w-full py-2 px-3 rounded-md text-sm font-medium bg-green-50 text-green-600"}," Tạo mã QR chuyển khoản ",8,it)])]),e("div",dt,[e("div",null,[e("span",ut,g(a.fromName),1),c[4]||(c[4]=e("span",{class:"mx-2"},"→",-1)),e("span",ct,g(a.toName),1),e("span",mt,g(V(a.amount)),1)]),e("div",gt,[e("button",{onClick:m=>z(a),disabled:f.value.has(a.id||`${a.from}-${a.to}`),class:q(["px-3 py-1 rounded-md text-sm transition-colors duration-200",f.value.has(a.id||`${a.from}-${a.to}`)?"bg-gray-300 cursor-not-allowed":a.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[Y(g(a.completed?"Đã hoàn thành":"Xác nhận đã chuyển khoản")+" ",1),f.value.has(a.id||`${a.from}-${a.to}`)?(r(),l("span",pt," ... ")):B("",!0)],10,ht),e("button",{onClick:m=>$(a),class:"px-3 py-1 rounded-md text-sm bg-green-50 text-green-600"}," Tạo mã QR chuyển khoản ",8,vt)])]),a.completed?(r(),l("div",ft," Đã hoàn thành lúc: "+g(R(a.completed_at)),1)):B("",!0)],2))),128))])])])]),M.value?(r(),l("div",yt,[e("div",xt,[c[8]||(c[8]=e("div",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-bold"},"Mã QR chuyển khoản")],-1)),e("div",bt,[e("img",{src:v.value,alt:"Mã QR chuyển khoản",class:"w-full"},null,8,_t)]),e("div",kt,[e("div",wt,[e("button",{onClick:y,class:"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-2.5 px-4 rounded-xl hover:from-green-600 hover:to-green-700 transform hover:scale-[1.02] transition-all duration-200 shadow-sm hover:shadow flex items-center justify-center gap-2"},c[6]||(c[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),Y(" Tải xuống QR ")])),e("button",{onClick:c[0]||(c[0]=a=>M.value=!1),class:"flex-1 bg-white text-gray-700 py-2.5 px-4 rounded-xl border border-gray-200 hover:bg-gray-50 transform hover:scale-[1.02] transition-all duration-200 shadow-sm hover:shadow flex items-center justify-center gap-2"},c[7]||(c[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Y(" Đóng ")]))])])])])):B("",!0)],64))}}),$t={class:"flex justify-between items-center mb-4"},Nt={class:"text-2xl font-bold"},Bt={key:0,class:"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full"},Tt={class:"space-y-6"},Pt={class:"form-control-group"},Mt={class:"form-control-group"},Vt={class:"relative"},St={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},Ht={class:"mt-4 flex flex-wrap gap-2"},Dt=["onClick"],Et={key:0,class:"mt-2 flex flex-wrap gap-2"},At=["onClick"],Ut={class:"form-control-group"},Lt={class:"space-y-2"},It={class:"relative"},jt=["max"],qt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},Rt={class:"flex flex-wrap gap-2"},Ot=["onClick"],Kt={key:0,class:"mt-2"},Ft={class:"flex flex-wrap gap-2"},Qt=["onClick"],zt={class:"form-control-group relative"},Gt={class:"relative"},Xt=["placeholder"],Zt={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Wt={key:0,class:"p-2"},Yt={class:"space-y-1"},Jt=["onClick"],en={key:0,class:"ml-2 text-xs text-gray-500"},tn={class:"max-h-60 overflow-auto"},nn={key:0,class:"py-1"},sn=["onClick"],on={class:"flex flex-col"},an={key:0,class:"text-xs text-gray-500"},rn={key:0,class:"ml-2 text-xs text-gray-500"},ln={key:1,class:"px-3 py-2 text-sm text-gray-500"},dn={key:1,class:"mt-1 flex items-center text-sm text-gray-500"},un={class:"space-y-4"},cn={class:"flex gap-2 mb-3"},mn={class:"grid grid-cols-2 gap-2"},gn=["value"],hn={class:"ml-2 text-sm"},pn={key:0,class:"p-3 bg-yellow-50 text-yellow-700 rounded-md mb-3"},vn={key:1,class:"space-y-2"},fn={class:"flex items-center"},yn={class:"flex items-center"},xn={key:0,class:"mt-3 p-3 bg-gray-50 rounded-md"},bn={class:"font-medium"},_n={class:"flex justify-end space-x-3"},kn={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},wn=ne({__name:"ExpenseForm",props:{editingExpense:{},expenses:{}},emits:["save","cancel"],setup(T,{emit:h}){const _=oe(),{users:p}=se(_),v=T,M=h,k=w(null),f=w(null),o=be({title:"",amount:0,date:new Date().toISOString().split("T")[0],payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),D=E(()=>new Date().toISOString().split("T")[0]),L=()=>{if(!o.splitEqually){const s=Object.values(o.individualAmounts).reduce((n,t)=>n+(Number(t)||0),0);if(Math.abs(s-o.amount)>.01)return!1}return!0},I=async()=>{if(!o.splitEqually&&!L()){alert("Tổng số tiền chi tiêu cá nhân phải bằng tổng số tiền");return}try{const s={title:o.title,amount:o.amount,date:o.date,payer:o.payer,participants:o.participants,split_equally:o.splitEqually,individual_amounts:o.individualAmounts},n=X();if(f.value){const{error:t}=await n.from("expenses").update(s).eq("id",f.value);if(t)throw t}else{const{error:t}=await n.from("expenses").insert([s]);if(t)throw t}M("save"),x()}catch(s){console.error("Error saving expense:",s)}},x=()=>{f.value=null,Object.assign(o,{title:"",amount:0,date:D.value,payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),M("cancel"),N.value="",a.value="",m.value=!1},$=()=>{k.value&&k.value.scrollIntoView({behavior:"smooth",block:"start"})};W(()=>v.editingExpense,s=>{s&&(f.value=s.id,Object.assign(o,{title:s.title,amount:s.amount,date:s.date||D.value,payer:s.payer,participants:s.participants,splitEqually:s.split_equally,individualAmounts:s.individual_amounts||{}}),ke(()=>{$()}))},{immediate:!0}),ee(async()=>{p.value.length||await _.fetchUsers()});const N=w(""),z=[5e4,1e5,2e5,5e5,1e6],F=E(()=>{const s=parseFloat(N.value);if(!s||isNaN(s))return[];const n=[];if(s<1e3&&n.push(s*1e3),s<1e6){const t=Math.ceil(s/1e3)*1e3;t!==s&&n.push(t)}return s<=100&&n.push(s*1e3,s*1e4),[...new Set(n)].slice(0,3)}),R=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(s),y=s=>{o.amount=s,N.value=s.toString()};W(()=>o.amount,s=>{s!==parseInt(N.value)&&(N.value=s.toString())},{immediate:!0}),W(N,s=>{const n=s.replace(/[^0-9]/g,"");n!==s&&(N.value=n)});const d=E(()=>{const s=new Date,n=new Date(s);n.setDate(n.getDate()-1);const t=new Date(s);return t.setDate(t.getDate()-2),[{label:"Hôm nay",value:V(s)},{label:"Hôm qua",value:V(n)},{label:"Hôm kia",value:V(t)}]}),i=E(()=>{var n;const s=((n=v.expenses)==null?void 0:n.map(t=>t.date).filter(t=>t!==o.date&&t!==D.value).slice(0,3))||[];return[...new Set(s)]}),V=s=>s.toISOString().split("T")[0],u=s=>{if(!s)return"";const n=new Date(s),t=new Date,b=new Date(t);return b.setDate(b.getDate()-1),V(t)===s?"Hôm nay":V(b)===s?"Hôm qua":new Intl.DateTimeFormat("vi-VN",{weekday:"long"}).format(n)},c=s=>{o.date=s},a=w(""),m=w(!1),C=E(()=>_.currentUser),G=E(()=>{const s=a.value.toLowerCase().trim();return s?p.value.filter(n=>{var t;return n.name.toLowerCase().includes(s)||((t=n.email)==null?void 0:t.toLowerCase().includes(s))}):p.value}),S=E(()=>{var n;const s=(n=v.expenses)==null?void 0:n.reduce((t,b)=>(t[b.payer]=(t[b.payer]||0)+1,t),{});return p.value.filter(t=>s[t.id]).sort((t,b)=>s[b.id]-s[t.id]).slice(0,5)}),P=E(()=>{if(!o.payer)return"";const s=p.value.find(n=>n.id===o.payer);return s?s.name:""}),Q=s=>{o.payer=s,a.value="",m.value=!1},O=()=>{o.payer="",a.value=""},ae=()=>{m.value=!0},le=s=>{s.target.closest(".relative")||(m.value=!1)};ee(()=>{document.addEventListener("click",le)}),ce(()=>{document.removeEventListener("click",le)});const pe=()=>{o.participants=p.value.map(s=>s.name)},ve=E(()=>C.value&&o.participants.includes(C.value.name)),fe=()=>{if(!C.value)return;const s=C.value.name;o.participants.includes(s)?o.participants=o.participants.filter(n=>n!==s):o.participants.push(s)};W(()=>o.splitEqually,s=>{s?o.individualAmounts={}:o.participants.forEach(n=>{o.individualAmounts[n]||(o.individualAmounts[n]=0)})}),W(()=>o.participants,s=>{if(!o.splitEqually){const n={...o.individualAmounts};Object.keys(n).forEach(t=>{s.includes(t)||delete n[t]}),s.forEach(t=>{n[t]||(n[t]=0)}),o.individualAmounts=n}},{deep:!0}),W(()=>o.amount,s=>{if(o.splitEqually){const n=Math.round(s/o.participants.length);o.participants.forEach(t=>{o.individualAmounts[t]=n})}});const Z=w("equal"),ie=E(()=>{const s={};if(!o.payer||!o.amount||!o.participants.length)return s;const n=p.value.find(t=>t.id===o.payer);if(!n)return s;if(Z.value==="equal"){const t=Math.round(o.amount/o.participants.length);o.participants.forEach(b=>{s[b]=t})}else if(Z.value==="payerFree"){const t=o.participants.filter(b=>b!==n.name);if(t.length===0)s[n.name]=o.amount;else{const b=Math.round(o.amount/t.length);o.participants.forEach(te=>{s[te]=te===n.name?0:b})}}return s});return W([Z,()=>o.participants,()=>o.amount],()=>{o.individualAmounts={...ie.value}}),(s,n)=>(r(),l("div",{ref_key:"formRef",ref:k,class:q(["bg-white rounded-lg shadow py-8 px-4 transition-all duration-300",f.value?"ring-2 ring-green-500 ring-offset-2":""])},[e("div",$t,[e("h2",Nt,g(f.value?"Chỉnh sửa khoản chi":"Thêm khoản chi mới"),1),f.value?(r(),l("span",Bt," Đang chỉnh sửa ")):B("",!0)]),e("form",{onSubmit:me(I,["prevent"])},[e("div",Tt,[e("div",Pt,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Bạn đã chi tiêu gì?",-1)),K(e("input",{"onUpdate:modelValue":n[0]||(n[0]=t=>o.title=t),type:"text",required:"",placeholder:"VD: Ăn trưa, Cafe, Mua sắm...",class:"form-input"},null,512),[[J,o.title]])]),e("div",Mt,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Bạn đã chi bao nhiêu?",-1)),e("div",Vt,[K(e("input",{"onUpdate:modelValue":n[1]||(n[1]=t=>N.value=t),type:"text",required:"",placeholder:"VD: 50000, 100000, 1000000...",class:"form-input"},null,512),[[J,N.value]]),e("div",St,g(R(o.amount)),1)]),e("div",Ht,[(r(),l(H,null,A(z,t=>e("button",{key:t,type:"button",onClick:b=>y(t),class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},g(R(t)),9,Dt)),64))]),F.value.length?(r(),l("div",Et,[(r(!0),l(H,null,A(F.value,t=>(r(),l("button",{key:t,type:"button",onClick:b=>y(t),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},g(R(t)),9,At))),128))])):B("",!0)]),e("div",Ut,[n[13]||(n[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ngày chi tiêu",-1)),e("div",Lt,[e("div",It,[K(e("input",{"onUpdate:modelValue":n[2]||(n[2]=t=>o.date=t),type:"date",max:D.value,class:"form-input"},null,8,jt),[[J,o.date]]),e("div",qt,g(u(o.date)),1)]),e("div",Rt,[(r(!0),l(H,null,A(d.value,(t,b)=>(r(),l("button",{key:b,type:"button",onClick:te=>c(t.value),class:q(["px-3 py-1 text-sm rounded-full transition-colors",o.date===t.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"])},g(t.label),11,Ot))),128))]),i.value.length?(r(),l("div",Kt,[n[12]||(n[12]=e("div",{class:"text-sm text-gray-500 mb-1"},"Gần đây:",-1)),e("div",Ft,[(r(!0),l(H,null,A(i.value,t=>(r(),l("button",{key:t,type:"button",onClick:b=>c(t),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},g(u(t)),9,Qt))),128))])])):B("",!0)])]),e("div",zt,[n[15]||(n[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ai là người thanh toán?",-1)),e("div",Gt,[K(e("input",{type:"text","onUpdate:modelValue":n[3]||(n[3]=t=>a.value=t),onFocus:n[4]||(n[4]=t=>m.value=!0),onInput:ae,placeholder:P.value||"Tìm tên người thanh toán...",class:"form-input"},null,40,Xt),[[J,a.value]]),e("span",Zt,[U(j(Qe),{class:"h-5 w-5 text-gray-400"})]),C.value&&!P.value?(r(),l("button",{key:0,type:"button",onClick:n[5]||(n[5]=t=>Q(C.value.id)),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm text-green-600 hover:text-green-700"}," Tôi trả ")):B("",!0)]),m.value?(r(),l("div",{key:0,class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",onBlur:n[6]||(n[6]=t=>m.value=!1)},[S.value.length&&!a.value?(r(),l("div",Wt,[n[14]||(n[14]=e("div",{class:"text-xs font-medium text-gray-500 mb-2"},"Thường xuyên",-1)),e("div",Yt,[(r(!0),l(H,null,A(S.value,t=>{var b;return r(),l("button",{key:t.id,onClick:te=>Q(t.id),class:"flex items-center w-full px-3 py-2 text-sm rounded-md hover:bg-gray-100"},[U(j(re),{class:"h-5 w-5 text-gray-400 mr-2"}),e("span",null,g(t.name),1),t.id===((b=C.value)==null?void 0:b.id)?(r(),l("span",en,"(Tôi)")):B("",!0)],8,Jt)}),128))])])):B("",!0),e("div",tn,[G.value.length?(r(),l("div",nn,[(r(!0),l(H,null,A(G.value,t=>{var b;return r(),l("button",{key:t.id,onClick:te=>Q(t.id),class:q(["flex items-center w-full px-3 py-2 text-sm hover:bg-gray-100",{"bg-green-50":o.payer===t.id}])},[U(j(re),{class:"h-5 w-5 text-gray-400 mr-2"}),e("div",on,[e("span",null,g(t.name),1),t.email?(r(),l("span",an,g(t.email),1)):B("",!0)]),t.id===((b=C.value)==null?void 0:b.id)?(r(),l("span",rn,"(Tôi)")):B("",!0)],10,sn)}),128))])):a.value?(r(),l("div",ln," Không tìm thấy kết quả ")):B("",!0)])],32)):B("",!0),P.value?(r(),l("div",dn,[U(j(re),{class:"h-4 w-4 mr-1"}),Y(" "+g(P.value)+" ",1),e("button",{onClick:O,class:"ml-2 text-gray-400 hover:text-gray-600"},[U(j(he),{class:"h-4 w-4"})])])):B("",!0)]),e("div",un,[e("div",null,[n[16]||(n[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Những ai tham gia chi tiêu này?",-1)),e("div",cn,[e("button",{type:"button",onClick:pe,class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200"}," Chọn tất cả mọi người "),C.value?(r(),l("button",{key:0,type:"button",onClick:fe,class:q(["px-3 py-1 text-sm rounded-full",ve.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"])}," Tôi có tham gia ",2)):B("",!0)]),e("div",mn,[(r(!0),l(H,null,A(j(p),t=>(r(),l("label",{key:t.id,class:q(["flex items-center p-2 rounded-md cursor-pointer hover:bg-gray-50",o.participants.includes(t.name)&&"bg-green-50"])},[K(e("input",{type:"checkbox",value:t.name,"onUpdate:modelValue":n[7]||(n[7]=b=>o.participants=b),class:"h-4 w-4 text-green-600 rounded border-gray-300"},null,8,gn),[[_e,o.participants]]),e("span",hn,g(t.name),1)],2))),128))])]),e("div",null,[n[20]||(n[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Cách chia tiền",-1)),o.payer?(r(),l("div",vn,[e("label",fn,[K(e("input",{type:"radio","onUpdate:modelValue":n[8]||(n[8]=t=>Z.value=t),value:"equal",class:"h-4 w-4 text-green-600"},null,512),[[de,Z.value]]),n[17]||(n[17]=e("span",{class:"ml-2 text-sm"},"Chia đều cho tất cả mọi người",-1))]),e("label",yn,[K(e("input",{type:"radio","onUpdate:modelValue":n[9]||(n[9]=t=>Z.value=t),value:"payerFree",class:"h-4 w-4 text-green-600"},null,512),[[de,Z.value]]),n[18]||(n[18]=e("span",{class:"ml-2 text-sm"},"Người thanh toán không phải trả tiền",-1))]),o.participants.length?(r(),l("div",xn,[n[19]||(n[19]=e("div",{class:"text-sm text-gray-600 mb-2"}," Mỗi người sẽ trả: ",-1)),(r(!0),l(H,null,A(ie.value,(t,b)=>(r(),l("div",{key:b,class:"flex justify-between text-sm"},[e("span",null,g(b),1),e("span",bn,g(R(t)),1)]))),128))])):B("",!0)])):(r(),l("div",pn," Vui lòng chọn người trả trước khi chia tiền "))])]),e("div",_n,[e("button",{type:"button",onClick:x,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",kn,g(f.value?"Cập nhật":"Thêm"),1)])])],32)],2))}}),Cn=ge(wn,[["__scopeId","data-v-e454ab00"]]),$n=[{name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",short_name:"VietinBank",supported:!0},{name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",short_name:"Vietcombank",supported:!0},{name:"Ngân hàng TMCP Quân đội",code:"MB",bin:"970422",short_name:"MBBank",supported:!0},{name:"Ngân hàng TMCP Á Châu",code:"ACB",bin:"970416",short_name:"ACB",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thịnh Vượng",code:"VPB",bin:"970432",short_name:"VPBank",supported:!0},{name:"Ngân hàng TMCP Tiên Phong",code:"TPB",bin:"970423",short_name:"TPBank",supported:!0},{name:"Ngân hàng TMCP Hàng Hải",code:"MSB",bin:"970426",short_name:"MSB",supported:!0},{name:"Ngân hàng TMCP Nam Á",code:"NAB",bin:"970428",short_name:"NamABank",supported:!1},{name:"Ngân hàng TMCP Bưu Điện Liên Việt",code:"LPB",bin:"970449",short_name:"LienVietPostBank",supported:!0},{name:"Ngân hàng TMCP Bản Việt",code:"VCCB",bin:"970454",short_name:"VietCapitalBank",supported:!0},{name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",short_name:"BIDV",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Thương Tín",code:"STB",bin:"970403",short_name:"Sacombank",supported:!0},{name:"Ngân hàng TMCP Quốc tế Việt Nam",code:"VIB",bin:"970441",short_name:"VIB",supported:!0},{name:"Ngân hàng TMCP Phát triển Thành phố Hồ Chí Minh",code:"HDB",bin:"970437",short_name:"HDBank",supported:!0},{name:"Ngân hàng TMCP Đông Nam Á",code:"SEAB",bin:"970440",short_name:"SeABank",supported:!0},{name:"Ngân hàng Thương mại TNHH MTV Dầu Khí Toàn Cầu",code:"GPB",bin:"970408",short_name:"GPBank",supported:!1},{name:"Ngân hàng TMCP Đại Chúng Việt Nam",code:"PVCB",bin:"970412",short_name:"PVcomBank",supported:!1},{name:"Ngân hàng TMCP Quốc Dân",code:"NCB",bin:"970419",short_name:"NCB",supported:!1},{name:"Ngân hàng TNHH MTV Shinhan Việt Nam",code:"SHBVN",bin:"970424",short_name:"ShinhanBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn",code:"SCB",bin:"970429",short_name:"SCB",supported:!1},{name:"Ngân hàng TMCP Xăng dầu Petrolimex",code:"PGB",bin:"970430",short_name:"PGBank",supported:!1},{name:"Ngân hàng Nông nghiệp và Phát triển Nông thôn Việt Nam",code:"VBA",bin:"970405",short_name:"Agribank",supported:!0},{name:"Ngân hàng TMCP Kỹ thương Việt Nam",code:"TCB",bin:"970407",short_name:"Techcombank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Công Thương",code:"SGICB",bin:"970400",short_name:"SaigonBank",supported:!1},{name:"Ngân hàng TMCP Đông Á",code:"DOB",bin:"970406",short_name:"DongABank",supported:!1},{name:"Ngân hàng TMCP Bắc Á",code:"BAB",bin:"970409",short_name:"BacABank",supported:!0},{name:"Ngân hàng TNHH MTV Standard Chartered Bank Việt Nam",code:"SCVN",bin:"970410",short_name:"StandardChartered",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Đại Dương",code:"Oceanbank",bin:"970414",short_name:"Oceanbank",supported:!1},{name:"Ngân hàng Liên doanh Việt - Nga",code:"VRB",bin:"970421",short_name:"VRB",supported:!1},{name:"Ngân hàng TMCP An Bình",code:"ABB",bin:"970425",short_name:"ABBANK",supported:!0},{name:"Ngân hàng TMCP Việt Á",code:"VAB",bin:"970427",short_name:"VietABank",supported:!1},{name:"Ngân hàng TMCP Xuất Nhập khẩu Việt Nam",code:"EIB",bin:"970431",short_name:"Eximbank",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thương Tín",code:"VIETBANK",bin:"970433",short_name:"VietBank",supported:!1},{name:"Ngân hàng TNHH Indovina",code:"IVB",bin:"970434",short_name:"IndovinaBank",supported:!1},{name:"Ngân hàng TMCP Bảo Việt",code:"BVB",bin:"970438",short_name:"BaoVietBank",supported:!1},{name:"Ngân hàng TNHH MTV Public Việt Nam",code:"PBVN",bin:"970439",short_name:"PublicBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn - Hà Nội",code:"SHB",bin:"970443",short_name:"SHB",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Xây dựng Việt Nam",code:"CBB",bin:"970444",short_name:"CBBank",supported:!1},{name:"Ngân hàng TMCP Phương Đông",code:"OCB",bin:"970448",short_name:"OCB",supported:!0},{name:"Ngân hàng TMCP Kiên Long",code:"KLB",bin:"970452",short_name:"KienLongBank",supported:!0},{name:"Ngân hàng TNHH MTV CIMB Việt Nam",code:"CIMB",bin:"422589",short_name:"CIMB",supported:!1},{name:"Ngân hàng TNHH MTV HSBC (Việt Nam)",code:"HSBC",bin:"458761",short_name:"HSBC",supported:!1},{name:"DBS Bank Ltd - Chi nhánh Thành phố Hồ Chí Minh",code:"DBS",bin:"796500",short_name:"DBSBank",supported:!1},{name:"Ngân hàng Nonghyup - Chi nhánh Hà Nội",code:"NHB HN",bin:"801011",short_name:"Nonghyup",supported:!1},{id:13,name:"Ngân hàng TNHH MTV Hong Leong Việt Nam",code:"HLBVN",bin:"970442",short_name:"HongLeong",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh Hà Nội",code:"IBK - HN",bin:"970455",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh TP. Hồ Chí Minh",code:"IBK - HCM",bin:"970456",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng TNHH MTV Woori Việt Nam",code:"WVN",bin:"970457",short_name:"Woori",supported:!1},{name:"Ngân hàng United Overseas - Chi nhánh TP. Hồ Chí Minh",code:"UOB",bin:"970458",short_name:"UnitedOverseas",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Hà Nội",code:"KBHN",bin:"970462",short_name:"KookminHN",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Thành phố Hồ Chí Minh",code:"KBHCM",bin:"970463",short_name:"KookminHCM",supported:!1},{name:"Ngân hàng Hợp tác xã Việt Nam",code:"COOPBANK",bin:"970446",short_name:"COOPBANK",supported:!1}],Nn={data:$n},Bn=()=>({banks:w(Nn.data)}),Tn={class:"p-4 sm:p-6"},Pn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mn={class:"mt-4"},Vn={class:"relative"},Sn=["placeholder"],Hn={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Dn={class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg max-h-60 overflow-auto border border-gray-200"},En={key:0,class:"py-1"},An=["onClick"],Un={class:"flex items-center min-w-0 flex-1 mr-2"},Ln={class:"font-medium truncate"},In={class:"text-gray-500 truncate"},jn={key:0,class:"text-green-600 flex-shrink-0"},qn={key:1,class:"px-4 py-2 text-sm text-gray-500 text-center"},Rn={class:"mt-4 flex justify-end space-x-3"},On={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},Kn={class:"hidden sm:block overflow-x-auto"},Fn={class:"min-w-full divide-y divide-gray-200"},Qn={class:"bg-white divide-y divide-gray-200"},zn={class:"px-6 py-4 whitespace-nowrap"},Gn={class:"px-6 py-4 whitespace-nowrap"},Xn={class:"px-6 py-4 whitespace-nowrap"},Zn={class:"px-6 py-4 whitespace-nowrap text-right"},Wn=["onClick"],Yn=["onClick"],Jn={class:"sm:hidden space-y-4"},es={class:"flex justify-between items-start mb-3"},ts={class:"font-medium"},ns={class:"flex space-x-2"},ss=["onClick"],os=["onClick"],as={class:"space-y-2 text-sm"},rs={class:"grid grid-cols-2"},ls={class:"grid grid-cols-2"},is=ne({__name:"UserManagement",setup(T){const h=oe(),{users:_}=se(h),p=w(null),v=w({name:"",account_number:"",bank:""}),{banks:M}=Bn(),k=w(""),f=w(!1),o=E(()=>{const y=k.value.toLowerCase().trim();return y?M.value.filter(d=>d.name.toLowerCase().includes(y)||d.short_name.toLowerCase().includes(y)||d.code.toLowerCase().includes(y)):M.value}),D=E(()=>{if(!v.value.bank)return"";const y=M.value.find(d=>d.code===v.value.bank);return y?`${y.short_name} - ${y.name}`:""}),L=y=>{const d=M.value.find(i=>i.code===y);return d?d.name:y},I=async()=>{try{const y=X();if(p.value){const{error:d}=await y.from("users").update(v.value).eq("id",p.value);if(d)throw d}else{const{error:d}=await y.from("users").insert([v.value]);if(d)throw d}await h.refreshUsers(),N()}catch(y){console.error("Error saving user:",y)}},x=y=>{p.value=y.id,v.value={...y}},$=async y=>{if(confirm("Bạn có chắc chắn muốn xóa người dùng này?"))try{const{error:d}=await X().from("users").delete().eq("id",y);if(d)throw d;await h.refreshUsers()}catch(d){console.error("Error deleting user:",d)}},N=()=>{p.value=null,v.value={name:"",account_number:"",bank:""}},z=y=>{v.value.bank=y.code,k.value="",f.value=!1},F=()=>{v.value.bank="",k.value=""},R=y=>{y.target.closest(".relative")||(f.value=!1)};return ee(()=>{document.addEventListener("click",R)}),ce(()=>{document.removeEventListener("click",R)}),(y,d)=>(r(),l("div",Tn,[e("form",{onSubmit:me(I,["prevent"]),class:"mb-6"},[e("div",Pn,[e("div",null,[d[4]||(d[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tên người nhận",-1)),K(e("input",{"onUpdate:modelValue":d[0]||(d[0]=i=>v.value.name=i),required:"",placeholder:"Nhập tên người nhận tiền",class:"form-input"},null,512),[[J,v.value.name]])]),e("div",null,[d[5]||(d[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Số tài khoản ngân hàng",-1)),K(e("input",{"onUpdate:modelValue":d[1]||(d[1]=i=>v.value.account_number=i),placeholder:"Nhập số tài khoản ngân hàng",class:"form-input"},null,512),[[J,v.value.account_number]])])]),e("div",Mn,[d[7]||(d[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Chọn ngân hàng",-1)),e("div",Vn,[K(e("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=i=>k.value=i),onFocus:d[3]||(d[3]=i=>f.value=!0),placeholder:D.value||"Tìm tên hoặc mã ngân hàng...",class:"form-input pl-10 pr-10 w-full"},null,40,Sn),[[J,k.value]]),e("span",Hn,[U(j(Fe),{class:"h-5 w-5 text-gray-400"})]),v.value.bank?(r(),l("button",{key:0,type:"button",onClick:F,class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600"},[U(j(he),{class:"h-5 w-5"})])):B("",!0),K(e("div",Dn,[o.value.length>0?(r(),l("div",En,[(r(!0),l(H,null,A(o.value,i=>(r(),l("button",{key:i.code,onClick:V=>z(i),class:q(["w-full px-4 py-2 text-sm text-left hover:bg-gray-100 flex items-center justify-between",{"bg-green-50":v.value.bank===i.code}])},[e("div",Un,[e("span",Ln,g(i.short_name),1),d[6]||(d[6]=e("span",{class:"text-gray-500 mx-2"},"-",-1)),e("span",In,g(i.name),1)]),v.value.bank===i.code?(r(),l("span",jn,[U(j(Ke),{class:"h-5 w-5"})])):B("",!0)],10,An))),128))])):(r(),l("div",qn," Không tìm thấy ngân hàng phù hợp "))],512),[[we,f.value]])])]),e("div",Rn,[e("button",{type:"button",onClick:N,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Xóa thông tin "),e("button",On,g(p.value?"Lưu thông tin":"Thêm người nhận"),1)])],32),e("div",Kn,[e("table",Fn,[d[8]||(d[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên người nhận"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Số tài khoản"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ngân hàng"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])],-1)),e("tbody",Qn,[(r(!0),l(H,null,A(j(_),i=>(r(),l("tr",{key:i.id},[e("td",zn,g(i.name),1),e("td",Gn,g(i.account_number),1),e("td",Xn,g(i.bank+" - "+L(i.bank)),1),e("td",Zn,[e("button",{onClick:V=>x(i),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Chỉnh sửa ",8,Wn),e("button",{onClick:V=>$(i.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,Yn)])]))),128))])])]),e("div",Jn,[(r(!0),l(H,null,A(j(_),i=>(r(),l("div",{key:i.id,class:"bg-white rounded-lg border p-4"},[e("div",es,[e("div",ts,g(i.name),1),e("div",ns,[e("button",{onClick:V=>x(i),class:"text-sm text-indigo-600 hover:text-indigo-900"}," Chỉnh sửa ",8,ss),e("button",{onClick:V=>$(i.id),class:"text-sm text-red-600 hover:text-red-900"}," Xóa ",8,os)])]),e("div",as,[e("div",rs,[d[9]||(d[9]=e("div",{class:"text-gray-500"},"Số tài khoản:",-1)),e("div",null,g(i.account_number),1)]),e("div",ls,[d[10]||(d[10]=e("div",{class:"text-gray-500"},"Ngân hàng:",-1)),e("div",null,g(i.bank+" - "+L(i.bank)),1)])])]))),128))])]))}}),ds={},us={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},cs={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},ms={class:"sticky top-0 bg-white border-b p-4 flex justify-between items-center"},gs={class:"overflow-y-auto"};function hs(T,h){return r(),l("div",us,[e("div",cs,[e("div",ms,[h[2]||(h[2]=e("h2",{class:"text-xl font-bold"},"Quản lý người dùng",-1)),e("button",{onClick:h[0]||(h[0]=_=>T.$emit("close")),class:"p-2 hover:bg-gray-100 rounded-full"},h[1]||(h[1]=[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",gs,[Ce(T.$slots,"default")])])])}const ps=ge(ds,[["render",hs]]);function vs(){const T=$e("isLoading");let h=null;const _=()=>{h&&(clearTimeout(h),h=null),T.value=!0},p=()=>{h&&clearTimeout(h),h=setTimeout(()=>{T.value=!1,h=null},800)};return{isLoading:T,showLoading:_,hideLoading:p,withLoading:async M=>{_();try{await Promise.all([M(),new Promise(k=>setTimeout(k,1e3))])}finally{p()}}}}const fs={class:"min-h-screen bg-green-50 flex flex-col"},ys={class:"container mx-auto px-4 py-8 flex-grow"},xs={key:0,class:"max-w-md mx-auto"},bs={class:"space-y-4"},_s={key:0},ks={key:0,class:"max-w-5xl mx-auto space-y-8"},ws={key:1,class:"max-w-5xl mx-auto space-y-8"},$s=ne({__name:"index",setup(T){const h=oe(),{users:_}=se(h),p=w([]),v=w(null),M=w(0),k=w(1),f=w(2),o=w(!1),D=w(!1),L=w(null),I=w(null),{withLoading:x}=vs(),$=async(d=1)=>{console.log("loadExpenses called with page:",d);try{o.value=!0,console.log("Loading started");const i=(d-1)*f.value,V=i+f.value-1;console.log("Fetching range:",i,"to",V);const u=X(),c=u.from("expenses").select("id",{count:"exact",head:!0}),a=u.from("expenses").select(`
        id,
        title,
        amount,
        date,
        payer,
        participants,
        split_equally,
        individual_amounts
      `).order("date",{ascending:!1}).range(i,V),[m,C]=await Promise.all([c,a]);if(m.error)throw m.error;if(C.error)throw C.error;M.value=m.count||0,p.value=C.data||[],k.value=d}catch(i){console.error("Error loading expenses:",i)}finally{o.value=!1,console.log("Loading finished")}},N=async d=>{await x(async()=>{console.log("Role selected:",d);try{_.value.length||await h.fetchUsers(),await new Promise(i=>setTimeout(i,100)),v.value=d,await $(1)}catch(i){console.error("Error in handleRoleSelect:",i)}})},z=async()=>{await $(k.value),I.value&&await I.value.refreshData()},F=()=>{try{v.value=null,L.value&&(L.value=null),D.value=!1}catch(d){console.error("Error in changeRole:",d)}},R=async()=>{try{await h.fetchUsers(),D.value=!0}catch(d){console.error("Error in handleShowUserManagement:",d)}},y=()=>{D.value=!1};return ee(()=>{console.log("Component mounted")}),(d,i)=>{const V=Re,u=Ct,c=Cn,a=is,m=ps;return r(),l("div",fs,[e("div",ys,[i[5]||(i[5]=e("h1",{class:"text-4xl font-bold text-center text-green-800 mb-8"},"EzSplit",-1)),v.value?B("",!0):(r(),l("div",xs,[i[4]||(i[4]=e("h2",{class:"text-xl font-semibold mb-6 text-center"},"Bạn là...",-1)),e("div",bs,[e("button",{onClick:i[0]||(i[0]=C=>N("payer")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},i[2]||(i[2]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người trả tiền 💰",-1),e("p",{class:"text-gray-600 mt-2"},"Xem danh sách các khoản cần thanh toán",-1)])),e("button",{onClick:i[1]||(i[1]=C=>N("spender")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},i[3]||(i[3]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người chi tiền 📝",-1),e("p",{class:"text-gray-600 mt-2"},"Tạo và quản lý các khoản chi tiêu",-1)]))])])),U(Be,{"enter-active-class":"transition-opacity duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-300 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ue(()=>[v.value?(r(),l("div",_s,[e("div",{class:"flex justify-between items-center mb-6"},[e("button",{type:"button",onClick:F,class:"text-green-600 hover:text-green-700"}," ← Đổi vai trò "),e("button",{type:"button",onClick:R,class:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200"}," Quản lý danh sách người tham gia ")]),v.value==="payer"?(r(),l("div",ks,[U(V,{expenses:p.value,"current-page":k.value,"total-items":M.value,"items-per-page":f.value,loading:o.value,onPageChange:$},null,8,["expenses","current-page","total-items","items-per-page","loading"]),U(u,{ref_key:"expenseSummaryRef",ref:I},null,512)])):B("",!0),v.value==="spender"?(r(),l("div",ws,[U(c,{expenses:p.value,onSave:z},null,8,["expenses"]),U(V,{expenses:p.value,"current-page":k.value,"total-items":M.value,"items-per-page":f.value,loading:o.value,onPageChange:$},null,8,["expenses","current-page","total-items","items-per-page","loading"])])):B("",!0)])):B("",!0)]),_:1}),D.value?(r(),Ne(m,{key:1,onClose:y},{default:ue(()=>[U(a)]),_:1})):B("",!0)]),i[6]||(i[6]=e("footer",{class:"text-center py-4 text-sm text-gray-600 bg-green-50"},[e("p",null,"Made with ♥️ by abner"),e("p",null,"© 2025 EzSplit. All rights reserved.")],-1))])}}});export{$s as default};
