import{a as ke,H as we,r as k,d as J,I as ee,j as T,o as W,t as u,v as i,x as e,J as $,K as D,L as E,M as q,y as c,B as ae,N as Ce,O as G,P as ce,Q as me,R as O,S as z,z as L,T as R,U as de,V as Ne,W as $e,_ as pe,X as Be,Y as Te,Z as Pe,A as Me}from"./BRcM5Ygo.js";const X=()=>ke().$supabase.client,te=we("users",()=>{const P=k([]),f=k(!1),y=k(null),h=k(!1),m=async()=>{if(!f.value){f.value=!0,y.value=null;try{const{data:g,error:b}=await X().from("users").select("*").order("name");if(b)throw b;P.value=g,h.value=!0}catch(g){y.value=g,console.error("Error loading users:",g)}finally{f.value=!1}}};return{users:P,loading:f,error:y,fetchUsers:m,refreshUsers:async()=>{h.value=!1,await m()}}}),Ve={class:"bg-white rounded-lg shadow p-6"},Se={key:0,class:"space-y-4"},He={key:1,class:"text-center py-8 text-gray-500"},De={key:2,class:"space-y-4"},Ue={class:"font-medium mb-2"},Ee={class:"space-y-2 text-sm"},Ae={class:"grid grid-cols-2"},Le={class:"grid grid-cols-2"},Ie={class:"grid grid-cols-2"},qe={key:3,class:"mt-4 flex justify-center space-x-2"},je=["disabled"],Oe=["disabled"],Re=J({__name:"ExpenseList",props:{expenses:{},currentPage:{},totalItems:{},itemsPerPage:{},loading:{type:Boolean}},emits:["pageChange"],setup(P,{emit:f}){const y=P,h=f,m=te(),{users:M}=ee(m),g=T(()=>Math.ceil(y.totalItems/y.itemsPerPage));W(()=>{console.log("ExpenseList mounted with props:",y)});const b=x=>new Date(x).toLocaleDateString("vi-VN"),a=x=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(x),S=x=>{const B=M.value.find(_=>_.id===x);return(B==null?void 0:B.name)||"Unknown"},A=()=>{!y.loading&&y.currentPage<g.value&&h("pageChange",y.currentPage+1)},K=()=>{!y.loading&&y.currentPage>1&&h("pageChange",y.currentPage-1)};return(x,B)=>(i(),u("div",Ve,[B[3]||(B[3]=e("h2",{class:"text-xl font-bold mb-6"},"Danh sách chi tiêu",-1)),x.loading?(i(),u("div",Se,[(i(!0),u(D,null,E(x.itemsPerPage,_=>(i(),u("div",{key:_,class:"animate-pulse bg-gray-100 h-16 rounded-lg"}))),128))])):x.expenses.length?(i(),u("div",De,[(i(!0),u(D,null,E(x.expenses,_=>(i(),u("div",{key:_.id,class:"bg-white rounded-lg border p-4"},[e("div",Ue,c(_.title),1),e("div",Ee,[e("div",Ae,[B[0]||(B[0]=e("div",{class:"text-gray-500"},"Ngày:",-1)),e("div",null,c(b(_.date)),1)]),e("div",Le,[B[1]||(B[1]=e("div",{class:"text-gray-500"},"Số tiền:",-1)),e("div",null,c(a(_.amount)),1)]),e("div",Ie,[B[2]||(B[2]=e("div",{class:"text-gray-500"},"Người trả:",-1)),e("div",null,c(S(_.payer)),1)])])]))),128))])):(i(),u("div",He," Không có chi tiêu nào ")),g.value>1?(i(),u("div",qe,[e("button",{onClick:K,disabled:x.currentPage===1||x.loading,class:q(["px-3 py-1 rounded-md text-sm",[x.currentPage===1||x.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Trước ",10,je),e("button",{onClick:A,disabled:x.currentPage===g.value||x.loading,class:q(["px-3 py-1 rounded-md text-sm",[x.currentPage===g.value||x.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Sau ",10,Oe)])):$("",!0)]))}}),Ke={class:"bg-white rounded-lg shadow p-6"},Fe={class:"space-y-10"},Qe={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},Ge={class:"font-medium"},ze={class:"space-y-4"},Xe={class:"flex flex-col sm:hidden"},Ze={class:"flex items-center space-x-2 mb-2"},We={class:"font-medium"},Ye={class:"font-medium"},Je={class:"text-lg font-medium text-green-600 mb-3"},et={class:"flex flex-col space-y-2"},tt=["onClick","disabled"],nt={key:0},st=["onClick"],ot={class:"hidden sm:flex sm:justify-between sm:items-center"},at={class:"font-medium"},rt={class:"font-medium"},lt={class:"ml-2"},it={class:"flex items-center space-x-2"},ut=["onClick","disabled"],dt={key:0},ct=["onClick"],mt={key:0,class:"text-sm text-gray-500 mt-2"},pt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 !m-0"},gt={class:"bg-white rounded-lg shadow-xl w-full max-w-sm"},ht={class:"p-4"},vt=["src"],ft={class:"p-4 border-t grid grid-cols-2 gap-3"},yt=J({__name:"ExpenseSummary",props:{expenses:{}},setup(P){const f=te(),{users:y}=ee(f),h=k(""),m=k(!1),M=k([]),g=k(new Set),b=P,a=l=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(l),S=l=>{const r=y.value.find(n=>n.id===l);return(r==null?void 0:r.name)||"Unknown"},A=T(()=>{var r,n;if(!((r=y.value)!=null&&r.length)||!((n=b.expenses)!=null&&n.length))return{};const l=Object.fromEntries(y.value.map(d=>[d.id,0]));return b.expenses.forEach(d=>{const N=d.participants.length;if(N===0)return;const H=d.amount/N;l[d.payer]+=d.amount,d.participants.forEach(C=>{const w=y.value.find(U=>U.name===C);w&&(l[w.id]-=H)})}),l}),K=T(()=>{const l=A.value;if(!Object.keys(l).length)return[];const r=[],n=[];Object.entries(l).forEach(([C,w])=>{w<0?r.push({id:C,amount:-w}):w>0&&n.push({id:C,amount:w})}),r.sort((C,w)=>w.amount-C.amount),n.sort((C,w)=>w.amount-C.amount);const d=[];let N=0,H=0;for(;N<r.length&&H<n.length;){const C=r[N],w=n[H],U=Math.min(C.amount,w.amount),I=M.value.find(Y=>Y.from_user===C.id&&Y.to_user===w.id);d.push({from:C.id,to:w.id,amount:Math.round(U),fromName:S(C.id),toName:S(w.id),completed:(I==null?void 0:I.completed)||!1,completed_at:(I==null?void 0:I.completed_at)||null,id:I==null?void 0:I.id}),C.amount-=U,w.amount-=U,C.amount<.01&&N++,w.amount<.01&&H++}return d}),x=l=>{h.value=B(l),m.value=!0},B=l=>{const r=y.value.find(N=>N.id===l.to),n=y.value.find(N=>N.id===l.from);if(!r||!n)return"";const d=`${n.name} ck ${r.name} tien ${b.expenses.map(N=>N.title).join(" ")}`;return`https://qr.sepay.vn/img?acc=${r.account_number}&bank=${r.bank}&amount=${l.amount}&des=${encodeURIComponent(d)}&template=compact&download=false`},_=async l=>{if(g.value.has(l.id||`${l.from}-${l.to}`))return;const r=l.id||`${l.from}-${l.to}`;g.value.add(r);const n=X();try{if(l.id){const{error:d}=await n.from("transactions").update({completed:!l.completed,completed_at:l.completed?null:new Date().toISOString()}).eq("id",l.id);if(d)throw d}else{const{error:d}=await n.from("transactions").insert([{from_user:l.from,to_user:l.to,amount:l.amount,completed:!0,completed_at:new Date().toISOString()}]);if(d)throw d}await F()}catch(d){console.error("Error updating transaction:",d)}finally{g.value.delete(r)}},F=async()=>{try{const{data:l,error:r}=await X().from("transactions").select("*");if(r)throw r;M.value=l}catch(l){console.error("Error loading transactions:",l)}},V=l=>l?new Date(l).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",v=()=>{const l=new URL(h.value);l.searchParams.set("download","true"),window.location.href=l.toString()};return W(async()=>{var l;(l=y.value)!=null&&l.length||await f.fetchUsers(),await F()}),(l,r)=>(i(),u(D,null,[e("div",Ke,[r[5]||(r[5]=e("h2",{class:"text-xl font-bold mb-6"},"Kết quả chia tiền",-1)),e("div",Fe,[e("div",null,[r[1]||(r[1]=e("h3",{class:"text-md font-semibold mb-2"},"Tổng kết cá nhân",-1)),e("div",Qe,[(i(!0),u(D,null,E(A.value,(n,d)=>(i(),u("div",{key:d,class:"bg-gray-50 p-3 rounded-lg flex justify-between items-center"},[e("span",Ge,c(S(d)),1),e("span",{class:q(["font-medium",n<0?"text-red-500":"text-green-500"])},c(a(n)),3)]))),128))])]),e("div",null,[r[4]||(r[4]=e("h3",{class:"text-md font-semibold mb-2"},"Giao dịch cần thực hiện",-1)),e("div",ze,[(i(!0),u(D,null,E(K.value,n=>(i(),u("div",{key:n.id||`${n.from}-${n.to}-${n.amount}`,class:q(["border p-4 rounded-lg transition-colors duration-200",n.completed?"bg-gray-100":"bg-white"])},[e("div",Xe,[e("div",Ze,[e("span",We,c(n.fromName),1),r[2]||(r[2]=e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 8l4 4m0 0l-4 4m4-4H3"})],-1)),e("span",Ye,c(n.toName),1)]),e("div",Je,c(a(n.amount)),1),e("div",et,[e("button",{onClick:d=>_(n),disabled:g.value.has(n.id||`${n.from}-${n.to}`),class:q(["w-full py-2 px-3 rounded-md text-sm font-medium transition-colors duration-200",g.value.has(n.id||`${n.from}-${n.to}`)?"bg-gray-300 cursor-not-allowed":n.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[ae(c(n.completed?"Đã chuyển":"Đánh dấu đã chuyển")+" ",1),g.value.has(n.id||`${n.from}-${n.to}`)?(i(),u("span",nt," ... ")):$("",!0)],10,tt),e("button",{onClick:d=>x(n),class:"w-full py-2 px-3 rounded-md text-sm font-medium bg-green-50 text-green-600"}," Tạo QR chuyển tiền ",8,st)])]),e("div",ot,[e("div",null,[e("span",at,c(n.fromName),1),r[3]||(r[3]=e("span",{class:"mx-2"},"→",-1)),e("span",rt,c(n.toName),1),e("span",lt,c(a(n.amount)),1)]),e("div",it,[e("button",{onClick:d=>_(n),disabled:g.value.has(n.id||`${n.from}-${n.to}`),class:q(["px-3 py-1 rounded-md text-sm transition-colors duration-200",g.value.has(n.id||`${n.from}-${n.to}`)?"bg-gray-300 cursor-not-allowed":n.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[ae(c(n.completed?"Đã chuyển":"Đánh dấu đã chuyển")+" ",1),g.value.has(n.id||`${n.from}-${n.to}`)?(i(),u("span",dt," ... ")):$("",!0)],10,ut),e("button",{onClick:d=>x(n),class:"px-3 py-1 rounded-md text-sm bg-green-50 text-green-600"}," Tạo QR chuyển tiền ",8,ct)])]),n.completed?(i(),u("div",mt," Hoàn thành: "+c(V(n.completed_at)),1)):$("",!0)],2))),128))])])])]),m.value?(i(),u("div",pt,[e("div",gt,[r[6]||(r[6]=e("div",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-bold"},"QR Code chuyển khoản")],-1)),e("div",ht,[e("img",{src:h.value,alt:"QR Code",class:"w-full"},null,8,vt)]),e("div",ft,[e("button",{onClick:v,class:"w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700"}," Tải xuống "),e("button",{onClick:r[0]||(r[0]=n=>m.value=!1),class:"w-full bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700"}," Đóng ")])])])):$("",!0)],64))}});function xt(P,f){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function bt(P,f){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function oe(P,f){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function _t(P,f){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}function ge(P,f){return i(),u("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const kt={class:"flex justify-between items-center mb-4"},wt={class:"text-2xl font-bold"},Ct={key:0,class:"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full"},Nt={class:"space-y-6"},$t={class:"form-control-group"},Bt={class:"form-control-group"},Tt={class:"relative"},Pt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},Mt={class:"mt-4 flex flex-wrap gap-2"},Vt=["onClick"],St={key:0,class:"mt-2 flex flex-wrap gap-2"},Ht=["onClick"],Dt={class:"form-control-group"},Ut={class:"space-y-2"},Et={class:"relative"},At=["max"],Lt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},It={class:"flex flex-wrap gap-2"},qt=["onClick"],jt={key:0,class:"mt-2"},Ot={class:"flex flex-wrap gap-2"},Rt=["onClick"],Kt={class:"form-control-group relative"},Ft={class:"relative"},Qt=["placeholder"],Gt={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},zt={key:0,class:"p-2"},Xt={class:"space-y-1"},Zt=["onClick"],Wt={key:0,class:"ml-2 text-xs text-gray-500"},Yt={class:"max-h-60 overflow-auto"},Jt={key:0,class:"py-1"},en=["onClick"],tn={class:"flex flex-col"},nn={key:0,class:"text-xs text-gray-500"},sn={key:0,class:"ml-2 text-xs text-gray-500"},on={key:1,class:"px-3 py-2 text-sm text-gray-500"},an={key:1,class:"mt-1 flex items-center text-sm text-gray-500"},rn={class:"space-y-4"},ln={class:"flex gap-2 mb-3"},un={class:"grid grid-cols-2 gap-2"},dn=["value"],cn={class:"ml-2 text-sm"},mn={key:0,class:"p-3 bg-yellow-50 text-yellow-700 rounded-md mb-3"},pn={key:1,class:"space-y-2"},gn={class:"flex items-center"},hn={class:"flex items-center"},vn={key:0,class:"mt-3 p-3 bg-gray-50 rounded-md"},fn={class:"font-medium"},yn={class:"flex justify-end space-x-3"},xn={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},bn=J({__name:"ExpenseForm",props:{editingExpense:{},expenses:{}},emits:["save","cancel"],setup(P,{emit:f}){const y=te(),{users:h}=ee(y),m=P,M=f,g=k(null),b=k(null),a=Ce({title:"",amount:0,date:new Date().toISOString().split("T")[0],payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),S=T(()=>new Date().toISOString().split("T")[0]),A=()=>{if(!a.splitEqually){const o=Object.values(a.individualAmounts).reduce((s,t)=>s+(Number(t)||0),0);if(Math.abs(o-a.amount)>.01)return!1}return!0},K=async()=>{if(!a.splitEqually&&!A()){alert("Tổng số tiền chi tiêu cá nhân phải bằng tổng số tiền");return}try{const o={title:a.title,amount:a.amount,date:a.date,payer:a.payer,participants:a.participants,split_equally:a.splitEqually,individual_amounts:a.individualAmounts},s=X();if(b.value){const{error:t}=await s.from("expenses").update(o).eq("id",b.value);if(t)throw t}else{const{error:t}=await s.from("expenses").insert([o]);if(t)throw t}M("save"),x()}catch(o){console.error("Error saving expense:",o)}},x=()=>{b.value=null,Object.assign(a,{title:"",amount:0,date:S.value,payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),M("cancel"),_.value="",C.value="",w.value=!1},B=()=>{g.value&&g.value.scrollIntoView({behavior:"smooth",block:"start"})};G(()=>m.editingExpense,o=>{o&&(b.value=o.id,Object.assign(a,{title:o.title,amount:o.amount,date:o.date||S.value,payer:o.payer,participants:o.participants,splitEqually:o.split_equally,individualAmounts:o.individual_amounts||{}}),$e(()=>{B()}))},{immediate:!0}),W(async()=>{h.value.length||await y.fetchUsers()});const _=k(""),F=[5e4,1e5,2e5,5e5,1e6],V=T(()=>{const o=parseFloat(_.value);if(!o||isNaN(o))return[];const s=[];if(o<1e3&&s.push(o*1e3),o<1e6){const t=Math.ceil(o/1e3)*1e3;t!==o&&s.push(t)}return o<=100&&s.push(o*1e3,o*1e4),[...new Set(s)].slice(0,3)}),v=o=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(o),l=o=>{a.amount=o,_.value=o.toString()};G(()=>a.amount,o=>{o!==parseInt(_.value)&&(_.value=o.toString())},{immediate:!0}),G(_,o=>{const s=o.replace(/[^0-9]/g,"");s!==o&&(_.value=s)});const r=T(()=>{const o=new Date,s=new Date(o);s.setDate(s.getDate()-1);const t=new Date(o);return t.setDate(t.getDate()-2),[{label:"Hôm nay",value:d(o)},{label:"Hôm qua",value:d(s)},{label:"Hôm kia",value:d(t)}]}),n=T(()=>{var s;const o=((s=m.expenses)==null?void 0:s.map(t=>t.date).filter(t=>t!==a.date&&t!==S.value).slice(0,3))||[];return[...new Set(o)]}),d=o=>o.toISOString().split("T")[0],N=o=>{if(!o)return"";const s=new Date(o),t=new Date,p=new Date(t);return p.setDate(p.getDate()-1),d(t)===o?"Hôm nay":d(p)===o?"Hôm qua":new Intl.DateTimeFormat("vi-VN",{weekday:"long"}).format(s)},H=o=>{a.date=o},C=k(""),w=k(!1),U=T(()=>y.currentUser),I=T(()=>{const o=C.value.toLowerCase().trim();return o?h.value.filter(s=>{var t;return s.name.toLowerCase().includes(o)||((t=s.email)==null?void 0:t.toLowerCase().includes(o))}):h.value}),Y=T(()=>{var s;const o=(s=m.expenses)==null?void 0:s.reduce((t,p)=>(t[p.payer]=(t[p.payer]||0)+1,t),{});return h.value.filter(t=>o[t.id]).sort((t,p)=>o[p.id]-o[t.id]).slice(0,5)}),ne=T(()=>{if(!a.payer)return"";const o=h.value.find(s=>s.id===a.payer);return o?o.name:""}),se=o=>{a.payer=o,C.value="",w.value=!1},he=()=>{a.payer="",C.value=""},ve=()=>{w.value=!0},re=o=>{o.target.closest(".relative")||(w.value=!1)};W(()=>{document.addEventListener("click",re)}),ce(()=>{document.removeEventListener("click",re)});const fe=k("");T(()=>{const o=fe.value.toLowerCase(),s=h.value.filter(Z=>{var ue;return Z.name.toLowerCase().includes(o)||((ue=Z.email)==null?void 0:ue.toLowerCase().includes(o))}),t=s.filter(Z=>le(Z.id)),p=s.filter(Z=>!le(Z.id)),j=[];return t.length&&j.push({label:"Thường xuyên tham gia",users:t}),p.length&&j.push({label:"Những người khác",users:p}),j});const le=o=>m.expenses?m.expenses.filter(t=>{var p;return t.participants.includes((p=h.value.find(j=>j.id===o))==null?void 0:p.name)}).length>=3:!1,ye=()=>{a.participants=h.value.map(o=>o.name)},xe=T(()=>U.value&&a.participants.includes(U.value.name)),be=()=>{if(!U.value)return;const o=U.value.name;a.participants.includes(o)?a.participants=a.participants.filter(s=>s!==o):a.participants.push(o)};G(()=>a.splitEqually,o=>{o?a.individualAmounts={}:a.participants.forEach(s=>{a.individualAmounts[s]||(a.individualAmounts[s]=0)})}),G(()=>a.participants,o=>{if(!a.splitEqually){const s={...a.individualAmounts};Object.keys(s).forEach(t=>{o.includes(t)||delete s[t]}),o.forEach(t=>{s[t]||(s[t]=0)}),a.individualAmounts=s}},{deep:!0}),T(()=>!a.amount||!a.participants.length?0:Math.round(a.amount/a.participants.length));const _e=T(()=>a.individualAmounts?Object.values(a.individualAmounts).reduce((o,s)=>o+(Number(s)||0),0):0);T(()=>a.amount-_e.value),T(()=>[{label:"Làm tròn xuống",value:"roundDown"},{label:"Làm tròn lên",value:"roundUp"},{label:"Làm tròn đến 1k",value:"roundToThousand"},{label:"Làm tròn đến 10k",value:"roundToTenThousand"}]),T(()=>[{label:"Chia theo tỷ lệ",value:"proportional"},{label:"Người trả không phải trả",value:"payerFree"},{label:"Reset về 0",value:"reset"},{label:"Chia đều phần còn lại",value:"splitRemaining"}]),G(()=>a.amount,o=>{if(a.splitEqually){const s=Math.round(o/a.participants.length);a.participants.forEach(t=>{a.individualAmounts[t]=s})}});const Q=k("equal"),ie=T(()=>{const o={};if(!a.payer||!a.amount||!a.participants.length)return o;const s=h.value.find(t=>t.id===a.payer);if(!s)return o;if(Q.value==="equal"){const t=Math.round(a.amount/a.participants.length);a.participants.forEach(p=>{o[p]=t})}else if(Q.value==="payerFree"){const t=a.participants.filter(p=>p!==s.name);if(t.length===0)o[s.name]=a.amount;else{const p=Math.round(a.amount/t.length);a.participants.forEach(j=>{o[j]=j===s.name?0:p})}}return o});return G([Q,()=>a.participants,()=>a.amount],()=>{a.individualAmounts={...ie.value}}),(o,s)=>(i(),u("div",{ref_key:"formRef",ref:g,class:q(["bg-white rounded-lg shadow py-8 px-4 transition-all duration-300",b.value?"ring-2 ring-green-500 ring-offset-2":""])},[e("div",kt,[e("h2",wt,c(b.value?"Sửa chi tiêu":"Thêm chi tiêu mới"),1),b.value?(i(),u("span",Ct," Đang sửa ")):$("",!0)]),e("form",{onSubmit:me(K,["prevent"])},[e("div",Nt,[e("div",$t,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tên chi tiêu",-1)),O(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>a.title=t),type:"text",required:"",class:"form-input"},null,512),[[z,a.title]])]),e("div",Bt,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Số tiền",-1)),e("div",Tt,[O(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>_.value=t),type:"text",required:"",placeholder:"Nhập số tiền",class:"form-input"},null,512),[[z,_.value]]),e("div",Pt,c(v(a.amount)),1)]),e("div",Mt,[(i(),u(D,null,E(F,t=>e("button",{key:t,type:"button",onClick:p=>l(t),class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},c(v(t)),9,Vt)),64))]),V.value.length?(i(),u("div",St,[(i(!0),u(D,null,E(V.value,t=>(i(),u("button",{key:t,type:"button",onClick:p=>l(t),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},c(v(t)),9,Ht))),128))])):$("",!0)]),e("div",Dt,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ngày chi tiêu",-1)),e("div",Ut,[e("div",Et,[O(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>a.date=t),type:"date",max:S.value,class:"form-input"},null,8,At),[[z,a.date]]),e("div",Lt,c(N(a.date)),1)]),e("div",It,[(i(!0),u(D,null,E(r.value,(t,p)=>(i(),u("button",{key:p,type:"button",onClick:j=>H(t.value),class:q(["px-3 py-1 text-sm rounded-full transition-colors",a.date===t.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"])},c(t.label),11,qt))),128))]),n.value.length?(i(),u("div",jt,[s[12]||(s[12]=e("div",{class:"text-sm text-gray-500 mb-1"},"Gần đây:",-1)),e("div",Ot,[(i(!0),u(D,null,E(n.value,t=>(i(),u("button",{key:t,type:"button",onClick:p=>H(t),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},c(N(t)),9,Rt))),128))])])):$("",!0)])]),e("div",Kt,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Người trả",-1)),e("div",Ft,[O(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=t=>C.value=t),onFocus:s[4]||(s[4]=t=>w.value=!0),onInput:ve,placeholder:ne.value||"Tìm người trả...",class:"form-input"},null,40,Qt),[[z,C.value]]),e("span",Gt,[L(R(_t),{class:"h-5 w-5 text-gray-400"})]),U.value&&!ne.value?(i(),u("button",{key:0,type:"button",onClick:s[5]||(s[5]=t=>se(U.value.id)),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm text-green-600 hover:text-green-700"}," Tôi trả ")):$("",!0)]),w.value?(i(),u("div",{key:0,class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",onBlur:s[6]||(s[6]=t=>w.value=!1)},[Y.value.length&&!C.value?(i(),u("div",zt,[s[14]||(s[14]=e("div",{class:"text-xs font-medium text-gray-500 mb-2"},"Thường xuyên",-1)),e("div",Xt,[(i(!0),u(D,null,E(Y.value,t=>{var p;return i(),u("button",{key:t.id,onClick:j=>se(t.id),class:"flex items-center w-full px-3 py-2 text-sm rounded-md hover:bg-gray-100"},[L(R(oe),{class:"h-5 w-5 text-gray-400 mr-2"}),e("span",null,c(t.name),1),t.id===((p=U.value)==null?void 0:p.id)?(i(),u("span",Wt,"(Tôi)")):$("",!0)],8,Zt)}),128))])])):$("",!0),e("div",Yt,[I.value.length?(i(),u("div",Jt,[(i(!0),u(D,null,E(I.value,t=>{var p;return i(),u("button",{key:t.id,onClick:j=>se(t.id),class:q(["flex items-center w-full px-3 py-2 text-sm hover:bg-gray-100",{"bg-green-50":a.payer===t.id}])},[L(R(oe),{class:"h-5 w-5 text-gray-400 mr-2"}),e("div",tn,[e("span",null,c(t.name),1),t.email?(i(),u("span",nn,c(t.email),1)):$("",!0)]),t.id===((p=U.value)==null?void 0:p.id)?(i(),u("span",sn,"(Tôi)")):$("",!0)],10,en)}),128))])):C.value?(i(),u("div",on," Không tìm thấy kết quả ")):$("",!0)])],32)):$("",!0),ne.value?(i(),u("div",an,[L(R(oe),{class:"h-4 w-4 mr-1"}),ae(" "+c(ne.value)+" ",1),e("button",{onClick:he,class:"ml-2 text-gray-400 hover:text-gray-600"},[L(R(ge),{class:"h-4 w-4"})])])):$("",!0)]),e("div",rn,[e("div",null,[s[16]||(s[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Người tham gia",-1)),e("div",ln,[e("button",{type:"button",onClick:ye,class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200"}," Chọn tất cả "),U.value?(i(),u("button",{key:0,type:"button",onClick:be,class:q(["px-3 py-1 text-sm rounded-full",xe.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"])}," Tôi tham gia ",2)):$("",!0)]),e("div",un,[(i(!0),u(D,null,E(R(h),t=>(i(),u("label",{key:t.id,class:q(["flex items-center p-2 rounded-md cursor-pointer hover:bg-gray-50",a.participants.includes(t.name)&&"bg-green-50"])},[O(e("input",{type:"checkbox",value:t.name,"onUpdate:modelValue":s[7]||(s[7]=p=>a.participants=p),class:"h-4 w-4 text-green-600 rounded border-gray-300"},null,8,dn),[[Ne,a.participants]]),e("span",cn,c(t.name),1)],2))),128))])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Cách chia tiền",-1)),a.payer?(i(),u("div",pn,[e("label",gn,[O(e("input",{type:"radio","onUpdate:modelValue":s[8]||(s[8]=t=>Q.value=t),value:"equal",class:"h-4 w-4 text-green-600"},null,512),[[de,Q.value]]),s[17]||(s[17]=e("span",{class:"ml-2 text-sm"},"Chia đều cho tất cả",-1))]),e("label",hn,[O(e("input",{type:"radio","onUpdate:modelValue":s[9]||(s[9]=t=>Q.value=t),value:"payerFree",class:"h-4 w-4 text-green-600"},null,512),[[de,Q.value]]),s[18]||(s[18]=e("span",{class:"ml-2 text-sm"},"Người trả không phải trả",-1))]),a.participants.length?(i(),u("div",vn,[s[19]||(s[19]=e("div",{class:"text-sm text-gray-600 mb-2"}," Mỗi người sẽ trả: ",-1)),(i(!0),u(D,null,E(ie.value,(t,p)=>(i(),u("div",{key:p,class:"flex justify-between text-sm"},[e("span",null,c(p),1),e("span",fn,c(v(t)),1)]))),128))])):$("",!0)])):(i(),u("div",mn," Vui lòng chọn người trả trước khi chia tiền "))])]),e("div",yn,[e("button",{type:"button",onClick:x,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",xn,c(b.value?"Cập nhật":"Thêm"),1)])])],32)],2))}}),_n=pe(bn,[["__scopeId","data-v-74c8ad6f"]]),kn=[{name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",short_name:"VietinBank",supported:!0},{name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",short_name:"Vietcombank",supported:!0},{name:"Ngân hàng TMCP Quân đội",code:"MB",bin:"970422",short_name:"MBBank",supported:!0},{name:"Ngân hàng TMCP Á Châu",code:"ACB",bin:"970416",short_name:"ACB",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thịnh Vượng",code:"VPB",bin:"970432",short_name:"VPBank",supported:!0},{name:"Ngân hàng TMCP Tiên Phong",code:"TPB",bin:"970423",short_name:"TPBank",supported:!0},{name:"Ngân hàng TMCP Hàng Hải",code:"MSB",bin:"970426",short_name:"MSB",supported:!0},{name:"Ngân hàng TMCP Nam Á",code:"NAB",bin:"970428",short_name:"NamABank",supported:!1},{name:"Ngân hàng TMCP Bưu Điện Liên Việt",code:"LPB",bin:"970449",short_name:"LienVietPostBank",supported:!0},{name:"Ngân hàng TMCP Bản Việt",code:"VCCB",bin:"970454",short_name:"VietCapitalBank",supported:!0},{name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",short_name:"BIDV",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Thương Tín",code:"STB",bin:"970403",short_name:"Sacombank",supported:!0},{name:"Ngân hàng TMCP Quốc tế Việt Nam",code:"VIB",bin:"970441",short_name:"VIB",supported:!0},{name:"Ngân hàng TMCP Phát triển Thành phố Hồ Chí Minh",code:"HDB",bin:"970437",short_name:"HDBank",supported:!0},{name:"Ngân hàng TMCP Đông Nam Á",code:"SEAB",bin:"970440",short_name:"SeABank",supported:!0},{name:"Ngân hàng Thương mại TNHH MTV Dầu Khí Toàn Cầu",code:"GPB",bin:"970408",short_name:"GPBank",supported:!1},{name:"Ngân hàng TMCP Đại Chúng Việt Nam",code:"PVCB",bin:"970412",short_name:"PVcomBank",supported:!1},{name:"Ngân hàng TMCP Quốc Dân",code:"NCB",bin:"970419",short_name:"NCB",supported:!1},{name:"Ngân hàng TNHH MTV Shinhan Việt Nam",code:"SHBVN",bin:"970424",short_name:"ShinhanBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn",code:"SCB",bin:"970429",short_name:"SCB",supported:!1},{name:"Ngân hàng TMCP Xăng dầu Petrolimex",code:"PGB",bin:"970430",short_name:"PGBank",supported:!1},{name:"Ngân hàng Nông nghiệp và Phát triển Nông thôn Việt Nam",code:"VBA",bin:"970405",short_name:"Agribank",supported:!0},{name:"Ngân hàng TMCP Kỹ thương Việt Nam",code:"TCB",bin:"970407",short_name:"Techcombank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Công Thương",code:"SGICB",bin:"970400",short_name:"SaigonBank",supported:!1},{name:"Ngân hàng TMCP Đông Á",code:"DOB",bin:"970406",short_name:"DongABank",supported:!1},{name:"Ngân hàng TMCP Bắc Á",code:"BAB",bin:"970409",short_name:"BacABank",supported:!0},{name:"Ngân hàng TNHH MTV Standard Chartered Bank Việt Nam",code:"SCVN",bin:"970410",short_name:"StandardChartered",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Đại Dương",code:"Oceanbank",bin:"970414",short_name:"Oceanbank",supported:!1},{name:"Ngân hàng Liên doanh Việt - Nga",code:"VRB",bin:"970421",short_name:"VRB",supported:!1},{name:"Ngân hàng TMCP An Bình",code:"ABB",bin:"970425",short_name:"ABBANK",supported:!0},{name:"Ngân hàng TMCP Việt Á",code:"VAB",bin:"970427",short_name:"VietABank",supported:!1},{name:"Ngân hàng TMCP Xuất Nhập khẩu Việt Nam",code:"EIB",bin:"970431",short_name:"Eximbank",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thương Tín",code:"VIETBANK",bin:"970433",short_name:"VietBank",supported:!1},{name:"Ngân hàng TNHH Indovina",code:"IVB",bin:"970434",short_name:"IndovinaBank",supported:!1},{name:"Ngân hàng TMCP Bảo Việt",code:"BVB",bin:"970438",short_name:"BaoVietBank",supported:!1},{name:"Ngân hàng TNHH MTV Public Việt Nam",code:"PBVN",bin:"970439",short_name:"PublicBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn - Hà Nội",code:"SHB",bin:"970443",short_name:"SHB",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Xây dựng Việt Nam",code:"CBB",bin:"970444",short_name:"CBBank",supported:!1},{name:"Ngân hàng TMCP Phương Đông",code:"OCB",bin:"970448",short_name:"OCB",supported:!0},{name:"Ngân hàng TMCP Kiên Long",code:"KLB",bin:"970452",short_name:"KienLongBank",supported:!0},{name:"Ngân hàng TNHH MTV CIMB Việt Nam",code:"CIMB",bin:"422589",short_name:"CIMB",supported:!1},{name:"Ngân hàng TNHH MTV HSBC (Việt Nam)",code:"HSBC",bin:"458761",short_name:"HSBC",supported:!1},{name:"DBS Bank Ltd - Chi nhánh Thành phố Hồ Chí Minh",code:"DBS",bin:"796500",short_name:"DBSBank",supported:!1},{name:"Ngân hàng Nonghyup - Chi nhánh Hà Nội",code:"NHB HN",bin:"801011",short_name:"Nonghyup",supported:!1},{id:13,name:"Ngân hàng TNHH MTV Hong Leong Việt Nam",code:"HLBVN",bin:"970442",short_name:"HongLeong",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh Hà Nội",code:"IBK - HN",bin:"970455",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh TP. Hồ Chí Minh",code:"IBK - HCM",bin:"970456",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng TNHH MTV Woori Việt Nam",code:"WVN",bin:"970457",short_name:"Woori",supported:!1},{name:"Ngân hàng United Overseas - Chi nhánh TP. Hồ Chí Minh",code:"UOB",bin:"970458",short_name:"UnitedOverseas",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Hà Nội",code:"KBHN",bin:"970462",short_name:"KookminHN",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Thành phố Hồ Chí Minh",code:"KBHCM",bin:"970463",short_name:"KookminHCM",supported:!1},{name:"Ngân hàng Hợp tác xã Việt Nam",code:"COOPBANK",bin:"970446",short_name:"COOPBANK",supported:!1}],wn={data:kn},Cn=()=>({banks:k(wn.data)}),Nn={class:"p-4 sm:p-6"},$n={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Bn={class:"mt-4"},Tn={class:"relative"},Pn=["placeholder"],Mn={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Vn={class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg max-h-60 overflow-auto border border-gray-200"},Sn={key:0,class:"py-1"},Hn=["onClick"],Dn={class:"flex items-center min-w-0 flex-1 mr-2"},Un={class:"font-medium truncate"},En={class:"text-gray-500 truncate"},An={key:0,class:"text-green-600 flex-shrink-0"},Ln={key:1,class:"px-4 py-2 text-sm text-gray-500 text-center"},In={class:"mt-4 flex justify-end space-x-3"},qn={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},jn={class:"hidden sm:block overflow-x-auto"},On={class:"min-w-full divide-y divide-gray-200"},Rn={class:"bg-white divide-y divide-gray-200"},Kn={class:"px-6 py-4 whitespace-nowrap"},Fn={class:"px-6 py-4 whitespace-nowrap"},Qn={class:"px-6 py-4 whitespace-nowrap"},Gn={class:"px-6 py-4 whitespace-nowrap text-right"},zn=["onClick"],Xn=["onClick"],Zn={class:"sm:hidden space-y-4"},Wn={class:"flex justify-between items-start mb-3"},Yn={class:"font-medium"},Jn={class:"flex space-x-2"},es=["onClick"],ts=["onClick"],ns={class:"space-y-2 text-sm"},ss={class:"grid grid-cols-2"},os={class:"grid grid-cols-2"},as=J({__name:"UserManagement",setup(P){const f=te(),{users:y}=ee(f),h=k(null),m=k({name:"",account_number:"",bank:""}),{banks:M}=Cn(),g=k(""),b=k(!1),a=T(()=>{const l=g.value.toLowerCase().trim();return l?M.value.filter(r=>r.name.toLowerCase().includes(l)||r.short_name.toLowerCase().includes(l)||r.code.toLowerCase().includes(l)):M.value}),S=T(()=>{if(!m.value.bank)return"";const l=M.value.find(r=>r.code===m.value.bank);return l?`${l.short_name} - ${l.name}`:""}),A=l=>{const r=M.value.find(n=>n.code===l);return r?r.name:l},K=async()=>{try{const l=X();if(h.value){const{error:r}=await l.from("users").update(m.value).eq("id",h.value);if(r)throw r}else{const{error:r}=await l.from("users").insert([m.value]);if(r)throw r}await f.refreshUsers(),_()}catch(l){console.error("Error saving user:",l)}},x=l=>{h.value=l.id,m.value={...l}},B=async l=>{if(confirm("Bạn có chắc chắn muốn xóa người dùng này?"))try{const{error:r}=await X().from("users").delete().eq("id",l);if(r)throw r;await f.refreshUsers()}catch(r){console.error("Error deleting user:",r)}},_=()=>{h.value=null,m.value={name:"",account_number:"",bank:""}},F=l=>{m.value.bank=l.code,g.value="",b.value=!1},V=()=>{m.value.bank="",g.value=""},v=l=>{l.target.closest(".relative")||(b.value=!1)};return W(()=>{document.addEventListener("click",v)}),ce(()=>{document.removeEventListener("click",v)}),(l,r)=>(i(),u("div",Nn,[e("form",{onSubmit:me(K,["prevent"]),class:"mb-6"},[e("div",$n,[e("div",null,[r[4]||(r[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tên",-1)),O(e("input",{"onUpdate:modelValue":r[0]||(r[0]=n=>m.value.name=n),required:"",class:"form-input"},null,512),[[z,m.value.name]])]),e("div",null,[r[5]||(r[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Số tài khoản",-1)),O(e("input",{"onUpdate:modelValue":r[1]||(r[1]=n=>m.value.account_number=n),class:"form-input"},null,512),[[z,m.value.account_number]])])]),e("div",Bn,[r[7]||(r[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ngân hàng",-1)),e("div",Tn,[O(e("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=n=>g.value=n),onFocus:r[3]||(r[3]=n=>b.value=!0),placeholder:S.value||"Tìm ngân hàng...",class:"form-input pl-10 pr-10 w-full"},null,40,Pn),[[z,g.value]]),e("span",Mn,[L(R(bt),{class:"h-5 w-5 text-gray-400"})]),m.value.bank?(i(),u("button",{key:0,type:"button",onClick:V,class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600"},[L(R(ge),{class:"h-5 w-5"})])):$("",!0),O(e("div",Vn,[a.value.length>0?(i(),u("div",Sn,[(i(!0),u(D,null,E(a.value,n=>(i(),u("button",{key:n.code,onClick:d=>F(n),class:q(["w-full px-4 py-2 text-sm text-left hover:bg-gray-100 flex items-center justify-between",{"bg-green-50":m.value.bank===n.code}])},[e("div",Dn,[e("span",Un,c(n.short_name),1),r[6]||(r[6]=e("span",{class:"text-gray-500 mx-2"},"-",-1)),e("span",En,c(n.name),1)]),m.value.bank===n.code?(i(),u("span",An,[L(R(xt),{class:"h-5 w-5"})])):$("",!0)],10,Hn))),128))])):(i(),u("div",Ln," Không tìm thấy ngân hàng phù hợp "))],512),[[Be,b.value]])])]),e("div",In,[e("button",{type:"button",onClick:_,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Reset "),e("button",qn,c(h.value?"Cập nhật":"Thêm"),1)])],32),e("div",jn,[e("table",On,[r[8]||(r[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Số tài khoản"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ngân hàng"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])],-1)),e("tbody",Rn,[(i(!0),u(D,null,E(R(y),n=>(i(),u("tr",{key:n.id},[e("td",Kn,c(n.name),1),e("td",Fn,c(n.account_number),1),e("td",Qn,c(n.bank+" - "+A(n.bank)),1),e("td",Gn,[e("button",{onClick:d=>x(n),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Sửa ",8,zn),e("button",{onClick:d=>B(n.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,Xn)])]))),128))])])]),e("div",Zn,[(i(!0),u(D,null,E(R(y),n=>(i(),u("div",{key:n.id,class:"bg-white rounded-lg border p-4"},[e("div",Wn,[e("div",Yn,c(n.name),1),e("div",Jn,[e("button",{onClick:d=>x(n),class:"text-sm text-indigo-600 hover:text-indigo-900"}," Sửa ",8,es),e("button",{onClick:d=>B(n.id),class:"text-sm text-red-600 hover:text-red-900"}," Xóa ",8,ts)])]),e("div",ns,[e("div",ss,[r[9]||(r[9]=e("div",{class:"text-gray-500"},"Số tài khoản:",-1)),e("div",null,c(n.account_number),1)]),e("div",os,[r[10]||(r[10]=e("div",{class:"text-gray-500"},"Ngân hàng:",-1)),e("div",null,c(n.bank+" - "+A(n.bank)),1)])])]))),128))])]))}}),rs={},ls={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},is={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},us={class:"sticky top-0 bg-white border-b p-4 flex justify-between items-center"},ds={class:"overflow-y-auto"};function cs(P,f){return i(),u("div",ls,[e("div",is,[e("div",us,[f[2]||(f[2]=e("h2",{class:"text-xl font-bold"},"Quản lý người dùng",-1)),e("button",{onClick:f[0]||(f[0]=y=>P.$emit("close")),class:"p-2 hover:bg-gray-100 rounded-full"},f[1]||(f[1]=[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",ds,[Te(P.$slots,"default")])])])}const ms=pe(rs,[["render",cs]]),ps={class:"min-h-screen bg-green-50 flex flex-col"},gs={class:"container mx-auto px-4 py-8 flex-grow"},hs={key:0,class:"max-w-md mx-auto"},vs={class:"space-y-4"},fs={key:1},ys={key:0,class:"max-w-5xl mx-auto space-y-8"},xs={key:1,class:"max-w-5xl mx-auto space-y-8"},_s=J({__name:"index",setup(P){const f=te(),{users:y}=ee(f),h=k([]),m=k(null),M=k(0),g=k(1),b=k(2),a=k(!1),S=k(!1),A=async(V=1)=>{console.log("loadExpenses called with page:",V);try{a.value=!0,console.log("Loading started");const v=(V-1)*b.value,l=v+b.value-1;console.log("Fetching range:",v,"to",l);const r=X(),n=r.from("expenses").select("id",{count:"exact",head:!0}),d=r.from("expenses").select(`
        id,
        title,
        amount,
        date,
        payer,
        participants,
        split_equally,
        individual_amounts
      `).order("date",{ascending:!1}).range(v,l),[N,H]=await Promise.all([n,d]);if(console.log("Count response:",N),console.log("Data response:",H),N.error)throw console.error("Count error:",N.error),N.error;if(H.error)throw console.error("Data error:",H.error),H.error;M.value=N.count||0,h.value=H.data||[],g.value=V,console.log("Updated state:",{totalExpenses:M.value,expenses:h.value.length,currentPage:g.value})}catch(v){console.error("Error loading expenses:",v)}finally{a.value=!1,console.log("Loading finished")}},K=async V=>{console.log("Role selected:",V);try{m.value=V,y.value.length||await f.fetchUsers(),await A(1)}catch(v){console.error("Error in handleRoleSelect:",v)}},x=async()=>{M.value=0,await A(1)},B=()=>{try{m.value=null,editingExpense.value=null,S.value=!1}catch(V){console.error("Error in changeRole:",V)}},_=async()=>{try{await f.fetchUsers(),S.value=!0}catch(V){console.error("Error in handleShowUserManagement:",V)}},F=()=>{S.value=!1};return W(()=>{console.log("Component mounted")}),(V,v)=>{const l=Re,r=yt,n=_n,d=as,N=ms;return i(),u("div",ps,[e("div",gs,[v[5]||(v[5]=e("h1",{class:"text-4xl font-bold text-center text-green-800 mb-8"},"EzSplit",-1)),m.value?(i(),u("div",fs,[e("div",{class:"flex justify-between items-center mb-6"},[e("button",{type:"button",onClick:B,class:"text-green-600 hover:text-green-700"}," ← Đổi vai trò "),e("button",{type:"button",onClick:_,class:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200"}," Quản lý người dùng ")]),m.value==="payer"?(i(),u("div",ys,[L(l,{expenses:h.value,"current-page":g.value,"total-items":M.value,"items-per-page":b.value,loading:a.value,onPageChange:A},null,8,["expenses","current-page","total-items","items-per-page","loading"]),L(r,{expenses:h.value},null,8,["expenses"])])):$("",!0),m.value==="spender"?(i(),u("div",xs,[L(n,{expenses:h.value,onSave:x},null,8,["expenses"]),L(l,{expenses:h.value,"current-page":g.value,"total-items":M.value,"items-per-page":b.value,loading:a.value,onPageChange:A},null,8,["expenses","current-page","total-items","items-per-page","loading"])])):$("",!0)])):(i(),u("div",hs,[v[4]||(v[4]=e("h2",{class:"text-xl font-semibold mb-6 text-center"},"Bạn là...",-1)),e("div",vs,[e("button",{onClick:v[0]||(v[0]=H=>K("payer")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},v[2]||(v[2]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người trả tiền 💰",-1),e("p",{class:"text-gray-600 mt-2"},"Xem danh sách các khoản cần thanh toán",-1)])),e("button",{onClick:v[1]||(v[1]=H=>K("spender")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},v[3]||(v[3]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người chi tiền 📝",-1),e("p",{class:"text-gray-600 mt-2"},"Tạo và quản lý các khoản chi tiêu",-1)]))])])),S.value?(i(),Pe(N,{key:2,onClose:F},{default:Me(()=>[L(d)]),_:1})):$("",!0)]),v[6]||(v[6]=e("footer",{class:"text-center py-4 text-sm text-gray-600 bg-green-50"},[e("p",null,"Made with ♥️ by abner"),e("p",null,"© 2025 EzSplit. All rights reserved.")],-1))])}}});export{_s as default};
