import{r as v,a as z,d as D,o as O,t as u,v as c,x as e,H as G,I as C,J as E,K as U,L as F,M,N as P,O as I,y as p,j as q,P as W,Q as J,R,S as L,z as j}from"./Bafg6Rss.js";const Y="52",Z=[{name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",short_name:"VietinBank",supported:!0},{name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",short_name:"Vietcombank",supported:!0},{name:"Ngân hàng TMCP Quân đội",code:"MB",bin:"970422",short_name:"MBBank",supported:!0},{name:"Ngân hàng TMCP Á Châu",code:"ACB",bin:"970416",short_name:"ACB",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thịnh Vượng",code:"VPB",bin:"970432",short_name:"VPBank",supported:!0},{name:"Ngân hàng TMCP Tiên Phong",code:"TPB",bin:"970423",short_name:"TPBank",supported:!0},{name:"Ngân hàng TMCP Hàng Hải",code:"MSB",bin:"970426",short_name:"MSB",supported:!0},{name:"Ngân hàng TMCP Nam Á",code:"NAB",bin:"970428",short_name:"NamABank",supported:!1},{name:"Ngân hàng TMCP Bưu Điện Liên Việt",code:"LPB",bin:"970449",short_name:"LienVietPostBank",supported:!0},{name:"Ngân hàng TMCP Bản Việt",code:"VCCB",bin:"970454",short_name:"VietCapitalBank",supported:!0},{name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",short_name:"BIDV",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Thương Tín",code:"STB",bin:"970403",short_name:"Sacombank",supported:!0},{name:"Ngân hàng TMCP Quốc tế Việt Nam",code:"VIB",bin:"970441",short_name:"VIB",supported:!0},{name:"Ngân hàng TMCP Phát triển Thành phố Hồ Chí Minh",code:"HDB",bin:"970437",short_name:"HDBank",supported:!0},{name:"Ngân hàng TMCP Đông Nam Á",code:"SEAB",bin:"970440",short_name:"SeABank",supported:!0},{name:"Ngân hàng Thương mại TNHH MTV Dầu Khí Toàn Cầu",code:"GPB",bin:"970408",short_name:"GPBank",supported:!1},{name:"Ngân hàng TMCP Đại Chúng Việt Nam",code:"PVCB",bin:"970412",short_name:"PVcomBank",supported:!1},{name:"Ngân hàng TMCP Quốc Dân",code:"NCB",bin:"970419",short_name:"NCB",supported:!1},{name:"Ngân hàng TNHH MTV Shinhan Việt Nam",code:"SHBVN",bin:"970424",short_name:"ShinhanBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn",code:"SCB",bin:"970429",short_name:"SCB",supported:!1},{name:"Ngân hàng TMCP Xăng dầu Petrolimex",code:"PGB",bin:"970430",short_name:"PGBank",supported:!1},{name:"Ngân hàng Nông nghiệp và Phát triển Nông thôn Việt Nam",code:"VBA",bin:"970405",short_name:"Agribank",supported:!0},{name:"Ngân hàng TMCP Kỹ thương Việt Nam",code:"TCB",bin:"970407",short_name:"Techcombank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Công Thương",code:"SGICB",bin:"970400",short_name:"SaigonBank",supported:!1},{name:"Ngân hàng TMCP Đông Á",code:"DOB",bin:"970406",short_name:"DongABank",supported:!1},{name:"Ngân hàng TMCP Bắc Á",code:"BAB",bin:"970409",short_name:"BacABank",supported:!0},{name:"Ngân hàng TNHH MTV Standard Chartered Bank Việt Nam",code:"SCVN",bin:"970410",short_name:"StandardChartered",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Đại Dương",code:"Oceanbank",bin:"970414",short_name:"Oceanbank",supported:!1},{name:"Ngân hàng Liên doanh Việt - Nga",code:"VRB",bin:"970421",short_name:"VRB",supported:!1},{name:"Ngân hàng TMCP An Bình",code:"ABB",bin:"970425",short_name:"ABBANK",supported:!0},{name:"Ngân hàng TMCP Việt Á",code:"VAB",bin:"970427",short_name:"VietABank",supported:!1},{name:"Ngân hàng TMCP Xuất Nhập khẩu Việt Nam",code:"EIB",bin:"970431",short_name:"Eximbank",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thương Tín",code:"VIETBANK",bin:"970433",short_name:"VietBank",supported:!1},{name:"Ngân hàng TNHH Indovina",code:"IVB",bin:"970434",short_name:"IndovinaBank",supported:!1},{name:"Ngân hàng TMCP Bảo Việt",code:"BVB",bin:"970438",short_name:"BaoVietBank",supported:!1},{name:"Ngân hàng TNHH MTV Public Việt Nam",code:"PBVN",bin:"970439",short_name:"PublicBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn - Hà Nội",code:"SHB",bin:"970443",short_name:"SHB",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Xây dựng Việt Nam",code:"CBB",bin:"970444",short_name:"CBBank",supported:!1},{name:"Ngân hàng TMCP Phương Đông",code:"OCB",bin:"970448",short_name:"OCB",supported:!0},{name:"Ngân hàng TMCP Kiên Long",code:"KLB",bin:"970452",short_name:"KienLongBank",supported:!0},{name:"Ngân hàng TNHH MTV CIMB Việt Nam",code:"CIMB",bin:"422589",short_name:"CIMB",supported:!1},{name:"Ngân hàng TNHH MTV HSBC (Việt Nam)",code:"HSBC",bin:"458761",short_name:"HSBC",supported:!1},{name:"DBS Bank Ltd - Chi nhánh Thành phố Hồ Chí Minh",code:"DBS",bin:"796500",short_name:"DBSBank",supported:!1},{name:"Ngân hàng Nonghyup - Chi nhánh Hà Nội",code:"NHB HN",bin:"801011",short_name:"Nonghyup",supported:!1},{id:13,name:"Ngân hàng TNHH MTV Hong Leong Việt Nam",code:"HLBVN",bin:"970442",short_name:"HongLeong",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh Hà Nội",code:"IBK - HN",bin:"970455",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh TP. Hồ Chí Minh",code:"IBK - HCM",bin:"970456",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng TNHH MTV Woori Việt Nam",code:"WVN",bin:"970457",short_name:"Woori",supported:!1},{name:"Ngân hàng United Overseas - Chi nhánh TP. Hồ Chí Minh",code:"UOB",bin:"970458",short_name:"UnitedOverseas",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Hà Nội",code:"KBHN",bin:"970462",short_name:"KookminHN",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Thành phố Hồ Chí Minh",code:"KBHCM",bin:"970463",short_name:"KookminHCM",supported:!1},{name:"Ngân hàng Hợp tác xã Việt Nam",code:"COOPBANK",bin:"970446",short_name:"COOPBANK",supported:!1}],ee={no_banks:Y,data:Z},te=()=>{const N=v([]),b=v(!1),d=v(null);return{banks:N,loading:b,error:d,fetchBanks:async()=>{b.value=!0,d.value=null;try{N.value=ee.data.map(m=>({code:m.code,name:m.name,shortName:m.short_name,bin:m.bin}))}catch(m){d.value=m,console.error("Error loading banks:",m)}finally{b.value=!1}}}},w=()=>z().$supabase.client,ne={class:"bg-white rounded-lg shadow p-6 mb-8"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},oe={class:"relative"},ae=["value"],re={key:0,class:"absolute right-2 top-1/2 -translate-y-1/2"},ie={key:0,class:"mt-1 text-sm text-red-600"},le={class:"mt-4 flex justify-end space-x-3"},de={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},ue={class:"overflow-x-auto"},ce={class:"min-w-full divide-y divide-gray-200"},me={class:"bg-white divide-y divide-gray-200"},pe={class:"px-6 py-4 whitespace-nowrap"},ge={class:"px-6 py-4 whitespace-nowrap"},he={class:"px-6 py-4 whitespace-nowrap"},be={class:"px-6 py-4 whitespace-nowrap text-right"},fe=["onClick"],ye=["onClick"],xe=D({__name:"UserManagement",setup(N){const b=v([]),d=v(null),g=v({name:"",account_number:"",bank:""}),{banks:m,loading:B,error:y,fetchBanks:f}=te(),r=s=>{const t=m.value.find(l=>l.code===s);return t?t.name:s},k=async()=>{const{data:s,error:t}=await w().from("users").select("*").order("created_at",{ascending:!1});if(t){console.error("Error loading users:",t);return}b.value=s},V=async()=>{try{const s=w();if(d.value){const{error:t}=await s.from("users").update(g.value).eq("id",d.value);if(t)throw t}else{const{error:t}=await s.from("users").insert([g.value]);if(t)throw t}await k(),i()}catch(s){console.error("Error saving user:",s)}},S=s=>{d.value=s.id,g.value={...s}},H=async s=>{if(confirm("Bạn có chắc chắn muốn xóa người dùng này?"))try{const{error:t}=await w().from("users").delete().eq("id",s);if(t)throw t;await k()}catch(t){console.error("Error deleting user:",t)}},i=()=>{d.value=null,g.value={name:"",account_number:"",bank:""}};return O(async()=>{await Promise.all([k(),f()])}),(s,t)=>(c(),u("div",ne,[t[9]||(t[9]=e("h2",{class:"text-2xl font-bold mb-4"},"Quản lý người dùng",-1)),e("form",{onSubmit:G(V,["prevent"]),class:"mb-6"},[e("div",se,[e("div",null,[t[3]||(t[3]=e("label",{class:"block text-sm font-medium text-gray-700"},"Tên",-1)),C(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>g.value.name=l),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},null,512),[[E,g.value.name]])]),e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700"},"Số tài khoản",-1)),C(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>g.value.account_number=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},null,512),[[E,g.value.account_number]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Ngân hàng",-1)),e("div",oe,[C(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>g.value.bank=l),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},[t[5]||(t[5]=e("option",{value:""},"Chọn ngân hàng",-1)),(c(!0),u(M,null,P(I(m),l=>(c(),u("option",{key:l.code,value:l.code},p(l.name),9,ae))),128))],512),[[F,g.value.bank]]),I(B)?(c(),u("div",re,t[6]||(t[6]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-b-2 border-green-500"},null,-1)]))):U("",!0)]),I(y)?(c(),u("p",ie," Không thể tải danh sách ngân hàng. Vui lòng thử lại sau. ")):U("",!0)])]),e("div",le,[e("button",{type:"button",onClick:i,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",de,p(d.value?"Cập nhật":"Thêm"),1)])],32),e("div",ue,[e("table",ce,[t[8]||(t[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Số tài khoản"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ngân hàng"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])],-1)),e("tbody",me,[(c(!0),u(M,null,P(b.value,l=>(c(),u("tr",{key:l.id},[e("td",pe,p(l.name),1),e("td",ge,p(l.account_number),1),e("td",he,p(l.bank+" - "+r(l.bank)),1),e("td",be,[e("button",{onClick:a=>S(l),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Sửa ",8,fe),e("button",{onClick:a=>H(l.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,ye)])]))),128))])])])]))}}),X=()=>{const N=v([]),b=v(!1),d=v(null);return{users:N,loading:b,error:d,fetchUsers:async()=>{b.value=!0,d.value=null;try{const{data:m,error:B}=await w().from("users").select("*").order("name");if(B)throw B;N.value=m}catch(m){d.value=m,console.error("Error loading users:",m)}finally{b.value=!1}}}},ve={class:"bg-white rounded-lg shadow p-6"},_e={class:"text-2xl font-bold mb-4"},Ne={class:"space-y-4"},Be=["max"],ke=["value"],Ce={class:"mt-2 space-y-2"},Te=["value","id"],we=["for","onClick"],Ve={class:"flex items-center space-x-2"},Me={key:0},Pe={class:"mt-2 space-y-2"},He={class:"w-24"},$e=["onUpdate:modelValue"],Se={class:"flex justify-end space-x-3"},Ee={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},Ae=D({__name:"ExpenseForm",props:{editingExpense:{}},emits:["save","cancel"],setup(N,{emit:b}){const d=N,g=b,{users:m,fetchUsers:B}=X(),y=v(null),f=q(()=>new Date().toISOString().split("T")[0]),r=W({title:"",amount:0,date:f.value,payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),k=i=>{const s=r.participants.indexOf(i);s===-1?r.participants.push(i):r.participants.splice(s,1)},V=()=>{if(!r.splitEqually){const i=Object.values(r.individualAmounts).reduce((s,t)=>s+(Number(t)||0),0);if(Math.abs(i-r.amount)>.01)return!1}return!0},S=async()=>{if(!r.splitEqually&&!V()){alert("Tổng số tiền chi tiêu cá nhân phải bằng tổng số tiền");return}try{const i={title:r.title,amount:r.amount,date:r.date,payer:r.payer,participants:r.participants,split_equally:r.splitEqually,individual_amounts:r.individualAmounts},s=w();if(y.value){const{error:t}=await s.from("expenses").update(i).eq("id",y.value);if(t)throw t}else{const{error:t}=await s.from("expenses").insert([i]);if(t)throw t}g("save"),H()}catch(i){console.error("Error saving expense:",i)}},H=()=>{y.value=null,Object.assign(r,{title:"",amount:0,date:f.value,payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),g("cancel")};return J(()=>d.editingExpense,i=>{i&&(y.value=i.id,Object.assign(r,{title:i.title,amount:i.amount,date:i.date||f.value,payer:i.payer,participants:i.participants,splitEqually:i.split_equally,individualAmounts:i.individual_amounts||{}}))},{immediate:!0}),O(()=>{B()}),(i,s)=>(c(),u("div",ve,[e("h2",_e,p(y.value?"Sửa chi tiêu":"Thêm chi tiêu mới"),1),e("form",{onSubmit:G(S,["prevent"])},[e("div",Ne,[e("div",null,[s[6]||(s[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Tên chi tiêu",-1)),C(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>r.title=t),type:"text",required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},null,512),[[E,r.title]])]),e("div",null,[s[7]||(s[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Số tiền",-1)),C(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>r.amount=t),type:"number",required:"",min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},null,512),[[E,r.amount]])]),e("div",null,[s[8]||(s[8]=e("label",{class:"block text-sm font-medium text-gray-700"},"Ngày chi tiêu",-1)),C(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>r.date=t),type:"date",max:f.value,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},null,8,Be),[[E,r.date]])]),e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"Người trả",-1)),C(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>r.payer=t),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"},[s[9]||(s[9]=e("option",{value:""},"Chọn người trả",-1)),(c(!0),u(M,null,P(I(m),t=>(c(),u("option",{key:t.id,value:t.name},p(t.name),9,ke))),128))],512),[[F,r.payer]])]),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Người tham gia",-1)),e("div",Ce,[(c(!0),u(M,null,P(I(m),t=>(c(),u("div",{key:t.id,class:"flex items-center"},[C(e("input",{type:"checkbox",value:t.name,"onUpdate:modelValue":s[4]||(s[4]=l=>r.participants=l),id:"participant-"+t.id,class:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"},null,8,Te),[[R,r.participants]]),e("label",{for:"participant-"+t.id,class:"ml-2 text-sm text-gray-700",onClick:l=>k(t.name)},p(t.name),9,we)]))),128))])]),e("div",Ve,[C(e("input",{type:"checkbox","onUpdate:modelValue":s[5]||(s[5]=t=>r.splitEqually=t),id:"split-equally",class:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"},null,512),[[R,r.splitEqually]]),s[12]||(s[12]=e("label",{for:"split-equally",class:"text-sm text-gray-700"}," Chia đều cho tất cả người tham gia ",-1))]),r.splitEqually?U("",!0):(c(),u("div",Me,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Chi tiêu cá nhân",-1)),e("div",Pe,[(c(!0),u(M,null,P(r.participants,t=>(c(),u("div",{key:t,class:"flex items-center"},[e("label",He,p(t),1),C(e("input",{type:"number","onUpdate:modelValue":l=>r.individualAmounts[t]=l,class:"ml-2 block w-32 rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500",onInput:V},null,40,$e),[[E,r.individualAmounts[t]]])]))),128))])])),e("div",Se,[e("button",{type:"button",onClick:H,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",Ee,p(y.value?"Cập nhật":"Thêm"),1)])])],32)]))}}),Ie={class:"bg-white rounded-lg shadow p-6 mt-6"},Ue={class:"overflow-x-auto mb-8"},qe={class:"min-w-full divide-y divide-gray-200"},De={class:"bg-white divide-y divide-gray-200"},Oe={class:"px-6 py-4"},Ke={class:"px-6 py-4"},Le={class:"px-6 py-4"},je={class:"px-6 py-4"},Qe={class:"px-6 py-4"},Re={class:"px-6 py-4 text-right space-x-2"},Ge=["onClick"],Fe=["onClick"],Xe={class:"space-y-6"},ze={class:"space-y-2"},We={class:"space-y-4"},Je={class:"flex justify-between items-center"},Ye={class:"font-medium"},Ze={class:"font-medium"},et={class:"ml-2"},tt={class:"flex items-center space-x-2"},nt=["onClick"],st=["onClick"],ot={key:0,class:"text-sm text-gray-500 mt-2"},at={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"},rt={class:"bg-white p-6 rounded-lg max-w-sm w-full"},it=["src"],lt=D({__name:"ExpenseResults",props:{expenses:{}},emits:["edit","refresh"],setup(N){const b=N,{users:d,fetchUsers:g}=X(),m=v(!1),B=v(""),y=q(()=>{const a={};return d.value.forEach(o=>{a[o.name]=0}),b.expenses.forEach(o=>{const n=Number(o.amount);if(isNaN(n))return;const h=o.payer,T=o.participants.filter(x=>d.value.some(_=>_.name===x));if(T.length===0)return;const $=n/T.length;a.hasOwnProperty(h)&&(a[h]+=n),T.forEach(x=>{var _;if(a.hasOwnProperty(x))if(o.split_equally)a[x]-=$;else{const K=Number((_=o.individual_amounts)==null?void 0:_[x])||0;a[x]-=K}})}),a}),f=q(()=>{const a=y.value,o=[],n=Object.entries(a).filter(([,x])=>x<0).map(([x,_])=>[x,Math.round(_*100)/100]),h=Object.entries(a).filter(([,x])=>x>0).map(([x,_])=>[x,Math.round(_*100)/100]);let T=0,$=0;for(;T<n.length&&$<h.length;){const[x,_]=n[T],[K,A]=h[$],Q=Math.min(Math.abs(_),A);Q>0&&o.push({from:x,to:K,amount:Math.round(Q*100)/100}),Math.abs(_)===A?(T++,$++):Math.abs(_)<A?(h[$][1]=Math.round((A-Math.abs(_))*100)/100,T++):(n[T][1]=Math.round((_+A)*100)/100,$++)}return o}),r=a=>{console.log(a,d);const o=d.value.find(h=>h.name==a.to);if(!o)return;const n=`https://qr.sepay.vn/img?acc=${o.account_number}&bank=${o.bank}&amount=${a.amount}&des=${encodeURIComponent(`${a.from} ck ${a.to} tien ${b.expenses.map(h=>h.title).join(" ")}`)}&template=compact&download=false`;B.value=n,m.value=!0},k=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),V=a=>new Date(a).toLocaleDateString("vi-VN"),S=async a=>{if(confirm("Bạn có chắc chắn muốn xóa chi tiêu này?"))try{const{error:o}=await w().from("expenses").delete().eq("id",a);if(o)throw o;emit("refresh")}catch(o){console.error("Error deleting expense:",o)}},H=v([]),i=async()=>{const{data:a,error:o}=await w().from("transactions").select("*");if(o){console.error("Error loading transactions:",o);return}H.value=a},s=q(()=>f.value.map(o=>{const n=H.value.find(h=>h.from_user===o.from&&h.to_user===o.to&&Number(h.amount)===Number(o.amount));return{...o,id:n==null?void 0:n.id,completed:(n==null?void 0:n.completed)||!1,completed_at:n==null?void 0:n.completed_at}})),t=async a=>{const o=w();try{if(a.id){const{error:n}=await o.from("transactions").update({completed:!a.completed,completed_at:a.completed?null:new Date().toISOString()}).eq("id",a.id);if(n)throw n}else{const{error:n}=await o.from("transactions").insert([{from_user:a.from,to_user:a.to,amount:a.amount,completed:!0,completed_at:new Date().toISOString()}]);if(n)throw n}await i()}catch(n){console.error("Error updating transaction:",n)}},l=a=>a?new Date(a).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"";return O(async()=>{await Promise.all([g(),i()])}),(a,o)=>(c(),u("div",Ie,[o[6]||(o[6]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Danh sách chi tiêu")],-1)),e("div",Ue,[e("table",qe,[o[1]||(o[1]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Tên chi tiêu"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Ngày"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Số tiền"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Người trả"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Người tham gia"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase"},"Thao tác")])],-1)),e("tbody",De,[(c(!0),u(M,null,P(a.expenses,n=>(c(),u("tr",{key:n.id},[e("td",Oe,p(n.title),1),e("td",Ke,p(V(n.date)),1),e("td",Le,p(k(n.amount)),1),e("td",je,p(n.payer),1),e("td",Qe,p(n.participants.join(", ")),1),e("td",Re,[e("button",{onClick:h=>a.$emit("edit",n),class:"text-indigo-600 hover:text-indigo-900"}," Sửa ",8,Ge),e("button",{onClick:h=>S(n.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,Fe)])]))),128))])])]),o[7]||(o[7]=e("h2",{class:"text-2xl font-bold mb-4"},"Kết quả chia tiền",-1)),e("div",Xe,[e("div",null,[o[2]||(o[2]=e("h3",{class:"text-lg font-semibold mb-2"},"Tổng kết cá nhân",-1)),e("div",ze,[(c(!0),u(M,null,P(y.value,(n,h)=>(c(),u("div",{key:h,class:"flex justify-between"},[e("span",null,p(h),1),e("span",{class:L(n<0?"text-red-500":"text-green-500")},p(k(n)),3)]))),128))])]),e("div",null,[o[4]||(o[4]=e("h3",{class:"text-lg font-semibold mb-2"},"Giao dịch cần thực hiện",-1)),e("div",We,[(c(!0),u(M,null,P(s.value,n=>(c(),u("div",{key:n.id||`${n.from}-${n.to}-${n.amount}`,class:L(["border p-4 rounded-lg transition-colors duration-200",n.completed?"bg-gray-100":"bg-white"])},[e("div",Je,[e("div",null,[e("span",Ye,p(n.from),1),o[3]||(o[3]=e("span",{class:"mx-2"},"→",-1)),e("span",Ze,p(n.to),1),e("span",et,p(k(n.amount)),1)]),e("div",tt,[e("button",{onClick:h=>t(n),class:L(["px-3 py-1 rounded-md text-sm",n.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},p(n.completed?"Đã chuyển":"Đánh dấu đã chuyển"),11,nt),e("button",{onClick:h=>r(n),class:"text-green-500 hover:text-green-600"}," Tạo QR chuyển tiền ",8,st)])]),n.completed?(c(),u("div",ot," Hoàn thành: "+p(l(n.completed_at)),1)):U("",!0)],2))),128))])])]),m.value?(c(),u("div",at,[e("div",rt,[o[5]||(o[5]=e("h3",{class:"text-lg font-bold mb-4"},"QR Code chuyển khoản",-1)),e("img",{src:B.value,alt:"QR Code",class:"w-full"},null,8,it),e("button",{onClick:o[0]||(o[0]=n=>m.value=!1),class:"mt-4 w-full bg-green-500 text-white py-2 rounded-lg"}," Đóng ")])])):U("",!0)]))}}),dt={class:"min-h-screen bg-green-50"},ut={class:"container mx-auto px-4 py-8"},mt=D({__name:"index",setup(N){const b=v([]),d=v(null),g=async()=>{const{data:y,error:f}=await w().from("expenses").select("*").order("date",{ascending:!1});if(f){console.error("Error loading expenses:",f);return}b.value=y},m=y=>{d.value=y},B=()=>{g(),d.value=null};return O(()=>{g()}),(y,f)=>{const r=xe,k=Ae,V=lt;return c(),u("div",dt,[e("div",ut,[f[1]||(f[1]=e("h1",{class:"text-4xl font-bold text-center text-green-800 mb-8"},"EzSplit",-1)),j(r),j(k,{"editing-expense":d.value,onSave:B,onCancel:f[0]||(f[0]=S=>d.value=null)},null,8,["editing-expense"]),j(V,{expenses:b.value,onEdit:m,onRefresh:g},null,8,["expenses"]),f[2]||(f[2]=e("footer",{class:"text-center mt-8 text-sm text-gray-600"},[e("p",null,"Made with ♥️ by abner"),e("p",null,"© 2025 EzSplit. All rights reserved.")],-1))])])}}});export{mt as default};
