import{a as ye,H as xe,r as C,d as te,I as ne,j as D,o as J,t as l,v as r,x as e,J as $,K as H,L as E,M as j,y as c,z as A,B as Z,N as I,O as be,P as X,Q as de,R as ue,S as O,T as W,U as le,V as _e,W as ke,_ as ce,X as we,Y as Ce,F as Ne,Z as $e,A as ie,$ as Be}from"./DwCQBdue.js";const Q=()=>ye().$supabase.client,se=xe("users",()=>{const B=C([]),m=C(!1),_=C(null),g=C(!1),h=async()=>{if(!m.value){m.value=!0,_.value=null;try{const{data:k,error:f}=await Q().from("users").select("*").order("name");if(f)throw f;B.value=k,g.value=!0}catch(k){_.value=k,console.error("Error loading users:",k)}finally{m.value=!1}}};return{users:B,loading:m,error:_,fetchUsers:h,refreshUsers:async()=>{g.value=!1,await h()}}}),Te={class:"bg-white rounded-lg shadow px-4 py-8"},Pe={key:0,class:"space-y-4"},Me={key:1,class:"text-center py-8 text-gray-500"},Ve={key:2,class:"relative"},Se={key:0,class:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg z-10"},He={class:"space-y-4"},De={class:"font-medium mb-2"},Ee={class:"space-y-2 text-sm"},Ae={class:"grid grid-cols-2"},Ue={class:"grid grid-cols-2"},Le={class:"grid grid-cols-2"},Ie={key:3,class:"mt-4 flex justify-center space-x-2"},je=["disabled"],qe=["disabled"],Re=te({__name:"ExpenseList",props:{expenses:{},currentPage:{},totalItems:{},itemsPerPage:{},loading:{type:Boolean}},emits:["pageChange"],setup(B,{emit:m}){const _=B,g=m,h=se(),{users:V}=ne(h),k=D(()=>Math.ceil(_.totalItems/_.itemsPerPage));J(()=>{console.log("ExpenseList mounted with props:",_)});const f=y=>new Date(y).toLocaleDateString("vi-VN"),a=y=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(y),S=y=>{const N=V.value.find(w=>w.id===y);return(N==null?void 0:N.name)||"Unknown"},L=()=>{!_.loading&&_.currentPage<k.value&&g("pageChange",_.currentPage+1)},q=()=>{!_.loading&&_.currentPage>1&&g("pageChange",_.currentPage-1)};return(y,N)=>(r(),l("div",Te,[N[4]||(N[4]=e("h2",{class:"text-xl font-bold mb-6"},"Lịch sử chi tiêu",-1)),y.loading&&!y.expenses.length?(r(),l("div",Pe,[(r(!0),l(H,null,E(y.itemsPerPage,w=>(r(),l("div",{key:w,class:"animate-pulse bg-gray-100 h-16 rounded-lg"}))),128))])):y.expenses.length?(r(),l("div",Ve,[y.loading&&y.expenses.length?(r(),l("div",Se,N[0]||(N[0]=[e("div",{class:"flex items-center space-x-2"},[e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0s"}}),e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0.2s"}}),e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0.4s"}})],-1)]))):$("",!0),e("div",He,[(r(!0),l(H,null,E(y.expenses,w=>(r(),l("div",{key:w.id,class:"bg-white rounded-lg border p-4"},[e("div",De,c(w.title),1),e("div",Ee,[e("div",Ae,[N[1]||(N[1]=e("div",{class:"text-gray-500"},"Thời gian:",-1)),e("div",null,c(f(w.date)),1)]),e("div",Ue,[N[2]||(N[2]=e("div",{class:"text-gray-500"},"Tổng tiền:",-1)),e("div",null,c(a(w.amount)),1)]),e("div",Le,[N[3]||(N[3]=e("div",{class:"text-gray-500"},"Người đã thanh toán:",-1)),e("div",null,c(S(w.payer)),1)])])]))),128))])])):(r(),l("div",Me," Chưa có khoản chi tiêu nào được ghi nhận ")),k.value>1?(r(),l("div",Ie,[e("button",{onClick:q,disabled:y.currentPage===1||y.loading,class:j(["px-3 py-1 rounded-md text-sm",[y.currentPage===1||y.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Trang trước ",10,je),e("button",{onClick:L,disabled:y.currentPage===k.value||y.loading,class:j(["px-3 py-1 rounded-md text-sm",[y.currentPage===k.value||y.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Trang sau ",10,qe)])):$("",!0)]))}});function Oe(B,m){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function Ke(B,m){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function Fe(B,m){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function oe(B,m){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function Qe(B,m){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}function me(B,m){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const ze={class:"bg-white rounded-lg shadow p-6"},Ge={class:"text-xl font-bold mb-6 inline-flex items-center gap-1"},Xe={class:"space-y-10"},Ze={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},We={class:"font-medium"},Ye={class:"text-xs text-gray-400"},Je={class:"space-y-4"},et={class:"flex flex-col sm:hidden"},tt={class:"flex items-center space-x-2 mb-2"},nt={class:"font-medium"},st={class:"font-medium"},ot={class:"text-lg font-medium text-green-600 mb-3"},at={class:"flex flex-col space-y-2"},rt=["onClick","disabled"],lt={key:0},it=["onClick"],dt={class:"hidden sm:flex sm:justify-between sm:items-center"},ut={class:"font-medium"},ct={class:"font-medium"},mt={class:"ml-2"},gt={class:"flex items-center space-x-2"},ht=["onClick","disabled"],pt={key:0},vt=["onClick"],ft={key:0,class:"text-sm text-gray-500 mt-2"},yt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 !m-0"},xt={class:"bg-white rounded-lg shadow-xl w-full max-w-sm"},bt={class:"p-4"},_t=["src"],kt={class:"p-6 border-t bg-gray-50"},wt={class:"flex flex-col sm:flex-row gap-3"},Ct=te({__name:"ExpenseSummary",setup(B,{expose:m}){const _=se(),{users:g}=ne(_),h=C(""),V=C(!1),k=C([]),f=C(new Set),a=C([]),S=async()=>{try{const t=Q(),{data:d,error:i}=await t.from("expenses").select("*").order("date",{ascending:!1});if(i)throw i;a.value=d||[]}catch(t){console.error("Error loading all expenses:",t)}},L=D(()=>{var d,i;if(!((d=g.value)!=null&&d.length)||!((i=a.value)!=null&&i.length))return{};const t=Object.fromEntries(g.value.map(v=>[v.id,0]));return a.value.forEach(v=>{const P=v.participants.length;if(P===0)return;const T=v.amount/P;t[v.payer]+=v.amount,v.participants.forEach(x=>{const M=g.value.find(F=>F.name===x);M&&(t[M.id]-=T)})}),t}),q=D(()=>{const t=L.value;if(!Object.keys(t).length)return[];const d=[],i=[];Object.entries(t).forEach(([x,M])=>{M<0?d.push({id:x,amount:-M}):M>0&&i.push({id:x,amount:M})}),d.sort((x,M)=>M.amount-x.amount),i.sort((x,M)=>M.amount-x.amount);const v=[];let P=0,T=0;for(;P<d.length&&T<i.length;){const x=d[P],M=i[T],F=Math.min(x.amount,M.amount),U=k.value.find(Y=>Y.from_user===x.id&&Y.to_user===M.id);v.push({from:x.id,to:M.id,amount:Math.round(F),fromName:p(x.id),toName:p(M.id),completed:(U==null?void 0:U.completed)||!1,completed_at:(U==null?void 0:U.completed_at)||null,id:U==null?void 0:U.id}),x.amount-=F,M.amount-=F,x.amount<.01&&P++,M.amount<.01&&T++}return v}),y=async t=>{if(!t){console.error("Transaction is undefined");return}try{const d=await g.value.find(T=>T.id===t.to),i=await g.value.find(T=>T.id===t.from);if(!d||!i){console.error("Could not find users for transaction");return}const v=`${i.name} ck ${d.name}`,P=`https://qr.sepay.vn/img?acc=${d.account_number}&bank=${d.bank}&amount=${t.amount}&des=${encodeURIComponent(v)}&template=compact&download=false`;h.value=P,V.value=!0}catch(d){console.error("Error in showQR:",d)}},N=async t=>{if(f.value.has(t.id||`${t.from}-${t.to}`))return;const d=t.id||`${t.from}-${t.to}`;f.value.add(d);const i=Q();try{if(t.id){const{error:v}=await i.from("transactions").update({completed:!t.completed,completed_at:t.completed?null:new Date().toISOString()}).eq("id",t.id);if(v)throw v}else{const{error:v}=await i.from("transactions").insert([{from_user:t.from,to_user:t.to,amount:t.amount,completed:!0,completed_at:new Date().toISOString()}]);if(v)throw v}await w()}catch(v){console.error("Error updating transaction:",v)}finally{f.value.delete(d)}},w=async()=>{try{const{data:t,error:d}=await Q().from("transactions").select("*");if(d)throw d;k.value=t}catch(t){console.error("Error loading transactions:",t)}},z=t=>t?new Date(t).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",K=()=>{const t=new URL(h.value);t.searchParams.set("download","true"),window.location.href=t.toString()};J(async()=>{var t;(t=g.value)!=null&&t.length||await _.fetchUsers(),await Promise.all([S(),w()])});const R=async()=>{await Promise.all([S(),w()])},p=t=>{const d=g.value.find(i=>i.id===t);return(d==null?void 0:d.name)||"Unknown"},u=t=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(t);return m({refreshData:R}),(t,d)=>(r(),l(H,null,[e("div",ze,[e("h2",Ge,[A(I(Oe),{class:"h-8 w-8 text-green-500"}),d[1]||(d[1]=Z(" Tổng kết và thanh toán "))]),e("div",Xe,[e("div",null,[d[2]||(d[2]=e("h3",{class:"text-md font-semibold mb-2"},"Số tiền cần thanh toán",-1)),e("div",Ze,[(r(!0),l(H,null,E(L.value,(i,v)=>(r(),l("div",{key:v,class:"bg-gray-50 p-3 rounded-lg flex justify-between items-center"},[e("span",We,c(p(v)),1),e("span",{class:j(["font-medium",i<0?"text-red-500":"text-green-500"])},[e("span",Ye,c(i<0?"(cần trả)":"(được nhận)"),1),Z(" "+c(u(i)),1)],2)]))),128))])]),e("div",null,[d[5]||(d[5]=e("h3",{class:"text-md font-semibold mb-2"},"Các khoản cần thanh toán",-1)),e("div",Je,[(r(!0),l(H,null,E(q.value,i=>(r(),l("div",{key:i.id||`${i.from}-${i.to}-${i.amount}`,class:j(["border p-4 rounded-lg transition-colors duration-200",i.completed?"bg-gray-100":"bg-white"])},[e("div",et,[e("div",tt,[e("span",nt,c(i.fromName),1),d[3]||(d[3]=e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 8l4 4m0 0l-4 4m4-4H3"})],-1)),e("span",st,c(i.toName),1)]),e("div",ot,c(u(i.amount)),1),e("div",at,[e("button",{onClick:v=>N(i),disabled:f.value.has(i.id||`${i.from}-${i.to}`),class:j(["w-full py-2 px-3 rounded-md text-sm font-medium transition-colors duration-200",f.value.has(i.id||`${i.from}-${i.to}`)?"bg-gray-300 cursor-not-allowed":i.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[Z(c(i.completed?"Đã hoàn thành":"Xác nhận đã chuyển khoản")+" ",1),f.value.has(i.id||`${i.from}-${i.to}`)?(r(),l("span",lt," ... ")):$("",!0)],10,rt),e("button",{onClick:v=>y(i),class:"w-full py-2 px-3 rounded-md text-sm font-medium bg-green-50 text-green-600"}," Tạo mã QR chuyển khoản ",8,it)])]),e("div",dt,[e("div",null,[e("span",ut,c(i.fromName),1),d[4]||(d[4]=e("span",{class:"mx-2"},"→",-1)),e("span",ct,c(i.toName),1),e("span",mt,c(u(i.amount)),1)]),e("div",gt,[e("button",{onClick:v=>N(i),disabled:f.value.has(i.id||`${i.from}-${i.to}`),class:j(["px-3 py-1 rounded-md text-sm transition-colors duration-200",f.value.has(i.id||`${i.from}-${i.to}`)?"bg-gray-300 cursor-not-allowed":i.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[Z(c(i.completed?"Đã hoàn thành":"Xác nhận đã chuyển khoản")+" ",1),f.value.has(i.id||`${i.from}-${i.to}`)?(r(),l("span",pt," ... ")):$("",!0)],10,ht),e("button",{onClick:v=>y(i),class:"px-3 py-1 rounded-md text-sm bg-green-50 text-green-600"}," Tạo mã QR chuyển khoản ",8,vt)])]),i.completed?(r(),l("div",ft," Đã hoàn thành lúc: "+c(z(i.completed_at)),1)):$("",!0)],2))),128))])])])]),V.value?(r(),l("div",yt,[e("div",xt,[d[8]||(d[8]=e("div",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-bold"},"Mã QR chuyển khoản")],-1)),e("div",bt,[e("img",{src:h.value,alt:"Mã QR chuyển khoản",class:"w-full"},null,8,_t)]),e("div",kt,[e("div",wt,[e("button",{onClick:K,class:"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-2.5 px-4 rounded-xl hover:from-green-600 hover:to-green-700 transform hover:scale-[1.02] transition-all duration-200 shadow-sm hover:shadow flex items-center justify-center gap-2"},d[6]||(d[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),Z(" Tải xuống QR ")])),e("button",{onClick:d[0]||(d[0]=i=>V.value=!1),class:"flex-1 bg-white text-gray-700 py-2.5 px-4 rounded-xl border border-gray-200 hover:bg-gray-50 transform hover:scale-[1.02] transition-all duration-200 shadow-sm hover:shadow flex items-center justify-center gap-2"},d[7]||(d[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),Z(" Đóng ")]))])])])])):$("",!0)],64))}}),Nt={class:"flex justify-between items-center mb-4"},$t={class:"text-2xl font-bold"},Bt={key:0,class:"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full"},Tt={class:"space-y-6"},Pt={class:"form-control-group"},Mt={class:"form-control-group"},Vt={class:"relative"},St={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},Ht={class:"mt-4 flex flex-wrap gap-2"},Dt=["onClick"],Et={key:0,class:"mt-2 flex flex-wrap gap-2"},At=["onClick"],Ut={class:"form-control-group"},Lt={class:"space-y-2"},It={class:"relative"},jt=["max"],qt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},Rt={class:"flex flex-wrap gap-2"},Ot=["onClick"],Kt={key:0,class:"mt-2"},Ft={class:"flex flex-wrap gap-2"},Qt=["onClick"],zt={class:"form-control-group relative"},Gt={class:"relative"},Xt=["placeholder"],Zt={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Wt={key:0,class:"p-2"},Yt={class:"space-y-1"},Jt=["onClick"],en={key:0,class:"ml-2 text-xs text-gray-500"},tn={class:"max-h-60 overflow-auto"},nn={key:0,class:"py-1"},sn=["onClick"],on={class:"flex flex-col"},an={key:0,class:"text-xs text-gray-500"},rn={key:0,class:"ml-2 text-xs text-gray-500"},ln={key:1,class:"px-3 py-2 text-sm text-gray-500"},dn={key:1,class:"mt-1 flex items-center text-sm text-gray-500"},un={class:"space-y-4"},cn={class:"flex gap-2 mb-3"},mn={class:"grid grid-cols-2 gap-2"},gn=["value"],hn={class:"ml-2 text-sm"},pn={key:0,class:"p-3 bg-yellow-50 text-yellow-700 rounded-md mb-3"},vn={key:1,class:"space-y-2"},fn={class:"flex items-center"},yn={class:"flex items-center"},xn={key:0,class:"mt-3 p-3 bg-gray-50 rounded-md"},bn={class:"font-medium"},_n={class:"flex justify-end space-x-3"},kn={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},wn=te({__name:"ExpenseForm",props:{editingExpense:{},expenses:{}},emits:["save","cancel"],setup(B,{emit:m}){const _=se(),{users:g}=ne(_),h=B,V=m,k=C(null),f=C(null),a=be({title:"",amount:0,date:new Date().toISOString().split("T")[0],payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),S=D(()=>new Date().toISOString().split("T")[0]),L=()=>{if(!a.splitEqually){const o=Object.values(a.individualAmounts).reduce((s,n)=>s+(Number(n)||0),0);if(Math.abs(o-a.amount)>.01)return!1}return!0},q=async()=>{if(!a.splitEqually&&!L()){alert("Tổng số tiền chi tiêu cá nhân phải bằng tổng số tiền");return}try{const o={title:a.title,amount:a.amount,date:a.date,payer:a.payer,participants:a.participants,split_equally:a.splitEqually,individual_amounts:a.individualAmounts},s=Q();if(f.value){const{error:n}=await s.from("expenses").update(o).eq("id",f.value);if(n)throw n}else{const{error:n}=await s.from("expenses").insert([o]);if(n)throw n}V("save"),y()}catch(o){console.error("Error saving expense:",o)}},y=()=>{f.value=null,Object.assign(a,{title:"",amount:0,date:S.value,payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),V("cancel"),w.value="",P.value="",T.value=!1},N=()=>{k.value&&k.value.scrollIntoView({behavior:"smooth",block:"start"})};X(()=>h.editingExpense,o=>{o&&(f.value=o.id,Object.assign(a,{title:o.title,amount:o.amount,date:o.date||S.value,payer:o.payer,participants:o.participants,splitEqually:o.split_equally,individualAmounts:o.individual_amounts||{}}),ke(()=>{N()}))},{immediate:!0}),J(async()=>{g.value.length||await _.fetchUsers()});const w=C(""),z=[5e4,1e5,2e5,5e5,1e6],K=D(()=>{const o=parseFloat(w.value);if(!o||isNaN(o))return[];const s=[];if(o<1e3&&s.push(o*1e3),o<1e6){const n=Math.ceil(o/1e3)*1e3;n!==o&&s.push(n)}return o<=100&&s.push(o*1e3,o*1e4),[...new Set(s)].slice(0,3)}),R=o=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(o),p=o=>{a.amount=o,w.value=o.toString()};X(()=>a.amount,o=>{o!==parseInt(w.value)&&(w.value=o.toString())},{immediate:!0}),X(w,o=>{const s=o.replace(/[^0-9]/g,"");s!==o&&(w.value=s)});const u=D(()=>{const o=new Date,s=new Date(o);s.setDate(s.getDate()-1);const n=new Date(o);return n.setDate(n.getDate()-2),[{label:"Hôm nay",value:d(o)},{label:"Hôm qua",value:d(s)},{label:"Hôm kia",value:d(n)}]}),t=D(()=>{var s;const o=((s=h.expenses)==null?void 0:s.map(n=>n.date).filter(n=>n!==a.date&&n!==S.value).slice(0,3))||[];return[...new Set(o)]}),d=o=>o.toISOString().split("T")[0],i=o=>{if(!o)return"";const s=new Date(o),n=new Date,b=new Date(n);return b.setDate(b.getDate()-1),d(n)===o?"Hôm nay":d(b)===o?"Hôm qua":new Intl.DateTimeFormat("vi-VN",{weekday:"long"}).format(s)},v=o=>{a.date=o},P=C(""),T=C(!1),x=D(()=>_.currentUser),M=D(()=>{const o=P.value.toLowerCase().trim();return o?g.value.filter(s=>{var n;return s.name.toLowerCase().includes(o)||((n=s.email)==null?void 0:n.toLowerCase().includes(o))}):g.value}),F=D(()=>{var s;const o=(s=h.expenses)==null?void 0:s.reduce((n,b)=>(n[b.payer]=(n[b.payer]||0)+1,n),{});return g.value.filter(n=>o[n.id]).sort((n,b)=>o[b.id]-o[n.id]).slice(0,5)}),U=D(()=>{if(!a.payer)return"";const o=g.value.find(s=>s.id===a.payer);return o?o.name:""}),Y=o=>{a.payer=o,P.value="",T.value=!1},ge=()=>{a.payer="",P.value=""},he=()=>{T.value=!0},ae=o=>{o.target.closest(".relative")||(T.value=!1)};J(()=>{document.addEventListener("click",ae)}),de(()=>{document.removeEventListener("click",ae)});const pe=()=>{a.participants=g.value.map(o=>o.name)},ve=D(()=>x.value&&a.participants.includes(x.value.name)),fe=()=>{if(!x.value)return;const o=x.value.name;a.participants.includes(o)?a.participants=a.participants.filter(s=>s!==o):a.participants.push(o)};X(()=>a.splitEqually,o=>{o?a.individualAmounts={}:a.participants.forEach(s=>{a.individualAmounts[s]||(a.individualAmounts[s]=0)})}),X(()=>a.participants,o=>{if(!a.splitEqually){const s={...a.individualAmounts};Object.keys(s).forEach(n=>{o.includes(n)||delete s[n]}),o.forEach(n=>{s[n]||(s[n]=0)}),a.individualAmounts=s}},{deep:!0}),X(()=>a.amount,o=>{if(a.splitEqually){const s=Math.round(o/a.participants.length);a.participants.forEach(n=>{a.individualAmounts[n]=s})}});const G=C("equal"),re=D(()=>{const o={};if(!a.payer||!a.amount||!a.participants.length)return o;const s=g.value.find(n=>n.id===a.payer);if(!s)return o;if(G.value==="equal"){const n=Math.round(a.amount/a.participants.length);a.participants.forEach(b=>{o[b]=n})}else if(G.value==="payerFree"){const n=a.participants.filter(b=>b!==s.name);if(n.length===0)o[s.name]=a.amount;else{const b=Math.round(a.amount/n.length);a.participants.forEach(ee=>{o[ee]=ee===s.name?0:b})}}return o});return X([G,()=>a.participants,()=>a.amount],()=>{a.individualAmounts={...re.value}}),(o,s)=>(r(),l("div",{ref_key:"formRef",ref:k,class:j(["bg-white rounded-lg shadow py-8 px-4 transition-all duration-300",f.value?"ring-2 ring-green-500 ring-offset-2":""])},[e("div",Nt,[e("h2",$t,c(f.value?"Chỉnh sửa khoản chi":"Thêm khoản chi mới"),1),f.value?(r(),l("span",Bt," Đang chỉnh sửa ")):$("",!0)]),e("form",{onSubmit:ue(q,["prevent"])},[e("div",Tt,[e("div",Pt,[s[10]||(s[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Bạn đã chi tiêu gì?",-1)),O(e("input",{"onUpdate:modelValue":s[0]||(s[0]=n=>a.title=n),type:"text",required:"",placeholder:"VD: Ăn trưa, Cafe, Mua sắm...",class:"form-input"},null,512),[[W,a.title]])]),e("div",Mt,[s[11]||(s[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Bạn đã chi bao nhiêu?",-1)),e("div",Vt,[O(e("input",{"onUpdate:modelValue":s[1]||(s[1]=n=>w.value=n),type:"text",required:"",placeholder:"VD: 50000, 100000, 1000000...",class:"form-input"},null,512),[[W,w.value]]),e("div",St,c(R(a.amount)),1)]),e("div",Ht,[(r(),l(H,null,E(z,n=>e("button",{key:n,type:"button",onClick:b=>p(n),class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},c(R(n)),9,Dt)),64))]),K.value.length?(r(),l("div",Et,[(r(!0),l(H,null,E(K.value,n=>(r(),l("button",{key:n,type:"button",onClick:b=>p(n),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},c(R(n)),9,At))),128))])):$("",!0)]),e("div",Ut,[s[13]||(s[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ngày chi tiêu",-1)),e("div",Lt,[e("div",It,[O(e("input",{"onUpdate:modelValue":s[2]||(s[2]=n=>a.date=n),type:"date",max:S.value,class:"form-input"},null,8,jt),[[W,a.date]]),e("div",qt,c(i(a.date)),1)]),e("div",Rt,[(r(!0),l(H,null,E(u.value,(n,b)=>(r(),l("button",{key:b,type:"button",onClick:ee=>v(n.value),class:j(["px-3 py-1 text-sm rounded-full transition-colors",a.date===n.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"])},c(n.label),11,Ot))),128))]),t.value.length?(r(),l("div",Kt,[s[12]||(s[12]=e("div",{class:"text-sm text-gray-500 mb-1"},"Gần đây:",-1)),e("div",Ft,[(r(!0),l(H,null,E(t.value,n=>(r(),l("button",{key:n,type:"button",onClick:b=>v(n),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},c(i(n)),9,Qt))),128))])])):$("",!0)])]),e("div",zt,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ai là người thanh toán?",-1)),e("div",Gt,[O(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=n=>P.value=n),onFocus:s[4]||(s[4]=n=>T.value=!0),onInput:he,placeholder:U.value||"Tìm tên người thanh toán...",class:"form-input"},null,40,Xt),[[W,P.value]]),e("span",Zt,[A(I(Qe),{class:"h-5 w-5 text-gray-400"})]),x.value&&!U.value?(r(),l("button",{key:0,type:"button",onClick:s[5]||(s[5]=n=>Y(x.value.id)),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm text-green-600 hover:text-green-700"}," Tôi trả ")):$("",!0)]),T.value?(r(),l("div",{key:0,class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",onBlur:s[6]||(s[6]=n=>T.value=!1)},[F.value.length&&!P.value?(r(),l("div",Wt,[s[14]||(s[14]=e("div",{class:"text-xs font-medium text-gray-500 mb-2"},"Thường xuyên",-1)),e("div",Yt,[(r(!0),l(H,null,E(F.value,n=>{var b;return r(),l("button",{key:n.id,onClick:ee=>Y(n.id),class:"flex items-center w-full px-3 py-2 text-sm rounded-md hover:bg-gray-100"},[A(I(oe),{class:"h-5 w-5 text-gray-400 mr-2"}),e("span",null,c(n.name),1),n.id===((b=x.value)==null?void 0:b.id)?(r(),l("span",en,"(Tôi)")):$("",!0)],8,Jt)}),128))])])):$("",!0),e("div",tn,[M.value.length?(r(),l("div",nn,[(r(!0),l(H,null,E(M.value,n=>{var b;return r(),l("button",{key:n.id,onClick:ee=>Y(n.id),class:j(["flex items-center w-full px-3 py-2 text-sm hover:bg-gray-100",{"bg-green-50":a.payer===n.id}])},[A(I(oe),{class:"h-5 w-5 text-gray-400 mr-2"}),e("div",on,[e("span",null,c(n.name),1),n.email?(r(),l("span",an,c(n.email),1)):$("",!0)]),n.id===((b=x.value)==null?void 0:b.id)?(r(),l("span",rn,"(Tôi)")):$("",!0)],10,sn)}),128))])):P.value?(r(),l("div",ln," Không tìm thấy kết quả ")):$("",!0)])],32)):$("",!0),U.value?(r(),l("div",dn,[A(I(oe),{class:"h-4 w-4 mr-1"}),Z(" "+c(U.value)+" ",1),e("button",{onClick:ge,class:"ml-2 text-gray-400 hover:text-gray-600"},[A(I(me),{class:"h-4 w-4"})])])):$("",!0)]),e("div",un,[e("div",null,[s[16]||(s[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Những ai tham gia chi tiêu này?",-1)),e("div",cn,[e("button",{type:"button",onClick:pe,class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200"}," Chọn tất cả mọi người "),x.value?(r(),l("button",{key:0,type:"button",onClick:fe,class:j(["px-3 py-1 text-sm rounded-full",ve.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"])}," Tôi có tham gia ",2)):$("",!0)]),e("div",mn,[(r(!0),l(H,null,E(I(g),n=>(r(),l("label",{key:n.id,class:j(["flex items-center p-2 rounded-md cursor-pointer hover:bg-gray-50",a.participants.includes(n.name)&&"bg-green-50"])},[O(e("input",{type:"checkbox",value:n.name,"onUpdate:modelValue":s[7]||(s[7]=b=>a.participants=b),class:"h-4 w-4 text-green-600 rounded border-gray-300"},null,8,gn),[[_e,a.participants]]),e("span",hn,c(n.name),1)],2))),128))])]),e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Cách chia tiền",-1)),a.payer?(r(),l("div",vn,[e("label",fn,[O(e("input",{type:"radio","onUpdate:modelValue":s[8]||(s[8]=n=>G.value=n),value:"equal",class:"h-4 w-4 text-green-600"},null,512),[[le,G.value]]),s[17]||(s[17]=e("span",{class:"ml-2 text-sm"},"Chia đều cho tất cả mọi người",-1))]),e("label",yn,[O(e("input",{type:"radio","onUpdate:modelValue":s[9]||(s[9]=n=>G.value=n),value:"payerFree",class:"h-4 w-4 text-green-600"},null,512),[[le,G.value]]),s[18]||(s[18]=e("span",{class:"ml-2 text-sm"},"Người thanh toán không phải trả tiền",-1))]),a.participants.length?(r(),l("div",xn,[s[19]||(s[19]=e("div",{class:"text-sm text-gray-600 mb-2"}," Mỗi người sẽ trả: ",-1)),(r(!0),l(H,null,E(re.value,(n,b)=>(r(),l("div",{key:b,class:"flex justify-between text-sm"},[e("span",null,c(b),1),e("span",bn,c(R(n)),1)]))),128))])):$("",!0)])):(r(),l("div",pn," Vui lòng chọn người trả trước khi chia tiền "))])]),e("div",_n,[e("button",{type:"button",onClick:y,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",kn,c(f.value?"Cập nhật":"Thêm"),1)])])],32)],2))}}),Cn=ce(wn,[["__scopeId","data-v-e454ab00"]]),Nn=[{name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",short_name:"VietinBank",supported:!0},{name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",short_name:"Vietcombank",supported:!0},{name:"Ngân hàng TMCP Quân đội",code:"MB",bin:"970422",short_name:"MBBank",supported:!0},{name:"Ngân hàng TMCP Á Châu",code:"ACB",bin:"970416",short_name:"ACB",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thịnh Vượng",code:"VPB",bin:"970432",short_name:"VPBank",supported:!0},{name:"Ngân hàng TMCP Tiên Phong",code:"TPB",bin:"970423",short_name:"TPBank",supported:!0},{name:"Ngân hàng TMCP Hàng Hải",code:"MSB",bin:"970426",short_name:"MSB",supported:!0},{name:"Ngân hàng TMCP Nam Á",code:"NAB",bin:"970428",short_name:"NamABank",supported:!1},{name:"Ngân hàng TMCP Bưu Điện Liên Việt",code:"LPB",bin:"970449",short_name:"LienVietPostBank",supported:!0},{name:"Ngân hàng TMCP Bản Việt",code:"VCCB",bin:"970454",short_name:"VietCapitalBank",supported:!0},{name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",short_name:"BIDV",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Thương Tín",code:"STB",bin:"970403",short_name:"Sacombank",supported:!0},{name:"Ngân hàng TMCP Quốc tế Việt Nam",code:"VIB",bin:"970441",short_name:"VIB",supported:!0},{name:"Ngân hàng TMCP Phát triển Thành phố Hồ Chí Minh",code:"HDB",bin:"970437",short_name:"HDBank",supported:!0},{name:"Ngân hàng TMCP Đông Nam Á",code:"SEAB",bin:"970440",short_name:"SeABank",supported:!0},{name:"Ngân hàng Thương mại TNHH MTV Dầu Khí Toàn Cầu",code:"GPB",bin:"970408",short_name:"GPBank",supported:!1},{name:"Ngân hàng TMCP Đại Chúng Việt Nam",code:"PVCB",bin:"970412",short_name:"PVcomBank",supported:!1},{name:"Ngân hàng TMCP Quốc Dân",code:"NCB",bin:"970419",short_name:"NCB",supported:!1},{name:"Ngân hàng TNHH MTV Shinhan Việt Nam",code:"SHBVN",bin:"970424",short_name:"ShinhanBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn",code:"SCB",bin:"970429",short_name:"SCB",supported:!1},{name:"Ngân hàng TMCP Xăng dầu Petrolimex",code:"PGB",bin:"970430",short_name:"PGBank",supported:!1},{name:"Ngân hàng Nông nghiệp và Phát triển Nông thôn Việt Nam",code:"VBA",bin:"970405",short_name:"Agribank",supported:!0},{name:"Ngân hàng TMCP Kỹ thương Việt Nam",code:"TCB",bin:"970407",short_name:"Techcombank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Công Thương",code:"SGICB",bin:"970400",short_name:"SaigonBank",supported:!1},{name:"Ngân hàng TMCP Đông Á",code:"DOB",bin:"970406",short_name:"DongABank",supported:!1},{name:"Ngân hàng TMCP Bắc Á",code:"BAB",bin:"970409",short_name:"BacABank",supported:!0},{name:"Ngân hàng TNHH MTV Standard Chartered Bank Việt Nam",code:"SCVN",bin:"970410",short_name:"StandardChartered",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Đại Dương",code:"Oceanbank",bin:"970414",short_name:"Oceanbank",supported:!1},{name:"Ngân hàng Liên doanh Việt - Nga",code:"VRB",bin:"970421",short_name:"VRB",supported:!1},{name:"Ngân hàng TMCP An Bình",code:"ABB",bin:"970425",short_name:"ABBANK",supported:!0},{name:"Ngân hàng TMCP Việt Á",code:"VAB",bin:"970427",short_name:"VietABank",supported:!1},{name:"Ngân hàng TMCP Xuất Nhập khẩu Việt Nam",code:"EIB",bin:"970431",short_name:"Eximbank",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thương Tín",code:"VIETBANK",bin:"970433",short_name:"VietBank",supported:!1},{name:"Ngân hàng TNHH Indovina",code:"IVB",bin:"970434",short_name:"IndovinaBank",supported:!1},{name:"Ngân hàng TMCP Bảo Việt",code:"BVB",bin:"970438",short_name:"BaoVietBank",supported:!1},{name:"Ngân hàng TNHH MTV Public Việt Nam",code:"PBVN",bin:"970439",short_name:"PublicBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn - Hà Nội",code:"SHB",bin:"970443",short_name:"SHB",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Xây dựng Việt Nam",code:"CBB",bin:"970444",short_name:"CBBank",supported:!1},{name:"Ngân hàng TMCP Phương Đông",code:"OCB",bin:"970448",short_name:"OCB",supported:!0},{name:"Ngân hàng TMCP Kiên Long",code:"KLB",bin:"970452",short_name:"KienLongBank",supported:!0},{name:"Ngân hàng TNHH MTV CIMB Việt Nam",code:"CIMB",bin:"422589",short_name:"CIMB",supported:!1},{name:"Ngân hàng TNHH MTV HSBC (Việt Nam)",code:"HSBC",bin:"458761",short_name:"HSBC",supported:!1},{name:"DBS Bank Ltd - Chi nhánh Thành phố Hồ Chí Minh",code:"DBS",bin:"796500",short_name:"DBSBank",supported:!1},{name:"Ngân hàng Nonghyup - Chi nhánh Hà Nội",code:"NHB HN",bin:"801011",short_name:"Nonghyup",supported:!1},{id:13,name:"Ngân hàng TNHH MTV Hong Leong Việt Nam",code:"HLBVN",bin:"970442",short_name:"HongLeong",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh Hà Nội",code:"IBK - HN",bin:"970455",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh TP. Hồ Chí Minh",code:"IBK - HCM",bin:"970456",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng TNHH MTV Woori Việt Nam",code:"WVN",bin:"970457",short_name:"Woori",supported:!1},{name:"Ngân hàng United Overseas - Chi nhánh TP. Hồ Chí Minh",code:"UOB",bin:"970458",short_name:"UnitedOverseas",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Hà Nội",code:"KBHN",bin:"970462",short_name:"KookminHN",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Thành phố Hồ Chí Minh",code:"KBHCM",bin:"970463",short_name:"KookminHCM",supported:!1},{name:"Ngân hàng Hợp tác xã Việt Nam",code:"COOPBANK",bin:"970446",short_name:"COOPBANK",supported:!1}],$n={data:Nn},Bn=()=>({banks:C($n.data)}),Tn={class:"p-4 sm:p-6"},Pn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Mn={class:"mt-4"},Vn={class:"relative"},Sn=["placeholder"],Hn={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Dn={class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg max-h-60 overflow-auto border border-gray-200"},En={key:0,class:"py-1"},An=["onClick"],Un={class:"flex items-center min-w-0 flex-1 mr-2"},Ln={class:"font-medium truncate"},In={class:"text-gray-500 truncate"},jn={key:0,class:"text-green-600 flex-shrink-0"},qn={key:1,class:"px-4 py-2 text-sm text-gray-500 text-center"},Rn={class:"mt-4 flex justify-end space-x-3"},On={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},Kn={class:"hidden sm:block overflow-x-auto"},Fn={class:"min-w-full divide-y divide-gray-200"},Qn={class:"bg-white divide-y divide-gray-200"},zn={class:"px-6 py-4 whitespace-nowrap"},Gn={class:"px-6 py-4 whitespace-nowrap"},Xn={class:"px-6 py-4 whitespace-nowrap"},Zn={class:"px-6 py-4 whitespace-nowrap text-right"},Wn=["onClick"],Yn=["onClick"],Jn={class:"sm:hidden space-y-4"},es={class:"flex justify-between items-start mb-3"},ts={class:"font-medium"},ns={class:"flex space-x-2"},ss=["onClick"],os=["onClick"],as={class:"space-y-2 text-sm"},rs={class:"grid grid-cols-2"},ls={class:"grid grid-cols-2"},is=te({__name:"UserManagement",setup(B){const m=se(),{users:_}=ne(m),g=C(null),h=C({name:"",account_number:"",bank:""}),{banks:V}=Bn(),k=C(""),f=C(!1),a=D(()=>{const p=k.value.toLowerCase().trim();return p?V.value.filter(u=>u.name.toLowerCase().includes(p)||u.short_name.toLowerCase().includes(p)||u.code.toLowerCase().includes(p)):V.value}),S=D(()=>{if(!h.value.bank)return"";const p=V.value.find(u=>u.code===h.value.bank);return p?`${p.short_name} - ${p.name}`:""}),L=p=>{const u=V.value.find(t=>t.code===p);return u?u.name:p},q=async()=>{try{const p=Q();if(g.value){const{error:u}=await p.from("users").update(h.value).eq("id",g.value);if(u)throw u}else{const{error:u}=await p.from("users").insert([h.value]);if(u)throw u}await m.refreshUsers(),w()}catch(p){console.error("Error saving user:",p)}},y=p=>{g.value=p.id,h.value={...p}},N=async p=>{if(confirm("Bạn có chắc chắn muốn xóa người dùng này?"))try{const{error:u}=await Q().from("users").delete().eq("id",p);if(u)throw u;await m.refreshUsers()}catch(u){console.error("Error deleting user:",u)}},w=()=>{g.value=null,h.value={name:"",account_number:"",bank:""}},z=p=>{h.value.bank=p.code,k.value="",f.value=!1},K=()=>{h.value.bank="",k.value=""},R=p=>{p.target.closest(".relative")||(f.value=!1)};return J(()=>{document.addEventListener("click",R)}),de(()=>{document.removeEventListener("click",R)}),(p,u)=>(r(),l("div",Tn,[e("form",{onSubmit:ue(q,["prevent"]),class:"mb-6"},[e("div",Pn,[e("div",null,[u[4]||(u[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tên người nhận",-1)),O(e("input",{"onUpdate:modelValue":u[0]||(u[0]=t=>h.value.name=t),required:"",placeholder:"Nhập tên người nhận tiền",class:"form-input"},null,512),[[W,h.value.name]])]),e("div",null,[u[5]||(u[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Số tài khoản ngân hàng",-1)),O(e("input",{"onUpdate:modelValue":u[1]||(u[1]=t=>h.value.account_number=t),placeholder:"Nhập số tài khoản ngân hàng",class:"form-input"},null,512),[[W,h.value.account_number]])])]),e("div",Mn,[u[7]||(u[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Chọn ngân hàng",-1)),e("div",Vn,[O(e("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=t=>k.value=t),onFocus:u[3]||(u[3]=t=>f.value=!0),placeholder:S.value||"Tìm tên hoặc mã ngân hàng...",class:"form-input pl-10 pr-10 w-full"},null,40,Sn),[[W,k.value]]),e("span",Hn,[A(I(Fe),{class:"h-5 w-5 text-gray-400"})]),h.value.bank?(r(),l("button",{key:0,type:"button",onClick:K,class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600"},[A(I(me),{class:"h-5 w-5"})])):$("",!0),O(e("div",Dn,[a.value.length>0?(r(),l("div",En,[(r(!0),l(H,null,E(a.value,t=>(r(),l("button",{key:t.code,onClick:d=>z(t),class:j(["w-full px-4 py-2 text-sm text-left hover:bg-gray-100 flex items-center justify-between",{"bg-green-50":h.value.bank===t.code}])},[e("div",Un,[e("span",Ln,c(t.short_name),1),u[6]||(u[6]=e("span",{class:"text-gray-500 mx-2"},"-",-1)),e("span",In,c(t.name),1)]),h.value.bank===t.code?(r(),l("span",jn,[A(I(Ke),{class:"h-5 w-5"})])):$("",!0)],10,An))),128))])):(r(),l("div",qn," Không tìm thấy ngân hàng phù hợp "))],512),[[we,f.value]])])]),e("div",Rn,[e("button",{type:"button",onClick:w,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Xóa thông tin "),e("button",On,c(g.value?"Lưu thông tin":"Thêm người nhận"),1)])],32),e("div",Kn,[e("table",Fn,[u[8]||(u[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên người nhận"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Số tài khoản"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ngân hàng"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])],-1)),e("tbody",Qn,[(r(!0),l(H,null,E(I(_),t=>(r(),l("tr",{key:t.id},[e("td",zn,c(t.name),1),e("td",Gn,c(t.account_number),1),e("td",Xn,c(t.bank+" - "+L(t.bank)),1),e("td",Zn,[e("button",{onClick:d=>y(t),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Chỉnh sửa ",8,Wn),e("button",{onClick:d=>N(t.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,Yn)])]))),128))])])]),e("div",Jn,[(r(!0),l(H,null,E(I(_),t=>(r(),l("div",{key:t.id,class:"bg-white rounded-lg border p-4"},[e("div",es,[e("div",ts,c(t.name),1),e("div",ns,[e("button",{onClick:d=>y(t),class:"text-sm text-indigo-600 hover:text-indigo-900"}," Chỉnh sửa ",8,ss),e("button",{onClick:d=>N(t.id),class:"text-sm text-red-600 hover:text-red-900"}," Xóa ",8,os)])]),e("div",as,[e("div",rs,[u[9]||(u[9]=e("div",{class:"text-gray-500"},"Số tài khoản:",-1)),e("div",null,c(t.account_number),1)]),e("div",ls,[u[10]||(u[10]=e("div",{class:"text-gray-500"},"Ngân hàng:",-1)),e("div",null,c(t.bank+" - "+L(t.bank)),1)])])]))),128))])]))}}),ds={},us={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},cs={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},ms={class:"sticky top-0 bg-white border-b p-4 flex justify-between items-center"},gs={class:"overflow-y-auto"};function hs(B,m){return r(),l("div",us,[e("div",cs,[e("div",ms,[m[2]||(m[2]=e("h2",{class:"text-xl font-bold"},"Quản lý người dùng",-1)),e("button",{onClick:m[0]||(m[0]=_=>B.$emit("close")),class:"p-2 hover:bg-gray-100 rounded-full"},m[1]||(m[1]=[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",gs,[Ce(B.$slots,"default")])])])}const ps=ce(ds,[["render",hs]]);function vs(){const B=Ne("isLoading");let m=null;const _=()=>{m&&(clearTimeout(m),m=null),B.value=!0},g=()=>{m&&clearTimeout(m),m=setTimeout(()=>{B.value=!1,m=null},800)};return{isLoading:B,showLoading:_,hideLoading:g,withLoading:async V=>{_();try{await Promise.all([V(),new Promise(k=>setTimeout(k,1e3))])}finally{g()}}}}const fs={class:"min-h-screen bg-green-50 flex flex-col"},ys={class:"container mx-auto px-4 py-8 flex-grow"},xs={key:0,class:"max-w-md mx-auto"},bs={class:"space-y-4"},_s={key:0},ks={key:0,class:"max-w-5xl mx-auto space-y-8"},ws={key:1,class:"max-w-5xl mx-auto space-y-8"},Ns=te({__name:"index",setup(B){const m=se(),{users:_}=ne(m),g=C([]),h=C(null),V=C(0),k=C(1),f=C(2),a=C(!1),S=C(!1),L=C(null),q=C(null),{withLoading:y}=vs(),N=async(u=1)=>{console.log("loadExpenses called with page:",u);try{a.value=!0,console.log("Loading started");const t=(u-1)*f.value,d=t+f.value-1;console.log("Fetching range:",t,"to",d);const i=Q(),v=i.from("expenses").select("id",{count:"exact",head:!0}),P=i.from("expenses").select(`
        id,
        title,
        amount,
        date,
        payer,
        participants,
        split_equally,
        individual_amounts
      `).order("date",{ascending:!1}).range(t,d),[T,x]=await Promise.all([v,P]);if(T.error)throw T.error;if(x.error)throw x.error;V.value=T.count||0,g.value=x.data||[],k.value=u}catch(t){console.error("Error loading expenses:",t)}finally{a.value=!1,console.log("Loading finished")}},w=async u=>{await y(async()=>{console.log("Role selected:",u);try{_.value.length||await m.fetchUsers(),await new Promise(t=>setTimeout(t,100)),h.value=u,await N(1)}catch(t){console.error("Error in handleRoleSelect:",t)}})},z=async()=>{await N(k.value),q.value&&await q.value.refreshData()},K=()=>{try{h.value=null,L.value&&(L.value=null),S.value=!1}catch(u){console.error("Error in changeRole:",u)}},R=async()=>{try{await m.fetchUsers(),S.value=!0}catch(u){console.error("Error in handleShowUserManagement:",u)}},p=()=>{S.value=!1};return J(()=>{console.log("Component mounted")}),(u,t)=>{const d=Re,i=Ct,v=Cn,P=is,T=ps;return r(),l("div",fs,[e("div",ys,[t[5]||(t[5]=e("h1",{class:"text-4xl font-bold text-center text-green-800 mb-8"},"EzSplit",-1)),h.value?$("",!0):(r(),l("div",xs,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-6 text-center"},"Bạn là...",-1)),e("div",bs,[e("button",{onClick:t[0]||(t[0]=x=>w("payer")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},t[2]||(t[2]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người trả tiền 💰",-1),e("p",{class:"text-gray-600 mt-2"},"Xem danh sách các khoản cần thanh toán",-1)])),e("button",{onClick:t[1]||(t[1]=x=>w("spender")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},t[3]||(t[3]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người chi tiền 📝",-1),e("p",{class:"text-gray-600 mt-2"},"Tạo và quản lý các khoản chi tiêu",-1)]))])])),A(Be,{"enter-active-class":"transition-opacity duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-300 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ie(()=>[h.value?(r(),l("div",_s,[e("div",{class:"flex justify-between items-center mb-6"},[e("button",{type:"button",onClick:K,class:"text-green-600 hover:text-green-700"}," ← Đổi vai trò "),e("button",{type:"button",onClick:R,class:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200"}," Quản lý danh sách người tham gia ")]),h.value==="payer"?(r(),l("div",ks,[A(d,{expenses:g.value,"current-page":k.value,"total-items":V.value,"items-per-page":f.value,loading:a.value,onPageChange:N},null,8,["expenses","current-page","total-items","items-per-page","loading"]),A(i,{ref_key:"expenseSummaryRef",ref:q},null,512)])):$("",!0),h.value==="spender"?(r(),l("div",ws,[A(v,{expenses:g.value,onSave:z},null,8,["expenses"]),A(d,{expenses:g.value,"current-page":k.value,"total-items":V.value,"items-per-page":f.value,loading:a.value,onPageChange:N},null,8,["expenses","current-page","total-items","items-per-page","loading"])])):$("",!0)])):$("",!0)]),_:1}),S.value?(r(),$e(T,{key:1,onClose:p},{default:ie(()=>[A(P)]),_:1})):$("",!0)]),t[6]||(t[6]=e("footer",{class:"text-center py-4 text-sm text-gray-600 bg-green-50"},[e("p",null,"Made with ♥️ by abner"),e("p",null,"© 2025 EzSplit. All rights reserved.")],-1))])}}});export{Ns as default};
