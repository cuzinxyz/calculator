import{a as ye,H as xe,r as w,d as J,I as ee,j as S,o as Z,t as d,v as i,x as e,J as C,K as M,L as H,M as I,y as m,z as D,B as X,N as L,O as be,P as Q,Q as de,R as ue,S as q,T as G,U as le,V as _e,W as ke,_ as ce,X as we,Y as Ce,F as Ne,Z as $e,A as ie,$ as Be}from"./sQNFPt4F.js";const z=()=>ye().$supabase.client,te=xe("users",()=>{const N=w([]),c=w(!1),v=w(null),f=w(!1),g=async()=>{if(!c.value){c.value=!0,v.value=null;try{const{data:p,error:_}=await z().from("users").select("*").order("name");if(_)throw _;N.value=p,f.value=!0}catch(p){v.value=p,console.error("Error loading users:",p)}finally{c.value=!1}}};return{users:N,loading:c,error:v,fetchUsers:g,refreshUsers:async()=>{f.value=!1,await g()}}}),Te={class:"bg-white rounded-lg shadow p-6"},Pe={key:0,class:"space-y-4"},Me={key:1,class:"text-center py-8 text-gray-500"},Ve={key:2,class:"relative"},Se={key:0,class:"absolute inset-0 bg-white/50 flex items-center justify-center rounded-lg z-10"},He={class:"space-y-4"},De={class:"font-medium mb-2"},Ee={class:"space-y-2 text-sm"},Ue={class:"grid grid-cols-2"},Ae={class:"grid grid-cols-2"},Le={class:"grid grid-cols-2"},Ie={key:3,class:"mt-4 flex justify-center space-x-2"},je=["disabled"],qe=["disabled"],Oe=J({__name:"ExpenseList",props:{expenses:{},currentPage:{},totalItems:{},itemsPerPage:{},loading:{type:Boolean}},emits:["pageChange"],setup(N,{emit:c}){const v=N,f=c,g=te(),{users:B}=ee(g),p=S(()=>Math.ceil(v.totalItems/v.itemsPerPage));Z(()=>{console.log("ExpenseList mounted with props:",v)});const _=h=>new Date(h).toLocaleDateString("vi-VN"),l=h=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(h),P=h=>{const $=B.value.find(k=>k.id===h);return($==null?void 0:$.name)||"Unknown"},E=()=>{!v.loading&&v.currentPage<p.value&&f("pageChange",v.currentPage+1)},O=()=>{!v.loading&&v.currentPage>1&&f("pageChange",v.currentPage-1)};return(h,$)=>(i(),d("div",Te,[$[4]||($[4]=e("h2",{class:"text-xl font-bold mb-6"},"Danh sách chi tiêu",-1)),h.loading&&!h.expenses.length?(i(),d("div",Pe,[(i(!0),d(M,null,H(h.itemsPerPage,k=>(i(),d("div",{key:k,class:"animate-pulse bg-gray-100 h-16 rounded-lg"}))),128))])):h.expenses.length?(i(),d("div",Ve,[h.loading&&h.expenses.length?(i(),d("div",Se,$[0]||($[0]=[e("div",{class:"flex items-center space-x-2"},[e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0s"}}),e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0.2s"}}),e("div",{class:"w-2 h-2 bg-green-600 rounded-full animate-bounce",style:{"animation-delay":"0.4s"}})],-1)]))):C("",!0),e("div",He,[(i(!0),d(M,null,H(h.expenses,k=>(i(),d("div",{key:k.id,class:"bg-white rounded-lg border p-4"},[e("div",De,m(k.title),1),e("div",Ee,[e("div",Ue,[$[1]||($[1]=e("div",{class:"text-gray-500"},"Ngày:",-1)),e("div",null,m(_(k.date)),1)]),e("div",Ae,[$[2]||($[2]=e("div",{class:"text-gray-500"},"Số tiền:",-1)),e("div",null,m(l(k.amount)),1)]),e("div",Le,[$[3]||($[3]=e("div",{class:"text-gray-500"},"Người trả:",-1)),e("div",null,m(P(k.payer)),1)])])]))),128))])])):(i(),d("div",Me," Không có chi tiêu nào ")),p.value>1?(i(),d("div",Ie,[e("button",{onClick:O,disabled:h.currentPage===1||h.loading,class:I(["px-3 py-1 rounded-md text-sm",[h.currentPage===1||h.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Trước ",10,je),e("button",{onClick:E,disabled:h.currentPage===p.value||h.loading,class:I(["px-3 py-1 rounded-md text-sm",[h.currentPage===p.value||h.loading?"bg-gray-100 text-gray-400":"bg-green-100 text-green-700 hover:bg-green-200"]])}," Sau ",10,qe)])):C("",!0)]))}});function Re(N,c){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18"})])}function Ke(N,c){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function Fe(N,c){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function oe(N,c){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}function Qe(N,c){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"})])}function me(N,c){return i(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}const Ge={class:"bg-white rounded-lg shadow p-6"},ze={class:"text-xl font-bold mb-6 inline-flex items-center gap-2"},Xe={class:"space-y-10"},Ze={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3"},We={class:"font-medium"},Ye={class:"space-y-4"},Je={class:"flex flex-col sm:hidden"},et={class:"flex items-center space-x-2 mb-2"},tt={class:"font-medium"},nt={class:"font-medium"},st={class:"text-lg font-medium text-green-600 mb-3"},ot={class:"flex flex-col space-y-2"},at=["onClick","disabled"],rt={key:0},lt=["onClick"],it={class:"hidden sm:flex sm:justify-between sm:items-center"},dt={class:"font-medium"},ut={class:"font-medium"},ct={class:"ml-2"},mt={class:"flex items-center space-x-2"},gt=["onClick","disabled"],pt={key:0},ht=["onClick"],vt={key:0,class:"text-sm text-gray-500 mt-2"},ft={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 !m-0"},yt={class:"bg-white rounded-lg shadow-xl w-full max-w-sm"},xt={class:"p-4"},bt=["src"],_t={class:"p-6 border-t bg-gray-50"},kt={class:"flex flex-col sm:flex-row gap-3"},wt=J({__name:"ExpenseSummary",props:{expenses:{}},setup(N){const c=te(),{users:v}=ee(c),f=w(""),g=w(!1),B=w([]),p=w(new Set),_=N,l=r=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(r),P=r=>{const t=v.value.find(n=>n.id===r);return(t==null?void 0:t.name)||"Unknown"},E=S(()=>{var t,n;if(!((t=v.value)!=null&&t.length)||!((n=_.expenses)!=null&&n.length))return{};const r=Object.fromEntries(v.value.map(u=>[u.id,0]));return _.expenses.forEach(u=>{const T=u.participants.length;if(T===0)return;const U=u.amount/T;r[u.payer]+=u.amount,u.participants.forEach(x=>{const y=v.value.find(V=>V.name===x);y&&(r[y.id]-=U)})}),r}),O=S(()=>{const r=E.value;if(!Object.keys(r).length)return[];const t=[],n=[];Object.entries(r).forEach(([x,y])=>{y<0?t.push({id:x,amount:-y}):y>0&&n.push({id:x,amount:y})}),t.sort((x,y)=>y.amount-x.amount),n.sort((x,y)=>y.amount-x.amount);const u=[];let T=0,U=0;for(;T<t.length&&U<n.length;){const x=t[T],y=n[U],V=Math.min(x.amount,y.amount),A=B.value.find(W=>W.from_user===x.id&&W.to_user===y.id);u.push({from:x.id,to:y.id,amount:Math.round(V),fromName:P(x.id),toName:P(y.id),completed:(A==null?void 0:A.completed)||!1,completed_at:(A==null?void 0:A.completed_at)||null,id:A==null?void 0:A.id}),x.amount-=V,y.amount-=V,x.amount<.01&&T++,y.amount<.01&&U++}return u}),h=r=>{f.value=$(r),g.value=!0},$=r=>{const t=v.value.find(T=>T.id===r.to),n=v.value.find(T=>T.id===r.from);if(!t||!n)return"";const u=`${n.name} ck ${t.name} tien ${_.expenses.map(T=>T.title).join(" ")}`;return`https://qr.sepay.vn/img?acc=${t.account_number}&bank=${t.bank}&amount=${r.amount}&des=${encodeURIComponent(u)}&template=compact&download=false`},k=async r=>{if(p.value.has(r.id||`${r.from}-${r.to}`))return;const t=r.id||`${r.from}-${r.to}`;p.value.add(t);const n=z();try{if(r.id){const{error:u}=await n.from("transactions").update({completed:!r.completed,completed_at:r.completed?null:new Date().toISOString()}).eq("id",r.id);if(u)throw u}else{const{error:u}=await n.from("transactions").insert([{from_user:r.from,to_user:r.to,amount:r.amount,completed:!0,completed_at:new Date().toISOString()}]);if(u)throw u}await R()}catch(u){console.error("Error updating transaction:",u)}finally{p.value.delete(t)}},R=async()=>{try{const{data:r,error:t}=await z().from("transactions").select("*");if(t)throw t;B.value=r}catch(r){console.error("Error loading transactions:",r)}},K=r=>r?new Date(r).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",j=()=>{const r=new URL(f.value);r.searchParams.set("download","true"),window.location.href=r.toString()};return Z(async()=>{var r;(r=v.value)!=null&&r.length||await c.fetchUsers(),await R()}),(r,t)=>(i(),d(M,null,[e("div",Ge,[e("h2",ze,[D(L(Re),{class:"h-8 w-8 text-green-500"}),t[1]||(t[1]=X(" Dựa trên phân trang chi tiêu "))]),e("div",Xe,[e("div",null,[t[2]||(t[2]=e("h3",{class:"text-md font-semibold mb-2"},"Tổng kết cá nhân",-1)),e("div",Ze,[(i(!0),d(M,null,H(E.value,(n,u)=>(i(),d("div",{key:u,class:"bg-gray-50 p-3 rounded-lg flex justify-between items-center"},[e("span",We,m(P(u)),1),e("span",{class:I(["font-medium",n<0?"text-red-500":"text-green-500"])},m(l(n)),3)]))),128))])]),e("div",null,[t[5]||(t[5]=e("h3",{class:"text-md font-semibold mb-2"},"Giao dịch cần thực hiện",-1)),e("div",Ye,[(i(!0),d(M,null,H(O.value,n=>(i(),d("div",{key:n.id||`${n.from}-${n.to}-${n.amount}`,class:I(["border p-4 rounded-lg transition-colors duration-200",n.completed?"bg-gray-100":"bg-white"])},[e("div",Je,[e("div",et,[e("span",tt,m(n.fromName),1),t[3]||(t[3]=e("svg",{class:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 8l4 4m0 0l-4 4m4-4H3"})],-1)),e("span",nt,m(n.toName),1)]),e("div",st,m(l(n.amount)),1),e("div",ot,[e("button",{onClick:u=>k(n),disabled:p.value.has(n.id||`${n.from}-${n.to}`),class:I(["w-full py-2 px-3 rounded-md text-sm font-medium transition-colors duration-200",p.value.has(n.id||`${n.from}-${n.to}`)?"bg-gray-300 cursor-not-allowed":n.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[X(m(n.completed?"Đã chuyển":"Đánh dấu đã chuyển")+" ",1),p.value.has(n.id||`${n.from}-${n.to}`)?(i(),d("span",rt," ... ")):C("",!0)],10,at),e("button",{onClick:u=>h(n),class:"w-full py-2 px-3 rounded-md text-sm font-medium bg-green-50 text-green-600"}," Tạo QR chuyển tiền ",8,lt)])]),e("div",it,[e("div",null,[e("span",dt,m(n.fromName),1),t[4]||(t[4]=e("span",{class:"mx-2"},"→",-1)),e("span",ut,m(n.toName),1),e("span",ct,m(l(n.amount)),1)]),e("div",mt,[e("button",{onClick:u=>k(n),disabled:p.value.has(n.id||`${n.from}-${n.to}`),class:I(["px-3 py-1 rounded-md text-sm transition-colors duration-200",p.value.has(n.id||`${n.from}-${n.to}`)?"bg-gray-300 cursor-not-allowed":n.completed?"bg-gray-200 text-gray-700":"bg-green-100 text-green-700"])},[X(m(n.completed?"Đã chuyển":"Đánh dấu đã chuyển")+" ",1),p.value.has(n.id||`${n.from}-${n.to}`)?(i(),d("span",pt," ... ")):C("",!0)],10,gt),e("button",{onClick:u=>h(n),class:"px-3 py-1 rounded-md text-sm bg-green-50 text-green-600"}," Tạo QR chuyển tiền ",8,ht)])]),n.completed?(i(),d("div",vt," Hoàn thành: "+m(K(n.completed_at)),1)):C("",!0)],2))),128))])])])]),g.value?(i(),d("div",ft,[e("div",yt,[t[8]||(t[8]=e("div",{class:"p-4 border-b"},[e("h3",{class:"text-lg font-bold"},"QR Code chuyển khoản")],-1)),e("div",xt,[e("img",{src:f.value,alt:"QR Code",class:"w-full"},null,8,bt)]),e("div",_t,[e("div",kt,[e("button",{onClick:j,class:"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-2.5 px-4 rounded-xl hover:from-green-600 hover:to-green-700 transform hover:scale-[1.02] transition-all duration-200 shadow-sm hover:shadow flex items-center justify-center gap-2"},t[6]||(t[6]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),X(" Tải xuống QR ")])),e("button",{onClick:t[0]||(t[0]=n=>g.value=!1),class:"flex-1 bg-white text-gray-700 py-2.5 px-4 rounded-xl border border-gray-200 hover:bg-gray-50 transform hover:scale-[1.02] transition-all duration-200 shadow-sm hover:shadow flex items-center justify-center gap-2"},t[7]||(t[7]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),X(" Đóng ")]))])])])])):C("",!0)],64))}}),Ct={class:"flex justify-between items-center mb-4"},Nt={class:"text-2xl font-bold"},$t={key:0,class:"bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full"},Bt={class:"space-y-6"},Tt={class:"form-control-group"},Pt={class:"form-control-group"},Mt={class:"relative"},Vt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},St={class:"mt-4 flex flex-wrap gap-2"},Ht=["onClick"],Dt={key:0,class:"mt-2 flex flex-wrap gap-2"},Et=["onClick"],Ut={class:"form-control-group"},At={class:"space-y-2"},Lt={class:"relative"},It=["max"],jt={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-500"},qt={class:"flex flex-wrap gap-2"},Ot=["onClick"],Rt={key:0,class:"mt-2"},Kt={class:"flex flex-wrap gap-2"},Ft=["onClick"],Qt={class:"form-control-group relative"},Gt={class:"relative"},zt=["placeholder"],Xt={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Zt={key:0,class:"p-2"},Wt={class:"space-y-1"},Yt=["onClick"],Jt={key:0,class:"ml-2 text-xs text-gray-500"},en={class:"max-h-60 overflow-auto"},tn={key:0,class:"py-1"},nn=["onClick"],sn={class:"flex flex-col"},on={key:0,class:"text-xs text-gray-500"},an={key:0,class:"ml-2 text-xs text-gray-500"},rn={key:1,class:"px-3 py-2 text-sm text-gray-500"},ln={key:1,class:"mt-1 flex items-center text-sm text-gray-500"},dn={class:"space-y-4"},un={class:"flex gap-2 mb-3"},cn={class:"grid grid-cols-2 gap-2"},mn=["value"],gn={class:"ml-2 text-sm"},pn={key:0,class:"p-3 bg-yellow-50 text-yellow-700 rounded-md mb-3"},hn={key:1,class:"space-y-2"},vn={class:"flex items-center"},fn={class:"flex items-center"},yn={key:0,class:"mt-3 p-3 bg-gray-50 rounded-md"},xn={class:"font-medium"},bn={class:"flex justify-end space-x-3"},_n={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},kn=J({__name:"ExpenseForm",props:{editingExpense:{},expenses:{}},emits:["save","cancel"],setup(N,{emit:c}){const v=te(),{users:f}=ee(v),g=N,B=c,p=w(null),_=w(null),l=be({title:"",amount:0,date:new Date().toISOString().split("T")[0],payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),P=S(()=>new Date().toISOString().split("T")[0]),E=()=>{if(!l.splitEqually){const a=Object.values(l.individualAmounts).reduce((o,s)=>o+(Number(s)||0),0);if(Math.abs(a-l.amount)>.01)return!1}return!0},O=async()=>{if(!l.splitEqually&&!E()){alert("Tổng số tiền chi tiêu cá nhân phải bằng tổng số tiền");return}try{const a={title:l.title,amount:l.amount,date:l.date,payer:l.payer,participants:l.participants,split_equally:l.splitEqually,individual_amounts:l.individualAmounts},o=z();if(_.value){const{error:s}=await o.from("expenses").update(a).eq("id",_.value);if(s)throw s}else{const{error:s}=await o.from("expenses").insert([a]);if(s)throw s}B("save"),h()}catch(a){console.error("Error saving expense:",a)}},h=()=>{_.value=null,Object.assign(l,{title:"",amount:0,date:P.value,payer:"",participants:[],splitEqually:!0,individualAmounts:{}}),B("cancel"),k.value="",x.value="",y.value=!1},$=()=>{p.value&&p.value.scrollIntoView({behavior:"smooth",block:"start"})};Q(()=>g.editingExpense,a=>{a&&(_.value=a.id,Object.assign(l,{title:a.title,amount:a.amount,date:a.date||P.value,payer:a.payer,participants:a.participants,splitEqually:a.split_equally,individualAmounts:a.individual_amounts||{}}),ke(()=>{$()}))},{immediate:!0}),Z(async()=>{f.value.length||await v.fetchUsers()});const k=w(""),R=[5e4,1e5,2e5,5e5,1e6],K=S(()=>{const a=parseFloat(k.value);if(!a||isNaN(a))return[];const o=[];if(a<1e3&&o.push(a*1e3),a<1e6){const s=Math.ceil(a/1e3)*1e3;s!==a&&o.push(s)}return a<=100&&o.push(a*1e3,a*1e4),[...new Set(o)].slice(0,3)}),j=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),r=a=>{l.amount=a,k.value=a.toString()};Q(()=>l.amount,a=>{a!==parseInt(k.value)&&(k.value=a.toString())},{immediate:!0}),Q(k,a=>{const o=a.replace(/[^0-9]/g,"");o!==a&&(k.value=o)});const t=S(()=>{const a=new Date,o=new Date(a);o.setDate(o.getDate()-1);const s=new Date(a);return s.setDate(s.getDate()-2),[{label:"Hôm nay",value:u(a)},{label:"Hôm qua",value:u(o)},{label:"Hôm kia",value:u(s)}]}),n=S(()=>{var o;const a=((o=g.expenses)==null?void 0:o.map(s=>s.date).filter(s=>s!==l.date&&s!==P.value).slice(0,3))||[];return[...new Set(a)]}),u=a=>a.toISOString().split("T")[0],T=a=>{if(!a)return"";const o=new Date(a),s=new Date,b=new Date(s);return b.setDate(b.getDate()-1),u(s)===a?"Hôm nay":u(b)===a?"Hôm qua":new Intl.DateTimeFormat("vi-VN",{weekday:"long"}).format(o)},U=a=>{l.date=a},x=w(""),y=w(!1),V=S(()=>v.currentUser),A=S(()=>{const a=x.value.toLowerCase().trim();return a?f.value.filter(o=>{var s;return o.name.toLowerCase().includes(a)||((s=o.email)==null?void 0:s.toLowerCase().includes(a))}):f.value}),W=S(()=>{var o;const a=(o=g.expenses)==null?void 0:o.reduce((s,b)=>(s[b.payer]=(s[b.payer]||0)+1,s),{});return f.value.filter(s=>a[s.id]).sort((s,b)=>a[b.id]-a[s.id]).slice(0,5)}),ne=S(()=>{if(!l.payer)return"";const a=f.value.find(o=>o.id===l.payer);return a?a.name:""}),se=a=>{l.payer=a,x.value="",y.value=!1},ge=()=>{l.payer="",x.value=""},pe=()=>{y.value=!0},ae=a=>{a.target.closest(".relative")||(y.value=!1)};Z(()=>{document.addEventListener("click",ae)}),de(()=>{document.removeEventListener("click",ae)});const he=()=>{l.participants=f.value.map(a=>a.name)},ve=S(()=>V.value&&l.participants.includes(V.value.name)),fe=()=>{if(!V.value)return;const a=V.value.name;l.participants.includes(a)?l.participants=l.participants.filter(o=>o!==a):l.participants.push(a)};Q(()=>l.splitEqually,a=>{a?l.individualAmounts={}:l.participants.forEach(o=>{l.individualAmounts[o]||(l.individualAmounts[o]=0)})}),Q(()=>l.participants,a=>{if(!l.splitEqually){const o={...l.individualAmounts};Object.keys(o).forEach(s=>{a.includes(s)||delete o[s]}),a.forEach(s=>{o[s]||(o[s]=0)}),l.individualAmounts=o}},{deep:!0}),Q(()=>l.amount,a=>{if(l.splitEqually){const o=Math.round(a/l.participants.length);l.participants.forEach(s=>{l.individualAmounts[s]=o})}});const F=w("equal"),re=S(()=>{const a={};if(!l.payer||!l.amount||!l.participants.length)return a;const o=f.value.find(s=>s.id===l.payer);if(!o)return a;if(F.value==="equal"){const s=Math.round(l.amount/l.participants.length);l.participants.forEach(b=>{a[b]=s})}else if(F.value==="payerFree"){const s=l.participants.filter(b=>b!==o.name);if(s.length===0)a[o.name]=l.amount;else{const b=Math.round(l.amount/s.length);l.participants.forEach(Y=>{a[Y]=Y===o.name?0:b})}}return a});return Q([F,()=>l.participants,()=>l.amount],()=>{l.individualAmounts={...re.value}}),(a,o)=>(i(),d("div",{ref_key:"formRef",ref:p,class:I(["bg-white rounded-lg shadow py-8 px-4 transition-all duration-300",_.value?"ring-2 ring-green-500 ring-offset-2":""])},[e("div",Ct,[e("h2",Nt,m(_.value?"Sửa chi tiêu":"Thêm chi tiêu mới"),1),_.value?(i(),d("span",$t," Đang sửa ")):C("",!0)]),e("form",{onSubmit:ue(O,["prevent"])},[e("div",Bt,[e("div",Tt,[o[10]||(o[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tên chi tiêu",-1)),q(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>l.title=s),type:"text",required:"",class:"form-input"},null,512),[[G,l.title]])]),e("div",Pt,[o[11]||(o[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Số tiền",-1)),e("div",Mt,[q(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>k.value=s),type:"text",required:"",placeholder:"Nhập số tiền",class:"form-input"},null,512),[[G,k.value]]),e("div",Vt,m(j(l.amount)),1)]),e("div",St,[(i(),d(M,null,H(R,s=>e("button",{key:s,type:"button",onClick:b=>r(s),class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200 transition-colors"},m(j(s)),9,Ht)),64))]),K.value.length?(i(),d("div",Dt,[(i(!0),d(M,null,H(K.value,s=>(i(),d("button",{key:s,type:"button",onClick:b=>r(s),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},m(j(s)),9,Et))),128))])):C("",!0)]),e("div",Ut,[o[13]||(o[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ngày chi tiêu",-1)),e("div",At,[e("div",Lt,[q(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>l.date=s),type:"date",max:P.value,class:"form-input"},null,8,It),[[G,l.date]]),e("div",jt,m(T(l.date)),1)]),e("div",qt,[(i(!0),d(M,null,H(t.value,(s,b)=>(i(),d("button",{key:b,type:"button",onClick:Y=>U(s.value),class:I(["px-3 py-1 text-sm rounded-full transition-colors",l.date===s.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"])},m(s.label),11,Ot))),128))]),n.value.length?(i(),d("div",Rt,[o[12]||(o[12]=e("div",{class:"text-sm text-gray-500 mb-1"},"Gần đây:",-1)),e("div",Kt,[(i(!0),d(M,null,H(n.value,s=>(i(),d("button",{key:s,type:"button",onClick:b=>U(s),class:"px-3 py-1 text-sm rounded-full bg-green-50 hover:bg-green-100 text-green-700 transition-colors"},m(T(s)),9,Ft))),128))])])):C("",!0)])]),e("div",Qt,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Người trả",-1)),e("div",Gt,[q(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=s=>x.value=s),onFocus:o[4]||(o[4]=s=>y.value=!0),onInput:pe,placeholder:ne.value||"Tìm người trả...",class:"form-input"},null,40,zt),[[G,x.value]]),e("span",Xt,[D(L(Qe),{class:"h-5 w-5 text-gray-400"})]),V.value&&!ne.value?(i(),d("button",{key:0,type:"button",onClick:o[5]||(o[5]=s=>se(V.value.id)),class:"absolute inset-y-0 right-0 flex items-center pr-3 text-sm text-green-600 hover:text-green-700"}," Tôi trả ")):C("",!0)]),y.value?(i(),d("div",{key:0,class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg",onBlur:o[6]||(o[6]=s=>y.value=!1)},[W.value.length&&!x.value?(i(),d("div",Zt,[o[14]||(o[14]=e("div",{class:"text-xs font-medium text-gray-500 mb-2"},"Thường xuyên",-1)),e("div",Wt,[(i(!0),d(M,null,H(W.value,s=>{var b;return i(),d("button",{key:s.id,onClick:Y=>se(s.id),class:"flex items-center w-full px-3 py-2 text-sm rounded-md hover:bg-gray-100"},[D(L(oe),{class:"h-5 w-5 text-gray-400 mr-2"}),e("span",null,m(s.name),1),s.id===((b=V.value)==null?void 0:b.id)?(i(),d("span",Jt,"(Tôi)")):C("",!0)],8,Yt)}),128))])])):C("",!0),e("div",en,[A.value.length?(i(),d("div",tn,[(i(!0),d(M,null,H(A.value,s=>{var b;return i(),d("button",{key:s.id,onClick:Y=>se(s.id),class:I(["flex items-center w-full px-3 py-2 text-sm hover:bg-gray-100",{"bg-green-50":l.payer===s.id}])},[D(L(oe),{class:"h-5 w-5 text-gray-400 mr-2"}),e("div",sn,[e("span",null,m(s.name),1),s.email?(i(),d("span",on,m(s.email),1)):C("",!0)]),s.id===((b=V.value)==null?void 0:b.id)?(i(),d("span",an,"(Tôi)")):C("",!0)],10,nn)}),128))])):x.value?(i(),d("div",rn," Không tìm thấy kết quả ")):C("",!0)])],32)):C("",!0),ne.value?(i(),d("div",ln,[D(L(oe),{class:"h-4 w-4 mr-1"}),X(" "+m(ne.value)+" ",1),e("button",{onClick:ge,class:"ml-2 text-gray-400 hover:text-gray-600"},[D(L(me),{class:"h-4 w-4"})])])):C("",!0)]),e("div",dn,[e("div",null,[o[16]||(o[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Người tham gia",-1)),e("div",un,[e("button",{type:"button",onClick:he,class:"px-3 py-1 text-sm rounded-full bg-gray-100 hover:bg-gray-200"}," Chọn tất cả "),V.value?(i(),d("button",{key:0,type:"button",onClick:fe,class:I(["px-3 py-1 text-sm rounded-full",ve.value?"bg-green-100 text-green-700":"bg-gray-100 hover:bg-gray-200"])}," Tôi tham gia ",2)):C("",!0)]),e("div",cn,[(i(!0),d(M,null,H(L(f),s=>(i(),d("label",{key:s.id,class:I(["flex items-center p-2 rounded-md cursor-pointer hover:bg-gray-50",l.participants.includes(s.name)&&"bg-green-50"])},[q(e("input",{type:"checkbox",value:s.name,"onUpdate:modelValue":o[7]||(o[7]=b=>l.participants=b),class:"h-4 w-4 text-green-600 rounded border-gray-300"},null,8,mn),[[_e,l.participants]]),e("span",gn,m(s.name),1)],2))),128))])]),e("div",null,[o[20]||(o[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Cách chia tiền",-1)),l.payer?(i(),d("div",hn,[e("label",vn,[q(e("input",{type:"radio","onUpdate:modelValue":o[8]||(o[8]=s=>F.value=s),value:"equal",class:"h-4 w-4 text-green-600"},null,512),[[le,F.value]]),o[17]||(o[17]=e("span",{class:"ml-2 text-sm"},"Chia đều cho tất cả",-1))]),e("label",fn,[q(e("input",{type:"radio","onUpdate:modelValue":o[9]||(o[9]=s=>F.value=s),value:"payerFree",class:"h-4 w-4 text-green-600"},null,512),[[le,F.value]]),o[18]||(o[18]=e("span",{class:"ml-2 text-sm"},"Người trả không phải trả",-1))]),l.participants.length?(i(),d("div",yn,[o[19]||(o[19]=e("div",{class:"text-sm text-gray-600 mb-2"}," Mỗi người sẽ trả: ",-1)),(i(!0),d(M,null,H(re.value,(s,b)=>(i(),d("div",{key:b,class:"flex justify-between text-sm"},[e("span",null,m(b),1),e("span",xn,m(j(s)),1)]))),128))])):C("",!0)])):(i(),d("div",pn," Vui lòng chọn người trả trước khi chia tiền "))])]),e("div",bn,[e("button",{type:"button",onClick:h,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Hủy "),e("button",_n,m(_.value?"Cập nhật":"Thêm"),1)])])],32)],2))}}),wn=ce(kn,[["__scopeId","data-v-3dfbc7e4"]]),Cn=[{name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",short_name:"VietinBank",supported:!0},{name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",short_name:"Vietcombank",supported:!0},{name:"Ngân hàng TMCP Quân đội",code:"MB",bin:"970422",short_name:"MBBank",supported:!0},{name:"Ngân hàng TMCP Á Châu",code:"ACB",bin:"970416",short_name:"ACB",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thịnh Vượng",code:"VPB",bin:"970432",short_name:"VPBank",supported:!0},{name:"Ngân hàng TMCP Tiên Phong",code:"TPB",bin:"970423",short_name:"TPBank",supported:!0},{name:"Ngân hàng TMCP Hàng Hải",code:"MSB",bin:"970426",short_name:"MSB",supported:!0},{name:"Ngân hàng TMCP Nam Á",code:"NAB",bin:"970428",short_name:"NamABank",supported:!1},{name:"Ngân hàng TMCP Bưu Điện Liên Việt",code:"LPB",bin:"970449",short_name:"LienVietPostBank",supported:!0},{name:"Ngân hàng TMCP Bản Việt",code:"VCCB",bin:"970454",short_name:"VietCapitalBank",supported:!0},{name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",short_name:"BIDV",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Thương Tín",code:"STB",bin:"970403",short_name:"Sacombank",supported:!0},{name:"Ngân hàng TMCP Quốc tế Việt Nam",code:"VIB",bin:"970441",short_name:"VIB",supported:!0},{name:"Ngân hàng TMCP Phát triển Thành phố Hồ Chí Minh",code:"HDB",bin:"970437",short_name:"HDBank",supported:!0},{name:"Ngân hàng TMCP Đông Nam Á",code:"SEAB",bin:"970440",short_name:"SeABank",supported:!0},{name:"Ngân hàng Thương mại TNHH MTV Dầu Khí Toàn Cầu",code:"GPB",bin:"970408",short_name:"GPBank",supported:!1},{name:"Ngân hàng TMCP Đại Chúng Việt Nam",code:"PVCB",bin:"970412",short_name:"PVcomBank",supported:!1},{name:"Ngân hàng TMCP Quốc Dân",code:"NCB",bin:"970419",short_name:"NCB",supported:!1},{name:"Ngân hàng TNHH MTV Shinhan Việt Nam",code:"SHBVN",bin:"970424",short_name:"ShinhanBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn",code:"SCB",bin:"970429",short_name:"SCB",supported:!1},{name:"Ngân hàng TMCP Xăng dầu Petrolimex",code:"PGB",bin:"970430",short_name:"PGBank",supported:!1},{name:"Ngân hàng Nông nghiệp và Phát triển Nông thôn Việt Nam",code:"VBA",bin:"970405",short_name:"Agribank",supported:!0},{name:"Ngân hàng TMCP Kỹ thương Việt Nam",code:"TCB",bin:"970407",short_name:"Techcombank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn Công Thương",code:"SGICB",bin:"970400",short_name:"SaigonBank",supported:!1},{name:"Ngân hàng TMCP Đông Á",code:"DOB",bin:"970406",short_name:"DongABank",supported:!1},{name:"Ngân hàng TMCP Bắc Á",code:"BAB",bin:"970409",short_name:"BacABank",supported:!0},{name:"Ngân hàng TNHH MTV Standard Chartered Bank Việt Nam",code:"SCVN",bin:"970410",short_name:"StandardChartered",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Đại Dương",code:"Oceanbank",bin:"970414",short_name:"Oceanbank",supported:!1},{name:"Ngân hàng Liên doanh Việt - Nga",code:"VRB",bin:"970421",short_name:"VRB",supported:!1},{name:"Ngân hàng TMCP An Bình",code:"ABB",bin:"970425",short_name:"ABBANK",supported:!0},{name:"Ngân hàng TMCP Việt Á",code:"VAB",bin:"970427",short_name:"VietABank",supported:!1},{name:"Ngân hàng TMCP Xuất Nhập khẩu Việt Nam",code:"EIB",bin:"970431",short_name:"Eximbank",supported:!0},{name:"Ngân hàng TMCP Việt Nam Thương Tín",code:"VIETBANK",bin:"970433",short_name:"VietBank",supported:!1},{name:"Ngân hàng TNHH Indovina",code:"IVB",bin:"970434",short_name:"IndovinaBank",supported:!1},{name:"Ngân hàng TMCP Bảo Việt",code:"BVB",bin:"970438",short_name:"BaoVietBank",supported:!1},{name:"Ngân hàng TNHH MTV Public Việt Nam",code:"PBVN",bin:"970439",short_name:"PublicBank",supported:!0},{name:"Ngân hàng TMCP Sài Gòn - Hà Nội",code:"SHB",bin:"970443",short_name:"SHB",supported:!1},{name:"Ngân hàng Thương mại TNHH MTV Xây dựng Việt Nam",code:"CBB",bin:"970444",short_name:"CBBank",supported:!1},{name:"Ngân hàng TMCP Phương Đông",code:"OCB",bin:"970448",short_name:"OCB",supported:!0},{name:"Ngân hàng TMCP Kiên Long",code:"KLB",bin:"970452",short_name:"KienLongBank",supported:!0},{name:"Ngân hàng TNHH MTV CIMB Việt Nam",code:"CIMB",bin:"422589",short_name:"CIMB",supported:!1},{name:"Ngân hàng TNHH MTV HSBC (Việt Nam)",code:"HSBC",bin:"458761",short_name:"HSBC",supported:!1},{name:"DBS Bank Ltd - Chi nhánh Thành phố Hồ Chí Minh",code:"DBS",bin:"796500",short_name:"DBSBank",supported:!1},{name:"Ngân hàng Nonghyup - Chi nhánh Hà Nội",code:"NHB HN",bin:"801011",short_name:"Nonghyup",supported:!1},{id:13,name:"Ngân hàng TNHH MTV Hong Leong Việt Nam",code:"HLBVN",bin:"970442",short_name:"HongLeong",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh Hà Nội",code:"IBK - HN",bin:"970455",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng Công nghiệp Hàn Quốc - Chi nhánh TP. Hồ Chí Minh",code:"IBK - HCM",bin:"970456",short_name:"IBK Bank",supported:!1},{name:"Ngân hàng TNHH MTV Woori Việt Nam",code:"WVN",bin:"970457",short_name:"Woori",supported:!1},{name:"Ngân hàng United Overseas - Chi nhánh TP. Hồ Chí Minh",code:"UOB",bin:"970458",short_name:"UnitedOverseas",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Hà Nội",code:"KBHN",bin:"970462",short_name:"KookminHN",supported:!1},{name:"Ngân hàng Kookmin - Chi nhánh Thành phố Hồ Chí Minh",code:"KBHCM",bin:"970463",short_name:"KookminHCM",supported:!1},{name:"Ngân hàng Hợp tác xã Việt Nam",code:"COOPBANK",bin:"970446",short_name:"COOPBANK",supported:!1}],Nn={data:Cn},$n=()=>({banks:w(Nn.data)}),Bn={class:"p-4 sm:p-6"},Tn={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pn={class:"mt-4"},Mn={class:"relative"},Vn=["placeholder"],Sn={class:"absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"},Hn={class:"absolute z-10 mt-1 w-full rounded-md bg-white shadow-lg max-h-60 overflow-auto border border-gray-200"},Dn={key:0,class:"py-1"},En=["onClick"],Un={class:"flex items-center min-w-0 flex-1 mr-2"},An={class:"font-medium truncate"},Ln={class:"text-gray-500 truncate"},In={key:0,class:"text-green-600 flex-shrink-0"},jn={key:1,class:"px-4 py-2 text-sm text-gray-500 text-center"},qn={class:"mt-4 flex justify-end space-x-3"},On={type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-md hover:bg-green-700"},Rn={class:"hidden sm:block overflow-x-auto"},Kn={class:"min-w-full divide-y divide-gray-200"},Fn={class:"bg-white divide-y divide-gray-200"},Qn={class:"px-6 py-4 whitespace-nowrap"},Gn={class:"px-6 py-4 whitespace-nowrap"},zn={class:"px-6 py-4 whitespace-nowrap"},Xn={class:"px-6 py-4 whitespace-nowrap text-right"},Zn=["onClick"],Wn=["onClick"],Yn={class:"sm:hidden space-y-4"},Jn={class:"flex justify-between items-start mb-3"},es={class:"font-medium"},ts={class:"flex space-x-2"},ns=["onClick"],ss=["onClick"],os={class:"space-y-2 text-sm"},as={class:"grid grid-cols-2"},rs={class:"grid grid-cols-2"},ls=J({__name:"UserManagement",setup(N){const c=te(),{users:v}=ee(c),f=w(null),g=w({name:"",account_number:"",bank:""}),{banks:B}=$n(),p=w(""),_=w(!1),l=S(()=>{const r=p.value.toLowerCase().trim();return r?B.value.filter(t=>t.name.toLowerCase().includes(r)||t.short_name.toLowerCase().includes(r)||t.code.toLowerCase().includes(r)):B.value}),P=S(()=>{if(!g.value.bank)return"";const r=B.value.find(t=>t.code===g.value.bank);return r?`${r.short_name} - ${r.name}`:""}),E=r=>{const t=B.value.find(n=>n.code===r);return t?t.name:r},O=async()=>{try{const r=z();if(f.value){const{error:t}=await r.from("users").update(g.value).eq("id",f.value);if(t)throw t}else{const{error:t}=await r.from("users").insert([g.value]);if(t)throw t}await c.refreshUsers(),k()}catch(r){console.error("Error saving user:",r)}},h=r=>{f.value=r.id,g.value={...r}},$=async r=>{if(confirm("Bạn có chắc chắn muốn xóa người dùng này?"))try{const{error:t}=await z().from("users").delete().eq("id",r);if(t)throw t;await c.refreshUsers()}catch(t){console.error("Error deleting user:",t)}},k=()=>{f.value=null,g.value={name:"",account_number:"",bank:""}},R=r=>{g.value.bank=r.code,p.value="",_.value=!1},K=()=>{g.value.bank="",p.value=""},j=r=>{r.target.closest(".relative")||(_.value=!1)};return Z(()=>{document.addEventListener("click",j)}),de(()=>{document.removeEventListener("click",j)}),(r,t)=>(i(),d("div",Bn,[e("form",{onSubmit:ue(O,["prevent"]),class:"mb-6"},[e("div",Tn,[e("div",null,[t[4]||(t[4]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Tên",-1)),q(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>g.value.name=n),required:"",class:"form-input"},null,512),[[G,g.value.name]])]),e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Số tài khoản",-1)),q(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>g.value.account_number=n),class:"form-input"},null,512),[[G,g.value.account_number]])])]),e("div",Pn,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"Ngân hàng",-1)),e("div",Mn,[q(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>p.value=n),onFocus:t[3]||(t[3]=n=>_.value=!0),placeholder:P.value||"Tìm ngân hàng...",class:"form-input pl-10 pr-10 w-full"},null,40,Vn),[[G,p.value]]),e("span",Sn,[D(L(Fe),{class:"h-5 w-5 text-gray-400"})]),g.value.bank?(i(),d("button",{key:0,type:"button",onClick:K,class:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-gray-600"},[D(L(me),{class:"h-5 w-5"})])):C("",!0),q(e("div",Hn,[l.value.length>0?(i(),d("div",Dn,[(i(!0),d(M,null,H(l.value,n=>(i(),d("button",{key:n.code,onClick:u=>R(n),class:I(["w-full px-4 py-2 text-sm text-left hover:bg-gray-100 flex items-center justify-between",{"bg-green-50":g.value.bank===n.code}])},[e("div",Un,[e("span",An,m(n.short_name),1),t[6]||(t[6]=e("span",{class:"text-gray-500 mx-2"},"-",-1)),e("span",Ln,m(n.name),1)]),g.value.bank===n.code?(i(),d("span",In,[D(L(Ke),{class:"h-5 w-5"})])):C("",!0)],10,En))),128))])):(i(),d("div",jn," Không tìm thấy ngân hàng phù hợp "))],512),[[we,_.value]])])]),e("div",qn,[e("button",{type:"button",onClick:k,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200"}," Reset "),e("button",On,m(f.value?"Cập nhật":"Thêm"),1)])],32),e("div",Rn,[e("table",Kn,[t[8]||(t[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tên"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Số tài khoản"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Ngân hàng"),e("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])],-1)),e("tbody",Fn,[(i(!0),d(M,null,H(L(v),n=>(i(),d("tr",{key:n.id},[e("td",Qn,m(n.name),1),e("td",Gn,m(n.account_number),1),e("td",zn,m(n.bank+" - "+E(n.bank)),1),e("td",Xn,[e("button",{onClick:u=>h(n),class:"text-indigo-600 hover:text-indigo-900 mr-3"}," Sửa ",8,Zn),e("button",{onClick:u=>$(n.id),class:"text-red-600 hover:text-red-900"}," Xóa ",8,Wn)])]))),128))])])]),e("div",Yn,[(i(!0),d(M,null,H(L(v),n=>(i(),d("div",{key:n.id,class:"bg-white rounded-lg border p-4"},[e("div",Jn,[e("div",es,m(n.name),1),e("div",ts,[e("button",{onClick:u=>h(n),class:"text-sm text-indigo-600 hover:text-indigo-900"}," Sửa ",8,ns),e("button",{onClick:u=>$(n.id),class:"text-sm text-red-600 hover:text-red-900"}," Xóa ",8,ss)])]),e("div",os,[e("div",as,[t[9]||(t[9]=e("div",{class:"text-gray-500"},"Số tài khoản:",-1)),e("div",null,m(n.account_number),1)]),e("div",rs,[t[10]||(t[10]=e("div",{class:"text-gray-500"},"Ngân hàng:",-1)),e("div",null,m(n.bank+" - "+E(n.bank)),1)])])]))),128))])]))}}),is={},ds={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"},us={class:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"},cs={class:"sticky top-0 bg-white border-b p-4 flex justify-between items-center"},ms={class:"overflow-y-auto"};function gs(N,c){return i(),d("div",ds,[e("div",us,[e("div",cs,[c[2]||(c[2]=e("h2",{class:"text-xl font-bold"},"Quản lý người dùng",-1)),e("button",{onClick:c[0]||(c[0]=v=>N.$emit("close")),class:"p-2 hover:bg-gray-100 rounded-full"},c[1]||(c[1]=[e("svg",{class:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("div",ms,[Ce(N.$slots,"default")])])])}const ps=ce(is,[["render",gs]]);function hs(){const N=Ne("isLoading");let c=null;const v=()=>{c&&(clearTimeout(c),c=null),N.value=!0},f=()=>{c&&clearTimeout(c),c=setTimeout(()=>{N.value=!1,c=null},800)};return{isLoading:N,showLoading:v,hideLoading:f,withLoading:async B=>{v();try{await Promise.all([B(),new Promise(p=>setTimeout(p,1e3))])}finally{f()}}}}const vs={class:"min-h-screen bg-green-50 flex flex-col"},fs={class:"container mx-auto px-4 py-8 flex-grow"},ys={key:0,class:"max-w-md mx-auto"},xs={class:"space-y-4"},bs={key:0},_s={key:0,class:"max-w-5xl mx-auto space-y-8"},ks={key:1,class:"max-w-5xl mx-auto space-y-8"},Cs=J({__name:"index",setup(N){const c=te(),{users:v}=ee(c),f=w([]),g=w(null),B=w(0),p=w(1),_=w(2),l=w(!1),P=w(!1),E=w(null),{withLoading:O}=hs(),h=async(r=1)=>{console.log("loadExpenses called with page:",r);try{l.value=!0,console.log("Loading started");const t=(r-1)*_.value,n=t+_.value-1;console.log("Fetching range:",t,"to",n);const u=z(),T=u.from("expenses").select("id",{count:"exact",head:!0}),U=u.from("expenses").select(`
        id,
        title,
        amount,
        date,
        payer,
        participants,
        split_equally,
        individual_amounts
      `).order("date",{ascending:!1}).range(t,n),[x,y]=await Promise.all([T,U]);if(x.error)throw x.error;if(y.error)throw y.error;B.value=x.count||0,f.value=y.data||[],p.value=r}catch(t){console.error("Error loading expenses:",t)}finally{l.value=!1,console.log("Loading finished")}},$=async r=>{await O(async()=>{console.log("Role selected:",r);try{v.value.length||await c.fetchUsers(),await new Promise(t=>setTimeout(t,100)),g.value=r,await h(1)}catch(t){console.error("Error in handleRoleSelect:",t)}})},k=async()=>{B.value=0,await h(1)},R=()=>{try{g.value=null,E.value&&(E.value=null),P.value=!1}catch(r){console.error("Error in changeRole:",r)}},K=async()=>{try{await c.fetchUsers(),P.value=!0}catch(r){console.error("Error in handleShowUserManagement:",r)}},j=()=>{P.value=!1};return Z(()=>{console.log("Component mounted")}),(r,t)=>{const n=Oe,u=wt,T=wn,U=ls,x=ps;return i(),d("div",vs,[e("div",fs,[t[5]||(t[5]=e("h1",{class:"text-4xl font-bold text-center text-green-800 mb-8"},"EzSplit",-1)),g.value?C("",!0):(i(),d("div",ys,[t[4]||(t[4]=e("h2",{class:"text-xl font-semibold mb-6 text-center"},"Bạn là...",-1)),e("div",xs,[e("button",{onClick:t[0]||(t[0]=y=>$("payer")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},t[2]||(t[2]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người trả tiền 💰",-1),e("p",{class:"text-gray-600 mt-2"},"Xem danh sách các khoản cần thanh toán",-1)])),e("button",{onClick:t[1]||(t[1]=y=>$("spender")),class:"w-full p-6 text-left bg-white rounded-lg shadow hover:shadow-md transition-shadow"},t[3]||(t[3]=[e("h3",{class:"text-lg font-medium text-green-700"},"Người chi tiền 📝",-1),e("p",{class:"text-gray-600 mt-2"},"Tạo và quản lý các khoản chi tiêu",-1)]))])])),D(Be,{"enter-active-class":"transition-opacity duration-300 ease-out","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition-opacity duration-300 ease-in","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:ie(()=>[g.value?(i(),d("div",bs,[e("div",{class:"flex justify-between items-center mb-6"},[e("button",{type:"button",onClick:R,class:"text-green-600 hover:text-green-700"}," ← Đổi vai trò "),e("button",{type:"button",onClick:K,class:"px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200"}," Quản lý người dùng ")]),g.value==="payer"?(i(),d("div",_s,[D(n,{expenses:f.value,"current-page":p.value,"total-items":B.value,"items-per-page":_.value,loading:l.value,onPageChange:h},null,8,["expenses","current-page","total-items","items-per-page","loading"]),D(u,{expenses:f.value},null,8,["expenses"])])):C("",!0),g.value==="spender"?(i(),d("div",ks,[D(T,{expenses:f.value,onSave:k},null,8,["expenses"]),D(n,{expenses:f.value,"current-page":p.value,"total-items":B.value,"items-per-page":_.value,loading:l.value,onPageChange:h},null,8,["expenses","current-page","total-items","items-per-page","loading"])])):C("",!0)])):C("",!0)]),_:1}),P.value?(i(),$e(x,{key:1,onClose:j},{default:ie(()=>[D(U)]),_:1})):C("",!0)]),t[6]||(t[6]=e("footer",{class:"text-center py-4 text-sm text-gray-600 bg-green-50"},[e("p",null,"Made with ♥️ by abner"),e("p",null,"© 2025 EzSplit. All rights reserved.")],-1))])}}});export{Cs as default};
